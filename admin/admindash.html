<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - 241 Runners Awareness</title>
    <meta name="description" content="Admin dashboard for 241 Runners Awareness">
    
    <!-- Enhanced Cache Control for All Browsers -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    
    <!-- Favicon with cache busting -->
    <link rel="icon" type="image/x-icon" href="../assets/images/241-logo.jpg?v=20250107">
    
    <!-- External Stylesheets with cache busting -->
    <link rel="stylesheet" href="/styles.css?v=20250107">
    <link rel="stylesheet" href="/admin/assets/css/admin.css?v=20250107">
    <link rel="stylesheet" href="/forms.css?v=20250107">
    <link rel="stylesheet" href="/admin/assets/css/admin-dashboard-fixes.css?v=20250107">
    
    <!-- SignalR Client Library -->
    <script src="https://unpkg.com/@microsoft/signalr@latest/dist/browser/signalr.min.js"></script>
    
    <!-- Inline Critical CSS for immediate rendering -->
    <style>
        /* ===== CRITICAL CSS - LOADED FIRST ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            font-size: 16px;
            line-height: 1.6;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            color: #333;
            overflow-x: hidden;
        }
        
        /* Loading State */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #dc2626;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Hide content until loaded */
        .admin-dashboard {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .admin-dashboard.loaded {
            opacity: 1;
        }
        
        /* Toast Styles */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10001;
            pointer-events: none;
        }
        
        .toast {
            background: white;
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 10px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            border-left: 4px solid;
            animation: slideIn 0.3s ease;
            max-width: 400px;
            pointer-events: auto;
        }
        
        .toast-success {
            border-left-color: #059669;
        }
        
        .toast-error {
            border-left-color: #dc2626;
        }
        
        .toast-warning {
            border-left-color: #d97706;
        }
        
        .toast-info {
            border-left-color: #3b82f6;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .toast-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }
        
        .toast-message {
            flex: 1;
        }
        
        .toast-close {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .toast-close:hover {
            color: #333;
        }
        
        /* User Management Styles */
        .user-management-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin: 20px;
            overflow: hidden;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px;
            border-bottom: 1px solid #e5e7eb;
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
        }
        
        .section-header h2 {
            margin: 0;
            color: #1f2937;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .section-actions {
            display: flex;
            gap: 12px;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #dc2626, #991b1b);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #b91c1c, #7f1d1d);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }
        
        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
        }
        
        .btn-secondary:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
        }
        
        .btn-outline {
            background: transparent;
            color: #6b7280;
            border: 1px solid #d1d5db;
        }
        
        .btn-outline:hover {
            background: #f9fafb;
            border-color: #9ca3af;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        
        .btn-warning:hover {
            background: linear-gradient(135deg, #d97706, #b45309);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn-icon {
            font-size: 1rem;
        }
        
        .user-controls {
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
            background: #f9fafb;
        }
        
        .search-filter-bar {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        
        .search-box {
            position: relative;
            flex: 1;
            min-width: 300px;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 16px 12px 40px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.9rem;
            background: white;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            font-size: 1rem;
        }
        
        .filter-controls {
            display: flex;
            gap: 12px;
        }
        
        .filter-controls select {
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.9rem;
            background: white;
            min-width: 120px;
        }
        
        .filter-controls select:focus {
            outline: none;
            border-color: #dc2626;
        }
        
        .bulk-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .users-table-container {
            overflow-x: auto;
        }
        
        .users-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        
        .users-table th {
            background: #f8fafc;
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
            white-space: nowrap;
        }
        
        .users-table td {
            padding: 16px 12px;
            border-bottom: 1px solid #f3f4f6;
            vertical-align: middle;
        }
        
        .users-table tbody tr:hover {
            background: #f9fafb;
        }
        
        .users-table tbody tr.selected {
            background: #fef2f2;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #dc2626, #991b1b);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .user-details h4 {
            margin: 0;
            font-size: 0.9rem;
            font-weight: 600;
            color: #1f2937;
        }
        
        .user-details p {
            margin: 2px 0 0 0;
            font-size: 0.8rem;
            color: #6b7280;
        }
        
        .role-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
        }
        
        .role-admin {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .role-user {
            background: #f0f9ff;
            color: #0284c7;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status-active {
            background: #f0fdf4;
            color: #16a34a;
        }
        
        .status-inactive {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .action-btn-edit {
            background: #f3f4f6;
            color: #374151;
        }
        
        .action-btn-edit:hover {
            background: #e5e7eb;
        }
        
        .action-btn-delete {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .action-btn-delete:hover {
            background: #fee2e2;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            padding: 20px;
            background: #f9fafb;
        }
        
        .pagination button {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .pagination button:hover:not(:disabled) {
            background: #f3f4f6;
        }
        
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination .active {
            background: #dc2626;
            color: white;
            border-color: #dc2626;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.9rem;
            background: white;
            transition: border-color 0.2s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .sla-config-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .sla-config-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .sla-config-section h3 {
            margin-bottom: 15px;
            color: #1f2937;
            font-size: 1.1rem;
        }

        .bulk-assign-info {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #dc2626;
        }

        /* Bulk Actions Styles */
        .bulk-actions-info {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #dc2626;
        }

        .bulk-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .bulk-actions-grid .btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 20px;
            text-align: center;
            min-height: 80px;
        }

        /* Saved Filters Styles */
        .saved-filters-section {
            margin-bottom: 30px;
        }

        .saved-filters-section h3 {
            margin-bottom: 15px;
            color: #1f2937;
            font-size: 1.1rem;
        }

        .saved-filters-list {
            display: grid;
            gap: 10px;
        }

        .saved-filter-item {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }

        .saved-filter-item:hover {
            background: #f1f5f9;
            border-color: #dc2626;
        }

        .saved-filter-info h4 {
            margin: 0 0 5px 0;
            color: #1f2937;
            font-size: 0.9rem;
        }

        .saved-filter-info p {
            margin: 0;
            color: #6b7280;
            font-size: 0.8rem;
        }

        .saved-filter-actions {
            display: flex;
            gap: 8px;
        }

        .save-current-filter {
            border-top: 1px solid #e5e7eb;
            padding-top: 20px;
        }

        .save-current-filter h3 {
            margin-bottom: 15px;
            color: #1f2937;
            font-size: 1.1rem;
        }

        /* Audit Log Styles */
        .audit-log-filters {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .filter-row select,
        .filter-row input {
            min-width: 150px;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .audit-log-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .audit-log-entry {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .audit-log-entry:hover {
            background: #f9fafb;
        }

        .audit-log-info {
            flex: 1;
        }

        .audit-log-info h4 {
            margin: 0 0 5px 0;
            color: #1f2937;
            font-size: 0.9rem;
        }

        .audit-log-info p {
            margin: 0;
            color: #6b7280;
            font-size: 0.8rem;
        }

        .audit-log-meta {
            text-align: right;
            color: #9ca3af;
            font-size: 0.8rem;
        }

        .audit-log-meta .timestamp {
            display: block;
            margin-bottom: 5px;
        }

        .audit-log-meta .user {
            font-weight: 600;
        }

        /* Action Badges */
        .action-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .action-badge-created {
            background: #d1fae5;
            color: #065f46;
        }

        .action-badge-updated {
            background: #dbeafe;
            color: #1e40af;
        }

        .action-badge-deleted {
            background: #fee2e2;
            color: #991b1b;
        }

        .action-badge-login {
            background: #fef3c7;
            color: #92400e;
        }

        .action-badge-logout {
            background: #e5e7eb;
            color: #374151;
        }

        /* Triage Queue Styles */
        .triage-queue-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin: 20px;
            overflow: hidden;
        }

        .sla-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px;
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
        }

        .sla-metric {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #dc2626;
        }

        .sla-metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .sla-metric-header h4 {
            margin: 0;
            color: #1f2937;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .sla-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .sla-status.sla-good {
            background: #d1fae5;
            color: #065f46;
        }

        .sla-status.sla-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .sla-status.sla-critical {
            background: #fee2e2;
            color: #991b1b;
        }

        .sla-metric-value {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .sla-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: #dc2626;
        }

        .sla-target {
            font-size: 0.8rem;
            color: #6b7280;
        }

        .triage-controls {
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
            background: #f9fafb;
        }

        .queue-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-size: 0.8rem;
            font-weight: 600;
            color: #374151;
        }

        .filter-group select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.9rem;
            background: white;
        }

        .filter-group select:focus {
            outline: none;
            border-color: #dc2626;
        }

        .queue-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .triage-table-container {
            overflow-x: auto;
        }

        .triage-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .triage-table th {
            background: #f8fafc;
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
            white-space: nowrap;
        }

        .triage-table td {
            padding: 16px 12px;
            border-bottom: 1px solid #f3f4f6;
            vertical-align: middle;
        }

        .triage-table tbody tr:hover {
            background: #f9fafb;
        }

        .triage-table tbody tr.selected {
            background: #fef2f2;
        }

        .case-id {
            font-family: monospace;
            font-weight: 600;
            color: #dc2626;
        }

        .priority-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-critical {
            background: #fee2e2;
            color: #991b1b;
        }

        .priority-high {
            background: #fef3c7;
            color: #92400e;
        }

        .priority-medium {
            background: #dbeafe;
            color: #1e40af;
        }

        .priority-low {
            background: #d1fae5;
            color: #065f46;
        }

        .case-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .case-status-new {
            background: #e5e7eb;
            color: #374151;
        }

        .case-status-in_progress {
            background: #dbeafe;
            color: #1e40af;
        }

        .case-status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .case-status-resolved {
            background: #d1fae5;
            color: #065f46;
        }

        .case-status-closed {
            background: #f3f4f6;
            color: #6b7280;
        }

        .sla-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .sla-indicator.on_track {
            background: #d1fae5;
            color: #065f46;
        }

        .sla-indicator.at_risk {
            background: #fef3c7;
            color: #92400e;
        }

        .sla-indicator.breached {
            background: #fee2e2;
            color: #991b1b;
        }

        .sla-indicator::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
        }

        .case-actions {
            display: flex;
            gap: 5px;
        }

        .case-action-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .case-action-btn-edit {
            background: #f3f4f6;
            color: #374151;
        }

        .case-action-btn-edit:hover {
            background: #e5e7eb;
        }

        .case-action-btn-assign {
            background: #dbeafe;
            color: #1e40af;
        }

        .case-action-btn-assign:hover {
            background: #bfdbfe;
        }

        .case-action-btn-escalate {
            background: #fee2e2;
            color: #991b1b;
        }

        .case-action-btn-escalate:hover {
            background: #fecaca;
        }

        /* System Health Styles */
        .system-health-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin: 20px;
            overflow: hidden;
        }

        .health-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px;
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
        }

        .health-metric {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #dc2626;
        }

        .health-metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .health-metric-header h4 {
            margin: 0;
            color: #1f2937;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .health-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .health-status.health-good {
            background: #d1fae5;
            color: #065f46;
        }

        .health-status.health-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .health-status.health-critical {
            background: #fee2e2;
            color: #991b1b;
        }

        .health-metric-value {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .health-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: #dc2626;
        }

        .health-target {
            font-size: 0.8rem;
            color: #6b7280;
        }

        .service-status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .service-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.2s ease;
        }

        .service-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .service-header h4 {
            margin: 0;
            color: #1f2937;
            font-size: 1rem;
            font-weight: 600;
        }

        .service-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .service-status.service-online {
            background: #d1fae5;
            color: #065f46;
        }

        .service-status.service-offline {
            background: #fee2e2;
            color: #991b1b;
        }

        .service-status.service-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .service-details {
            margin-bottom: 15px;
        }

        .service-details p {
            margin: 5px 0;
            font-size: 0.9rem;
            color: #6b7280;
        }

        .service-actions {
            display: flex;
            gap: 8px;
        }

        .health-quick-actions {
            padding: 20px;
            border-top: 1px solid #e5e7eb;
            background: #f9fafb;
        }

        .health-quick-actions h3 {
            margin: 0 0 15px 0;
            color: #1f2937;
            font-size: 1.1rem;
        }

        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .quick-actions-grid .btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 15px 10px;
            text-align: center;
            min-height: 60px;
        }

        /* Moderation Queue Styles */
        .moderation-queue-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin: 20px;
            overflow: hidden;
        }

        .moderation-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px;
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
        }

        .moderation-metric {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #dc2626;
        }

        .moderation-metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .moderation-metric-header h4 {
            margin: 0;
            color: #1f2937;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .moderation-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .moderation-status.moderation-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .moderation-status.moderation-approved {
            background: #d1fae5;
            color: #065f46;
        }

        .moderation-status.moderation-rejected {
            background: #fee2e2;
            color: #991b1b;
        }

        .moderation-status.moderation-good {
            background: #d1fae5;
            color: #065f46;
        }

        .moderation-metric-value {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .moderation-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: #dc2626;
        }

        .moderation-target {
            font-size: 0.8rem;
            color: #6b7280;
        }

        .moderation-controls {
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
            background: #f9fafb;
        }

        .moderation-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .moderation-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .moderation-table-container {
            overflow-x: auto;
        }

        .moderation-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .moderation-table th {
            background: #f8fafc;
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
            white-space: nowrap;
        }

        .moderation-table td {
            padding: 16px 12px;
            border-bottom: 1px solid #f3f4f6;
            vertical-align: middle;
        }

        .moderation-table tbody tr:hover {
            background: #f9fafb;
        }

        .moderation-table tbody tr.selected {
            background: #fef2f2;
        }

        .content-id {
            font-family: monospace;
            font-weight: 600;
            color: #dc2626;
        }

        .content-type-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .content-type-case_report {
            background: #dbeafe;
            color: #1e40af;
        }

        .content-type-user_profile {
            background: #d1fae5;
            color: #065f46;
        }

        .content-type-comment {
            background: #fef3c7;
            color: #92400e;
        }

        .content-type-image {
            background: #e0e7ff;
            color: #3730a3;
        }

        .content-type-document {
            background: #f3f4f6;
            color: #374151;
        }

        .content-preview {
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .moderation-status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .moderation-status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .moderation-status-in_review {
            background: #dbeafe;
            color: #1e40af;
        }

        .moderation-status-approved {
            background: #d1fae5;
            color: #065f46;
        }

        .moderation-status-rejected {
            background: #fee2e2;
            color: #991b1b;
        }

        .moderation-status-flagged {
            background: #fecaca;
            color: #7f1d1d;
        }

        .moderation-actions {
            display: flex;
            gap: 5px;
        }

        .moderation-action-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .moderation-action-btn-approve {
            background: #d1fae5;
            color: #065f46;
        }

        .moderation-action-btn-approve:hover {
            background: #a7f3d0;
        }

        .moderation-action-btn-reject {
            background: #fee2e2;
            color: #991b1b;
        }

        .moderation-action-btn-reject:hover {
            background: #fecaca;
        }

        .moderation-action-btn-flag {
            background: #fef3c7;
            color: #92400e;
        }

        .moderation-action-btn-flag:hover {
            background: #fde68a;
        }

        .moderation-action-btn-review {
            background: #dbeafe;
            color: #1e40af;
        }

        .moderation-action-btn-review:hover {
            background: #bfdbfe;
        }

        /* Notifications & Escalation Styles */
        .notifications-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin: 20px;
            overflow: hidden;
        }

        .notification-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px;
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
        }

        .notification-metric {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #dc2626;
        }

        .notification-metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .notification-metric-header h4 {
            margin: 0;
            color: #1f2937;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .notification-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .notification-status.notification-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .notification-status.notification-sent {
            background: #d1fae5;
            color: #065f46;
        }

        .notification-status.notification-good {
            background: #d1fae5;
            color: #065f46;
        }

        .notification-metric-value {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .notification-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: #dc2626;
        }

        .notification-target {
            font-size: 0.8rem;
            color: #6b7280;
        }

        .notification-channels {
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .notification-channels h3 {
            margin: 0 0 20px 0;
            color: #1f2937;
            font-size: 1.1rem;
        }

        .channels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .channel-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.2s ease;
        }

        .channel-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .channel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .channel-header h4 {
            margin: 0;
            color: #1f2937;
            font-size: 1rem;
            font-weight: 600;
        }

        .channel-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .channel-status.channel-active {
            background: #d1fae5;
            color: #065f46;
        }

        .channel-status.channel-inactive {
            background: #fee2e2;
            color: #991b1b;
        }

        .channel-stats {
            margin-bottom: 15px;
        }

        .channel-stats p {
            margin: 5px 0;
            font-size: 0.9rem;
            color: #6b7280;
        }

        .channel-actions {
            display: flex;
            gap: 8px;
        }

        .notification-queue {
            padding: 20px;
        }

        .notification-queue h3 {
            margin: 0 0 20px 0;
            color: #1f2937;
            font-size: 1.1rem;
        }

        .queue-controls {
            margin-bottom: 20px;
        }

        .queue-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .queue-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .notification-table-container {
            overflow-x: auto;
        }

        .notification-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .notification-table th {
            background: #f8fafc;
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
            white-space: nowrap;
        }

        .notification-table td {
            padding: 16px 12px;
            border-bottom: 1px solid #f3f4f6;
            vertical-align: middle;
        }

        .notification-table tbody tr:hover {
            background: #f9fafb;
        }

        .notification-table tbody tr.selected {
            background: #fef2f2;
        }

        .message-id {
            font-family: monospace;
            font-weight: 600;
            color: #dc2626;
        }

        .channel-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .channel-badge.email {
            background: #dbeafe;
            color: #1e40af;
        }

        .channel-badge.sms {
            background: #d1fae5;
            color: #065f46;
        }

        .channel-badge.push {
            background: #fef3c7;
            color: #92400e;
        }

        .channel-badge.in_app {
            background: #e0e7ff;
            color: #3730a3;
        }

        .notification-priority-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .notification-priority-urgent {
            background: #fee2e2;
            color: #991b1b;
        }

        .notification-priority-high {
            background: #fef3c7;
            color: #92400e;
        }

        .notification-priority-normal {
            background: #dbeafe;
            color: #1e40af;
        }

        .notification-priority-low {
            background: #d1fae5;
            color: #065f46;
        }

        .notification-status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .notification-status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .notification-status-sent {
            background: #dbeafe;
            color: #1e40af;
        }

        .notification-status-delivered {
            background: #d1fae5;
            color: #065f46;
        }

        .notification-status-failed {
            background: #fee2e2;
            color: #991b1b;
        }

        .notification-status-read {
            background: #f3f4f6;
            color: #6b7280;
        }

        .notification-actions {
            display: flex;
            gap: 5px;
        }

        .notification-action-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .notification-action-btn-send {
            background: #d1fae5;
            color: #065f46;
        }

        .notification-action-btn-send:hover {
            background: #a7f3d0;
        }

        .notification-action-btn-cancel {
            background: #fee2e2;
            color: #991b1b;
        }

        .notification-action-btn-cancel:hover {
            background: #fecaca;
        }

        .notification-action-btn-view {
            background: #dbeafe;
            color: #1e40af;
        }

        .notification-action-btn-view:hover {
            background: #bfdbfe;
        }

        /* Data Quality & Duplicate Detection Styles */
        .data-quality-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin: 20px;
            overflow: hidden;
        }

        .data-quality-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px;
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
        }

        .quality-metric {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #dc2626;
        }

        .quality-metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .quality-metric-header h4 {
            margin: 0;
            color: #1f2937;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .quality-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .quality-status.quality-good {
            background: #d1fae5;
            color: #065f46;
        }

        .quality-status.quality-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .quality-status.quality-critical {
            background: #fee2e2;
            color: #991b1b;
        }

        .quality-metric-value {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .quality-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: #dc2626;
        }

        .quality-target {
            font-size: 0.8rem;
            color: #6b7280;
        }

        .data-quality-issues {
            padding: 20px;
        }

        .data-quality-issues h3 {
            margin: 0 0 20px 0;
            color: #1f2937;
            font-size: 1.1rem;
        }

        .issues-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .tab-btn {
            padding: 10px 20px;
            border: none;
            background: transparent;
            color: #6b7280;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .tab-btn:hover {
            color: #dc2626;
        }

        .tab-btn.active {
            color: #dc2626;
            border-bottom-color: #dc2626;
        }

        .quality-tab-content {
            display: none;
        }

        .quality-tab-content.active {
            display: block;
        }

        .duplicates-controls,
        .incomplete-controls,
        .invalid-controls,
        .inconsistent-controls {
            margin-bottom: 20px;
        }

        .duplicate-filters,
        .incomplete-filters,
        .invalid-filters,
        .inconsistent-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .duplicate-actions,
        .incomplete-actions,
        .invalid-actions,
        .inconsistent-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .duplicates-table-container,
        .incomplete-table-container,
        .invalid-table-container,
        .inconsistent-table-container {
            overflow-x: auto;
        }

        .duplicates-table,
        .incomplete-table,
        .invalid-table,
        .inconsistent-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .duplicates-table th,
        .incomplete-table th,
        .invalid-table th,
        .inconsistent-table th {
            background: #f8fafc;
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
            white-space: nowrap;
        }

        .duplicates-table td,
        .incomplete-table td,
        .invalid-table td,
        .inconsistent-table td {
            padding: 16px 12px;
            border-bottom: 1px solid #f3f4f6;
            vertical-align: middle;
        }

        .duplicates-table tbody tr:hover,
        .incomplete-table tbody tr:hover,
        .invalid-table tbody tr:hover,
        .inconsistent-table tbody tr:hover {
            background: #f9fafb;
        }

        .duplicates-table tbody tr.selected,
        .incomplete-table tbody tr.selected,
        .invalid-table tbody tr.selected,
        .inconsistent-table tbody tr.selected {
            background: #fef2f2;
        }

        .record-type-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            background: #dbeafe;
            color: #1e40af;
        }

        .record-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .record-info strong {
            color: #dc2626;
            font-family: monospace;
        }

        .record-info small {
            color: #6b7280;
        }

        .similarity-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .similarity-badge.similarity-high {
            background: #fee2e2;
            color: #991b1b;
        }

        .similarity-badge.similarity-medium {
            background: #fef3c7;
            color: #92400e;
        }

        .similarity-badge.similarity-low {
            background: #d1fae5;
            color: #065f46;
        }

        .confidence-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .confidence-badge.confidence-high {
            background: #fee2e2;
            color: #991b1b;
        }

        .confidence-badge.confidence-medium {
            background: #fef3c7;
            color: #92400e;
        }

        .confidence-badge.confidence-low {
            background: #d1fae5;
            color: #065f46;
        }

        .completeness-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .completeness-badge.completeness-good {
            background: #d1fae5;
            color: #065f46;
        }

        .completeness-badge.completeness-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .completeness-badge.completeness-critical {
            background: #fee2e2;
            color: #991b1b;
        }

        .severity-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .severity-badge.severity-critical {
            background: #fee2e2;
            color: #991b1b;
        }

        .severity-badge.severity-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .severity-badge.severity-info {
            background: #dbeafe;
            color: #1e40af;
        }

        .impact-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .impact-badge.impact-high {
            background: #fee2e2;
            color: #991b1b;
        }

        .impact-badge.impact-medium {
            background: #fef3c7;
            color: #92400e;
        }

        .impact-badge.impact-low {
            background: #d1fae5;
            color: #065f46;
        }

        .missing-fields {
            color: #6b7280;
            font-size: 0.8rem;
        }

        .validation-rule,
        .consistency-rule {
            color: #374151;
            font-weight: 500;
        }

        .issue-description {
            color: #6b7280;
            font-size: 0.8rem;
        }

        .duplicate-actions,
        .incomplete-actions,
        .invalid-actions,
        .inconsistent-actions {
            display: flex;
            gap: 5px;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 0.8rem;
        }
    </style>
    
    <!-- Main Dashboard Styles -->
    <style>
        /* ===== MAIN DASHBOARD STYLES ===== */
        
        /* Dashboard Container */
        .admin-dashboard {
            min-height: 100vh;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            background-attachment: fixed;
            padding: 20px;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
        }
        
        /* Dashboard Header */
        .dashboard-header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            text-align: center;
            position: relative;
            z-index: 10;
        }
        
        .admin-profile {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .admin-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #dc2626, #991b1b);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: bold;
            box-shadow: 0 4px 16px rgba(220, 38, 38, 0.3);
            flex-shrink: 0;
        }
        
        .admin-info h1 {
            margin: 0;
            color: #1f2937;
            font-size: 2.5rem;
            font-weight: bold;
            line-height: 1.2;
        }
        
        .admin-info p {
            margin: 5px 0 0 0;
            color: #6b7280;
            font-size: 1.1rem;
        }
        
        /* Live Indicator */
        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #059669;
            font-weight: 600;
            font-size: 0.9rem;
            margin: 10px 0;
        }
        
        .live-dot {
            width: 8px;
            height: 8px;
            background-color: #059669;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(5, 150, 105, 0.7);
            }
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(5, 150, 105, 0);
            }
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(5, 150, 105, 0);
            }
        }
        
        .last-updated {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
        
        /* Action Buttons */
        .logout-button, .refresh-button, .hard-refresh-button {
            background: #dc2626;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin: 5px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .logout-button:hover, .refresh-button:hover, .hard-refresh-button:hover {
            background: #b91c1c;
            transform: translateY(-1px);
        }
        
        .hard-refresh-button {
            background: #6b7280;
        }
        
        .hard-refresh-button:hover {
            background: #4b5563;
        }
        
        /* Dashboard Statistics */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
            width: 100%;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        }
        
        .stat-card.clickable {
            cursor: pointer;
        }
        
        .stat-card h3 {
            margin: 0 0 10px 0;
            color: #1f2937;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #dc2626;
            margin: 0;
        }
        
        .stat-card small {
            color: #6b7280;
            font-size: 0.9rem;
            display: block;
            margin-top: 5px;
        }
        
        /* Connection Status */
        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .connection-status.connected {
            background: rgba(5, 150, 105, 0.8);
        }
        
        .connection-status.disconnected {
            background: rgba(220, 38, 38, 0.8);
        }
        
        .connection-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            background: linear-gradient(135deg, #dc2626, #991b1b);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }
        
        .modal-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .modal-body {
            padding: 30px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 20px 30px;
            background-color: #f8f9fa;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background-color: #dc2626;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #b91c1c;
        }
        
        .btn-secondary {
            background-color: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #4b5563;
        }
        
        /* Admins List Styles */
        .admins-list {
            display: grid;
            gap: 15px;
        }
        
        .admin-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #dc2626;
            transition: all 0.3s ease;
        }
        
        .admin-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        .admin-item-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
            justify-content: space-between;
        }
        
        .admin-avatar-small {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #dc2626, #991b1b);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .admin-details h4 {
            margin: 0 0 5px 0;
            color: #1f2937;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .admin-details p {
            margin: 0;
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .admin-status {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 8px;
        }
        
        .admin-status.active {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .admin-status.inactive {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .admin-actions {
            display: flex;
            gap: 8px;
            margin-left: auto;
        }

        .admin-actions .btn {
            padding: 6px 10px;
            font-size: 0.8rem;
        }
        
        .admin-role {
            background-color: #dbeafe;
            color: #1e40af;
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 5px;
            display: inline-block;
        }
        
        /* Loading state for modal */
        .admins-list.loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        
        .admins-list.loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #dc2626;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .admin-dashboard {
                padding: 10px;
            }
            
            .dashboard-header {
                padding: 20px;
            }
            
            .admin-profile {
                flex-direction: column;
                text-align: center;
            }
            
            .admin-info h1 {
                font-size: 2rem;
            }
            
            .dashboard-stats {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
            
            .modal-header, .modal-body, .modal-footer {
                padding: 20px;
            }
            
            .admin-item-header {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .admin-info h1 {
                font-size: 1.5rem;
            }
            
            .stat-number {
                font-size: 2rem;
            }
            
            .modal-content {
                width: 98%;
                margin: 5% auto;
            }
        }
    </style>
</head>
<body>
    <div class="admin-dashboard" id="adminDashboard">
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <div class="admin-profile">
                <div class="admin-avatar" id="adminAvatar">
                    <!-- Will be populated by JavaScript -->
                </div>
                <div class="admin-info">
                    <h1 id="adminName">Admin Dashboard</h1>
                    <p id="adminEmail">Loading...</p>
                    <div class="live-indicator">
                        <div class="live-dot"></div>
                        <span>Live Database Connection</span>
                    </div>
                    <div class="last-updated">Last Updated: <span id="lastUpdated">Loading...</span></div>
                    <button id="logoutBtn" class="logout-button" onclick="logout()">
                        <span>🚪 Logout</span>
                    </button>
                    <button id="refreshBtn" class="refresh-button" onclick="refreshDashboard()">
                        <span>�� Refresh</span>
                    </button>
                    <button id="hardRefreshBtn" class="hard-refresh-button" onclick="hardRefresh()">
                        <span>💾 Hard Refresh</span>
                    </button>
                    <button id="auditLogBtn" class="btn btn-outline" onclick="openAuditLogModal()">
                        <span>📋 Audit Log</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Dashboard Stats -->
        <div class="dashboard-stats">
            <div class="stat-card">
                <h3>Total Users</h3>
                <p class="stat-number" id="totalUsers">-</p>
            </div>
            <div class="stat-card">
                <h3>Total Runners</h3>
                <p class="stat-number" id="totalRunners">-</p>
            </div>
            <div class="stat-card clickable" onclick="openAdminsModal()">
                <h3>Active Admins</h3>
                <p class="stat-number" id="activeAdmins">-</p>
                <small>👆 Click to view all admins</small>
            </div>
            <div class="stat-card">
                <h3>Public Cases</h3>
                <p class="stat-number" id="totalPublicCases">-</p>
            </div>
            <div class="stat-card">
                <h3>System Status</h3>
                <p class="stat-number" id="systemStatus">-</p>
            </div>
        </div>

        <!-- System Health Section -->
        <div class="system-health-section">
            <div class="section-header">
                <h2>🏥 System Health & Diagnostics</h2>
                <div class="section-actions">
                    <button class="btn btn-primary" onclick="runSystemDiagnostics()">
                        <span class="btn-icon">🔍</span>
                        Run Diagnostics
                    </button>
                    <button class="btn btn-warning" onclick="openHealthConfigModal()">
                        <span class="btn-icon">⚙️</span>
                        Health Config
                    </button>
                    <button class="btn btn-outline" onclick="exportHealthReport()">
                        <span class="btn-icon">📊</span>
                        Export Report
                    </button>
                    <button class="btn btn-secondary" onclick="refreshHealthStatus()">
                        <span class="btn-icon">🔄</span>
                        Refresh
                    </button>
                </div>
            </div>

            <!-- Health Overview -->
            <div class="health-overview">
                <div class="health-metric">
                    <div class="health-metric-header">
                        <h4>API Status</h4>
                        <span class="health-status health-good" id="apiStatus">Healthy</span>
                    </div>
                    <div class="health-metric-value">
                        <span class="health-number" id="apiResponseTime">45ms</span>
                        <span class="health-target">Target: <100ms</span>
                    </div>
                </div>
                <div class="health-metric">
                    <div class="health-metric-header">
                        <h4>Database</h4>
                        <span class="health-status health-good" id="dbStatus">Connected</span>
                    </div>
                    <div class="health-metric-value">
                        <span class="health-number" id="dbConnections">12/50</span>
                        <span class="health-target">Active Connections</span>
                    </div>
                </div>
                <div class="health-metric">
                    <div class="health-metric-header">
                        <h4>Memory Usage</h4>
                        <span class="health-status health-warning" id="memoryStatus">Warning</span>
                    </div>
                    <div class="health-metric-value">
                        <span class="health-number" id="memoryUsage">78%</span>
                        <span class="health-target">2.1GB / 2.7GB</span>
                    </div>
                </div>
                <div class="health-metric">
                    <div class="health-metric-header">
                        <h4>CPU Usage</h4>
                        <span class="health-status health-good" id="cpuStatus">Normal</span>
                    </div>
                    <div class="health-metric-value">
                        <span class="health-number" id="cpuUsage">23%</span>
                        <span class="health-target">Average Load</span>
                    </div>
                </div>
            </div>

            <!-- Service Status Grid -->
            <div class="service-status-grid">
                <div class="service-card">
                    <div class="service-header">
                        <h4>🌐 Web Server</h4>
                        <span class="service-status service-online">Online</span>
                    </div>
                    <div class="service-details">
                        <p><strong>Uptime:</strong> 15d 8h 23m</p>
                        <p><strong>Requests/min:</strong> 1,247</p>
                        <p><strong>Error Rate:</strong> 0.02%</p>
                    </div>
                    <div class="service-actions">
                        <button class="btn btn-sm btn-outline" onclick="viewServiceLogs('webserver')">View Logs</button>
                        <button class="btn btn-sm btn-outline" onclick="restartService('webserver')">Restart</button>
                    </div>
                </div>

                <div class="service-card">
                    <div class="service-header">
                        <h4>🗄️ Database</h4>
                        <span class="service-status service-online">Online</span>
                    </div>
                    <div class="service-details">
                        <p><strong>Uptime:</strong> 15d 8h 23m</p>
                        <p><strong>Queries/min:</strong> 3,891</p>
                        <p><strong>Slow Queries:</strong> 12</p>
                    </div>
                    <div class="service-actions">
                        <button class="btn btn-sm btn-outline" onclick="viewServiceLogs('database')">View Logs</button>
                        <button class="btn btn-sm btn-outline" onclick="optimizeDatabase()">Optimize</button>
                    </div>
                </div>

                <div class="service-card">
                    <div class="service-header">
                        <h4>📧 Email Service</h4>
                        <span class="service-status service-online">Online</span>
                    </div>
                    <div class="service-details">
                        <p><strong>Uptime:</strong> 15d 8h 23m</p>
                        <p><strong>Emails/min:</strong> 23</p>
                        <p><strong>Queue Size:</strong> 0</p>
                    </div>
                    <div class="service-actions">
                        <button class="btn btn-sm btn-outline" onclick="viewServiceLogs('email')">View Logs</button>
                        <button class="btn btn-sm btn-outline" onclick="testEmailService()">Test</button>
                    </div>
                </div>

                <div class="service-card">
                    <div class="service-header">
                        <h4>📁 File Storage</h4>
                        <span class="service-status service-online">Online</span>
                    </div>
                    <div class="service-details">
                        <p><strong>Uptime:</strong> 15d 8h 23m</p>
                        <p><strong>Storage Used:</strong> 2.3GB / 10GB</p>
                        <p><strong>Files:</strong> 1,247</p>
                    </div>
                    <div class="service-actions">
                        <button class="btn btn-sm btn-outline" onclick="viewServiceLogs('storage')">View Logs</button>
                        <button class="btn btn-sm btn-outline" onclick="cleanupStorage()">Cleanup</button>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="health-quick-actions">
                <h3>Quick Actions</h3>
                <div class="quick-actions-grid">
                    <button class="btn btn-outline" onclick="openSwaggerDocs()">
                        <span class="btn-icon">📚</span>
                        Swagger Docs
                    </button>
                    <button class="btn btn-outline" onclick="viewSystemLogs()">
                        <span class="btn-icon">📋</span>
                        System Logs
                    </button>
                    <button class="btn btn-outline" onclick="checkSSLStatus()">
                        <span class="btn-icon">🔒</span>
                        SSL Status
                    </button>
                    <button class="btn btn-outline" onclick="testAPIConnectivity()">
                        <span class="btn-icon">🔗</span>
                        API Test
                    </button>
                    <button class="btn btn-outline" onclick="viewPerformanceMetrics()">
                        <span class="btn-icon">📈</span>
                        Performance
                    </button>
                    <button class="btn btn-outline" onclick="backupDatabase()">
                        <span class="btn-icon">💾</span>
                        Backup DB
                    </button>
                </div>
            </div>
        </div>

        <!-- Moderation Queue Section -->
        <div class="moderation-queue-section">
            <div class="section-header">
                <h2>🛡️ Moderation Queue & Content Management</h2>
                <div class="section-actions">
                    <button class="btn btn-primary" onclick="openContentReviewModal()">
                        <span class="btn-icon">👁️</span>
                        Review Content
                    </button>
                    <button class="btn btn-warning" onclick="openModerationConfigModal()">
                        <span class="btn-icon">⚙️</span>
                        Moderation Rules
                    </button>
                    <button class="btn btn-outline" onclick="exportModerationReport()">
                        <span class="btn-icon">📊</span>
                        Export Report
                    </button>
                    <button class="btn btn-secondary" onclick="refreshModerationQueue()">
                        <span class="btn-icon">🔄</span>
                        Refresh
                    </button>
                </div>
            </div>

            <!-- Moderation Stats -->
            <div class="moderation-stats">
                <div class="moderation-metric">
                    <div class="moderation-metric-header">
                        <h4>Pending Review</h4>
                        <span class="moderation-status moderation-pending" id="pendingReviewStatus">High</span>
                    </div>
                    <div class="moderation-metric-value">
                        <span class="moderation-number" id="pendingReviewCount">23</span>
                        <span class="moderation-target">Items awaiting review</span>
                    </div>
                </div>
                <div class="moderation-metric">
                    <div class="moderation-metric-header">
                        <h4>Approved Today</h4>
                        <span class="moderation-status moderation-approved" id="approvedTodayStatus">Good</span>
                    </div>
                    <div class="moderation-metric-value">
                        <span class="moderation-number" id="approvedTodayCount">47</span>
                        <span class="moderation-target">Items approved</span>
                    </div>
                </div>
                <div class="moderation-metric">
                    <div class="moderation-metric-header">
                        <h4>Rejected Today</h4>
                        <span class="moderation-status moderation-rejected" id="rejectedTodayStatus">Low</span>
                    </div>
                    <div class="moderation-metric-value">
                        <span class="moderation-number" id="rejectedTodayCount">8</span>
                        <span class="moderation-target">Items rejected</span>
                    </div>
                </div>
                <div class="moderation-metric">
                    <div class="moderation-metric-header">
                        <h4>Response Time</h4>
                        <span class="moderation-status moderation-good" id="moderationResponseStatus">Good</span>
                    </div>
                    <div class="moderation-metric-value">
                        <span class="moderation-number" id="moderationResponseTime">2.1h</span>
                        <span class="moderation-target">Average review time</span>
                    </div>
                </div>
            </div>

            <!-- Moderation Queue Controls -->
            <div class="moderation-controls">
                <div class="moderation-filters">
                    <div class="filter-group">
                        <label>Content Type</label>
                        <select id="contentTypeFilter" onchange="filterModerationQueue()">
                            <option value="">All Types</option>
                            <option value="case_report">Case Reports</option>
                            <option value="user_profile">User Profiles</option>
                            <option value="comment">Comments</option>
                            <option value="image">Images</option>
                            <option value="document">Documents</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Priority</label>
                        <select id="moderationPriorityFilter" onchange="filterModerationQueue()">
                            <option value="">All Priorities</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Status</label>
                        <select id="moderationStatusFilter" onchange="filterModerationQueue()">
                            <option value="">All Statuses</option>
                            <option value="pending">Pending</option>
                            <option value="in_review">In Review</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                            <option value="flagged">Flagged</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Reviewer</label>
                        <select id="moderationReviewerFilter" onchange="filterModerationQueue()">
                            <option value="">All Reviewers</option>
                            <option value="unassigned">Unassigned</option>
                        </select>
                    </div>
                </div>
                <div class="moderation-actions">
                    <button class="btn btn-warning" onclick="bulkApproveContent()">
                        <span class="btn-icon">✅</span>
                        Bulk Approve
                    </button>
                    <button class="btn btn-danger" onclick="bulkRejectContent()">
                        <span class="btn-icon">❌</span>
                        Bulk Reject
                    </button>
                    <button class="btn btn-outline" onclick="bulkFlagContent()">
                        <span class="btn-icon">🚩</span>
                        Bulk Flag
                    </button>
                </div>
            </div>

            <!-- Moderation Queue Table -->
            <div class="moderation-table-container">
                <table class="moderation-table" id="moderationTable">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAllModeration" onchange="toggleSelectAllModeration()"></th>
                            <th>Content ID</th>
                            <th>Type</th>
                            <th>Content Preview</th>
                            <th>Submitted By</th>
                            <th>Priority</th>
                            <th>Status</th>
                            <th>Reviewer</th>
                            <th>Submitted</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="moderationTableBody">
                        <!-- Content will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Notifications & Escalation Section -->
        <div class="notifications-section">
            <div class="section-header">
                <h2>📢 Notifications & Escalation Management</h2>
                <div class="section-actions">
                    <button class="btn btn-primary" onclick="openNotificationComposer()">
                        <span class="btn-icon">✉️</span>
                        Compose Message
                    </button>
                    <button class="btn btn-warning" onclick="openEscalationConfigModal()">
                        <span class="btn-icon">⚙️</span>
                        Escalation Rules
                    </button>
                    <button class="btn btn-outline" onclick="openTemplateManager()">
                        <span class="btn-icon">📝</span>
                        Message Templates
                    </button>
                    <button class="btn btn-secondary" onclick="refreshNotifications()">
                        <span class="btn-icon">🔄</span>
                        Refresh
                    </button>
                </div>
            </div>

            <!-- Notification Stats -->
            <div class="notification-stats">
                <div class="notification-metric">
                    <div class="notification-metric-header">
                        <h4>Pending Notifications</h4>
                        <span class="notification-status notification-pending" id="pendingNotificationsStatus">High</span>
                    </div>
                    <div class="notification-metric-value">
                        <span class="notification-number" id="pendingNotificationsCount">15</span>
                        <span class="notification-target">Messages awaiting delivery</span>
                    </div>
                </div>
                <div class="notification-metric">
                    <div class="notification-metric-header">
                        <h4>Sent Today</h4>
                        <span class="notification-status notification-sent" id="sentTodayStatus">Good</span>
                    </div>
                    <div class="notification-metric-value">
                        <span class="notification-number" id="sentTodayCount">127</span>
                        <span class="notification-target">Messages delivered</span>
                    </div>
                </div>
                <div class="notification-metric">
                    <div class="notification-metric-header">
                        <h4>Delivery Rate</h4>
                        <span class="notification-status notification-good" id="deliveryRateStatus">Excellent</span>
                    </div>
                    <div class="notification-metric-value">
                        <span class="notification-number" id="deliveryRate">98.2%</span>
                        <span class="notification-target">Successful deliveries</span>
                    </div>
                </div>
                <div class="notification-metric">
                    <div class="notification-metric-header">
                        <h4>Response Rate</h4>
                        <span class="notification-status notification-good" id="responseRateStatus">Good</span>
                    </div>
                    <div class="notification-metric-value">
                        <span class="notification-number" id="responseRate">67.5%</span>
                        <span class="notification-target">Recipient engagement</span>
                    </div>
                </div>
            </div>

            <!-- Notification Channels -->
            <div class="notification-channels">
                <h3>Communication Channels</h3>
                <div class="channels-grid">
                    <div class="channel-card">
                        <div class="channel-header">
                            <h4>📧 Email</h4>
                            <span class="channel-status channel-active">Active</span>
                        </div>
                        <div class="channel-stats">
                            <p><strong>Sent Today:</strong> 89</p>
                            <p><strong>Delivery Rate:</strong> 99.1%</p>
                            <p><strong>Open Rate:</strong> 72.3%</p>
                        </div>
                        <div class="channel-actions">
                            <button class="btn btn-sm btn-outline" onclick="testEmailChannel()">Test</button>
                            <button class="btn btn-sm btn-outline" onclick="configureEmailChannel()">Configure</button>
                        </div>
                    </div>

                    <div class="channel-card">
                        <div class="channel-header">
                            <h4>📱 SMS</h4>
                            <span class="channel-status channel-active">Active</span>
                        </div>
                        <div class="channel-stats">
                            <p><strong>Sent Today:</strong> 23</p>
                            <p><strong>Delivery Rate:</strong> 95.7%</p>
                            <p><strong>Response Rate:</strong> 78.3%</p>
                        </div>
                        <div class="channel-actions">
                            <button class="btn btn-sm btn-outline" onclick="testSMSChannel()">Test</button>
                            <button class="btn btn-sm btn-outline" onclick="configureSMSChannel()">Configure</button>
                        </div>
                    </div>

                    <div class="channel-card">
                        <div class="channel-header">
                            <h4>🔔 Push Notifications</h4>
                            <span class="channel-status channel-active">Active</span>
                        </div>
                        <div class="channel-stats">
                            <p><strong>Sent Today:</strong> 15</p>
                            <p><strong>Delivery Rate:</strong> 93.3%</p>
                            <p><strong>Click Rate:</strong> 45.2%</p>
                        </div>
                        <div class="channel-actions">
                            <button class="btn btn-sm btn-outline" onclick="testPushChannel()">Test</button>
                            <button class="btn btn-sm btn-outline" onclick="configurePushChannel()">Configure</button>
                        </div>
                    </div>

                    <div class="channel-card">
                        <div class="channel-header">
                            <h4>💬 In-App Messages</h4>
                            <span class="channel-status channel-active">Active</span>
                        </div>
                        <div class="channel-stats">
                            <p><strong>Sent Today:</strong> 34</p>
                            <p><strong>Delivery Rate:</strong> 100%</p>
                            <p><strong>Read Rate:</strong> 89.7%</p>
                        </div>
                        <div class="channel-actions">
                            <button class="btn btn-sm btn-outline" onclick="testInAppChannel()">Test</button>
                            <button class="btn btn-sm btn-outline" onclick="configureInAppChannel()">Configure</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notification Queue -->
            <div class="notification-queue">
                <h3>Notification Queue</h3>
                <div class="queue-controls">
                    <div class="queue-filters">
                        <div class="filter-group">
                            <label>Channel</label>
                            <select id="notificationChannelFilter" onchange="filterNotificationQueue()">
                                <option value="">All Channels</option>
                                <option value="email">Email</option>
                                <option value="sms">SMS</option>
                                <option value="push">Push</option>
                                <option value="in_app">In-App</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Status</label>
                            <select id="notificationStatusFilter" onchange="filterNotificationQueue()">
                                <option value="">All Statuses</option>
                                <option value="pending">Pending</option>
                                <option value="sent">Sent</option>
                                <option value="delivered">Delivered</option>
                                <option value="failed">Failed</option>
                                <option value="read">Read</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Priority</label>
                            <select id="notificationPriorityFilter" onchange="filterNotificationQueue()">
                                <option value="">All Priorities</option>
                                <option value="urgent">Urgent</option>
                                <option value="high">High</option>
                                <option value="normal">Normal</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                    <div class="queue-actions">
                        <button class="btn btn-warning" onclick="bulkSendNotifications()">
                            <span class="btn-icon">📤</span>
                            Bulk Send
                        </button>
                        <button class="btn btn-danger" onclick="bulkCancelNotifications()">
                            <span class="btn-icon">❌</span>
                            Bulk Cancel
                        </button>
                        <button class="btn btn-outline" onclick="exportNotificationReport()">
                            <span class="btn-icon">📊</span>
                            Export Report
                        </button>
                    </div>
                </div>

                <!-- Notification Table -->
                <div class="notification-table-container">
                    <table class="notification-table" id="notificationTable">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllNotifications" onchange="toggleSelectAllNotifications()"></th>
                                <th>Message ID</th>
                                <th>Channel</th>
                                <th>Recipient</th>
                                <th>Subject/Content</th>
                                <th>Priority</th>
                                <th>Status</th>
                                <th>Scheduled</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="notificationTableBody">
                            <!-- Notifications will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Data Quality Section -->
        <div class="data-quality-section">
            <div class="section-header">
                <h2>🔍 Data Quality & Duplicate Detection</h2>
                <div class="section-actions">
                    <button class="btn btn-primary" onclick="runDataQualityScan()">
                        <span class="btn-icon">🔍</span>
                        Scan for Issues
                    </button>
                    <button class="btn btn-warning" onclick="openDataQualityConfig()">
                        <span class="btn-icon">⚙️</span>
                        Quality Rules
                    </button>
                    <button class="btn btn-outline" onclick="exportDataQualityReport()">
                        <span class="btn-icon">📊</span>
                        Export Report
                    </button>
                    <button class="btn btn-secondary" onclick="refreshDataQuality()">
                        <span class="btn-icon">🔄</span>
                        Refresh
                    </button>
                </div>
            </div>

            <!-- Data Quality Overview -->
            <div class="data-quality-overview">
                <div class="quality-metric">
                    <div class="quality-metric-header">
                        <h4>Data Completeness</h4>
                        <span class="quality-status quality-good" id="dataCompletenessStatus">Good</span>
                    </div>
                    <div class="quality-metric-value">
                        <span class="quality-number" id="dataCompletenessRate">94.2%</span>
                        <span class="quality-target">Complete records</span>
                    </div>
                </div>
                <div class="quality-metric">
                    <div class="quality-metric-header">
                        <h4>Duplicate Records</h4>
                        <span class="quality-status quality-warning" id="duplicateRecordsStatus">Warning</span>
                    </div>
                    <div class="quality-metric-value">
                        <span class="quality-number" id="duplicateRecordsCount">23</span>
                        <span class="quality-target">Potential duplicates</span>
                    </div>
                </div>
                <div class="quality-metric">
                    <div class="quality-metric-header">
                        <h4>Data Accuracy</h4>
                        <span class="quality-status quality-good" id="dataAccuracyStatus">Good</span>
                    </div>
                    <div class="quality-metric-value">
                        <span class="quality-number" id="dataAccuracyRate">97.8%</span>
                        <span class="quality-target">Valid data</span>
                    </div>
                </div>
                <div class="quality-metric">
                    <div class="quality-metric-header">
                        <h4>Data Consistency</h4>
                        <span class="quality-status quality-good" id="dataConsistencyStatus">Good</span>
                    </div>
                    <div class="quality-metric-value">
                        <span class="quality-number" id="dataConsistencyRate">96.5%</span>
                        <span class="quality-target">Consistent records</span>
                    </div>
                </div>
            </div>

            <!-- Data Quality Issues -->
            <div class="data-quality-issues">
                <h3>Data Quality Issues</h3>
                <div class="issues-tabs">
                    <button class="tab-btn active" onclick="switchQualityTab('duplicates')">Duplicates</button>
                    <button class="tab-btn" onclick="switchQualityTab('incomplete')">Incomplete</button>
                    <button class="tab-btn" onclick="switchQualityTab('invalid')">Invalid</button>
                    <button class="tab-btn" onclick="switchQualityTab('inconsistent')">Inconsistent</button>
                </div>

                <!-- Duplicates Tab -->
                <div id="duplicates-tab" class="quality-tab-content active">
                    <div class="duplicates-controls">
                        <div class="duplicate-filters">
                            <div class="filter-group">
                                <label>Record Type</label>
                                <select id="duplicateTypeFilter" onchange="filterDuplicates()">
                                    <option value="">All Types</option>
                                    <option value="users">Users</option>
                                    <option value="cases">Cases</option>
                                    <option value="runners">Runners</option>
                                    <option value="reports">Reports</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Similarity</label>
                                <select id="duplicateSimilarityFilter" onchange="filterDuplicates()">
                                    <option value="">All Levels</option>
                                    <option value="high">High (90%+)</option>
                                    <option value="medium">Medium (70-89%)</option>
                                    <option value="low">Low (50-69%)</option>
                                </select>
                            </div>
                        </div>
                        <div class="duplicate-actions">
                            <button class="btn btn-warning" onclick="bulkMergeDuplicates()">
                                <span class="btn-icon">🔗</span>
                                Bulk Merge
                            </button>
                            <button class="btn btn-danger" onclick="bulkDeleteDuplicates()">
                                <span class="btn-icon">🗑️</span>
                                Bulk Delete
                            </button>
                            <button class="btn btn-outline" onclick="exportDuplicatesReport()">
                                <span class="btn-icon">📊</span>
                                Export Report
                            </button>
                        </div>
                    </div>

                    <!-- Duplicates Table -->
                    <div class="duplicates-table-container">
                        <table class="duplicates-table" id="duplicatesTable">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAllDuplicates" onchange="toggleSelectAllDuplicates()"></th>
                                    <th>Record Type</th>
                                    <th>Primary Record</th>
                                    <th>Duplicate Record</th>
                                    <th>Similarity</th>
                                    <th>Confidence</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="duplicatesTableBody">
                                <!-- Duplicates will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Incomplete Tab -->
                <div id="incomplete-tab" class="quality-tab-content">
                    <div class="incomplete-controls">
                        <div class="incomplete-filters">
                            <div class="filter-group">
                                <label>Missing Field</label>
                                <select id="missingFieldFilter" onchange="filterIncomplete()">
                                    <option value="">All Fields</option>
                                    <option value="email">Email</option>
                                    <option value="phone">Phone</option>
                                    <option value="address">Address</option>
                                    <option value="description">Description</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Record Type</label>
                                <select id="incompleteTypeFilter" onchange="filterIncomplete()">
                                    <option value="">All Types</option>
                                    <option value="users">Users</option>
                                    <option value="cases">Cases</option>
                                    <option value="runners">Runners</option>
                                </select>
                            </div>
                        </div>
                        <div class="incomplete-actions">
                            <button class="btn btn-primary" onclick="bulkUpdateIncomplete()">
                                <span class="btn-icon">✏️</span>
                                Bulk Update
                            </button>
                            <button class="btn btn-outline" onclick="exportIncompleteReport()">
                                <span class="btn-icon">📊</span>
                                Export Report
                            </button>
                        </div>
                    </div>

                    <!-- Incomplete Records Table -->
                    <div class="incomplete-table-container">
                        <table class="incomplete-table" id="incompleteTable">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAllIncomplete" onchange="toggleSelectAllIncomplete()"></th>
                                    <th>Record ID</th>
                                    <th>Type</th>
                                    <th>Missing Fields</th>
                                    <th>Completeness</th>
                                    <th>Last Updated</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="incompleteTableBody">
                                <!-- Incomplete records will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Invalid Tab -->
                <div id="invalid-tab" class="quality-tab-content">
                    <div class="invalid-controls">
                        <div class="invalid-filters">
                            <div class="filter-group">
                                <label>Validation Rule</label>
                                <select id="validationRuleFilter" onchange="filterInvalid()">
                                    <option value="">All Rules</option>
                                    <option value="email_format">Email Format</option>
                                    <option value="phone_format">Phone Format</option>
                                    <option value="date_range">Date Range</option>
                                    <option value="required_field">Required Field</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Severity</label>
                                <select id="invalidSeverityFilter" onchange="filterInvalid()">
                                    <option value="">All Levels</option>
                                    <option value="critical">Critical</option>
                                    <option value="warning">Warning</option>
                                    <option value="info">Info</option>
                                </select>
                            </div>
                        </div>
                        <div class="invalid-actions">
                            <button class="btn btn-warning" onclick="bulkFixInvalid()">
                                <span class="btn-icon">🔧</span>
                                Bulk Fix
                            </button>
                            <button class="btn btn-outline" onclick="exportInvalidReport()">
                                <span class="btn-icon">📊</span>
                                Export Report
                            </button>
                        </div>
                    </div>

                    <!-- Invalid Records Table -->
                    <div class="invalid-table-container">
                        <table class="invalid-table" id="invalidTable">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAllInvalid" onchange="toggleSelectAllInvalid()"></th>
                                    <th>Record ID</th>
                                    <th>Type</th>
                                    <th>Validation Rule</th>
                                    <th>Issue</th>
                                    <th>Severity</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="invalidTableBody">
                                <!-- Invalid records will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Inconsistent Tab -->
                <div id="inconsistent-tab" class="quality-tab-content">
                    <div class="inconsistent-controls">
                        <div class="inconsistent-filters">
                            <div class="filter-group">
                                <label>Consistency Rule</label>
                                <select id="consistencyRuleFilter" onchange="filterInconsistent()">
                                    <option value="">All Rules</option>
                                    <option value="data_format">Data Format</option>
                                    <option value="reference_integrity">Reference Integrity</option>
                                    <option value="business_rules">Business Rules</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Impact</label>
                                <select id="inconsistentImpactFilter" onchange="filterInconsistent()">
                                    <option value="">All Levels</option>
                                    <option value="high">High</option>
                                    <option value="medium">Medium</option>
                                    <option value="low">Low</option>
                                </select>
                            </div>
                        </div>
                        <div class="inconsistent-actions">
                            <button class="btn btn-primary" onclick="bulkResolveInconsistent()">
                                <span class="btn-icon">✅</span>
                                Bulk Resolve
                            </button>
                            <button class="btn btn-outline" onclick="exportInconsistentReport()">
                                <span class="btn-icon">📊</span>
                                Export Report
                            </button>
                        </div>
                    </div>

                    <!-- Inconsistent Records Table -->
                    <div class="inconsistent-table-container">
                        <table class="inconsistent-table" id="inconsistentTable">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAllInconsistent" onchange="toggleSelectAllInconsistent()"></th>
                                    <th>Record ID</th>
                                    <th>Type</th>
                                    <th>Consistency Rule</th>
                                    <th>Issue</th>
                                    <th>Impact</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="inconsistentTableBody">
                                <!-- Inconsistent records will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Triage Queue Section -->
        <div class="triage-queue-section">
            <div class="section-header">
                <h2>🚨 Triage Queue & SLA Management</h2>
                <div class="section-actions">
                    <button class="btn btn-primary" onclick="openNewCaseModal()">
                        <span class="btn-icon">➕</span>
                        New Case
                    </button>
                    <button class="btn btn-warning" onclick="openSLAConfigModal()">
                        <span class="btn-icon">⏱️</span>
                        SLA Config
                    </button>
                    <button class="btn btn-outline" onclick="exportTriageReport()">
                        <span class="btn-icon">📊</span>
                        Export Report
                    </button>
                    <button class="btn btn-secondary" onclick="refreshTriageQueue()">
                        <span class="btn-icon">🔄</span>
                        Refresh
                    </button>
                </div>
            </div>

            <!-- SLA Status Overview -->
            <div class="sla-overview">
                <div class="sla-metric">
                    <div class="sla-metric-header">
                        <h4>Response Time</h4>
                        <span class="sla-status sla-good" id="responseTimeStatus">Good</span>
                    </div>
                    <div class="sla-metric-value">
                        <span class="sla-number" id="avgResponseTime">2.3h</span>
                        <span class="sla-target">Target: 4h</span>
                    </div>
                </div>
                <div class="sla-metric">
                    <div class="sla-metric-header">
                        <h4>Resolution Time</h4>
                        <span class="sla-status sla-warning" id="resolutionTimeStatus">Warning</span>
                    </div>
                    <div class="sla-metric-value">
                        <span class="sla-number" id="avgResolutionTime">18.5h</span>
                        <span class="sla-target">Target: 24h</span>
                    </div>
                </div>
                <div class="sla-metric">
                    <div class="sla-metric-header">
                        <h4>Backlog Age</h4>
                        <span class="sla-status sla-critical" id="backlogAgeStatus">Critical</span>
                    </div>
                    <div class="sla-metric-value">
                        <span class="sla-number" id="avgBacklogAge">3.2d</span>
                        <span class="sla-target">Target: 2d</span>
                    </div>
                </div>
                <div class="sla-metric">
                    <div class="sla-metric-header">
                        <h4>SLA Compliance</h4>
                        <span class="sla-status sla-good" id="slaComplianceStatus">Good</span>
                    </div>
                    <div class="sla-metric-value">
                        <span class="sla-number" id="slaComplianceRate">87%</span>
                        <span class="sla-target">Target: 90%</span>
                    </div>
                </div>
            </div>

            <!-- Triage Queue Controls -->
            <div class="triage-controls">
                <div class="queue-filters">
                    <div class="filter-group">
                        <label>Priority</label>
                        <select id="priorityFilter" onchange="filterTriageQueue()">
                            <option value="">All Priorities</option>
                            <option value="critical">Critical</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Status</label>
                        <select id="caseStatusFilter" onchange="filterTriageQueue()">
                            <option value="">All Statuses</option>
                            <option value="new">New</option>
                            <option value="in_progress">In Progress</option>
                            <option value="pending">Pending</option>
                            <option value="resolved">Resolved</option>
                            <option value="closed">Closed</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Assigned To</label>
                        <select id="assignedToFilter" onchange="filterTriageQueue()">
                            <option value="">All Admins</option>
                            <option value="unassigned">Unassigned</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>SLA Status</label>
                        <select id="slaStatusFilter" onchange="filterTriageQueue()">
                            <option value="">All SLA Status</option>
                            <option value="on_track">On Track</option>
                            <option value="at_risk">At Risk</option>
                            <option value="breached">Breached</option>
                        </select>
                    </div>
                </div>
                <div class="queue-actions">
                    <button class="btn btn-warning" onclick="bulkAssignCases()">
                        <span class="btn-icon">👥</span>
                        Bulk Assign
                    </button>
                    <button class="btn btn-primary" onclick="bulkUpdatePriority()">
                        <span class="btn-icon">⚡</span>
                        Update Priority
                    </button>
                    <button class="btn btn-outline" onclick="bulkEscalateCases()">
                        <span class="btn-icon">🚨</span>
                        Escalate
                    </button>
                </div>
            </div>

            <!-- Triage Queue Table -->
            <div class="triage-table-container">
                <table class="triage-table" id="triageTable">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAllCases" onchange="toggleSelectAllCases()"></th>
                            <th>Case ID</th>
                            <th>Priority</th>
                            <th>Subject</th>
                            <th>Reporter</th>
                            <th>Assigned To</th>
                            <th>Status</th>
                            <th>SLA Status</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="triageTableBody">
                        <!-- Cases will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- User Management Section -->
        <div class="user-management-section">
            <div class="section-header">
                <h2>👥 User & Admin Management</h2>
                <div class="section-actions">
                    <button class="btn btn-primary" onclick="openInviteUserModal()">
                        <span class="btn-icon">📧</span>
                        Invite User
                    </button>
                    <button class="btn btn-warning" onclick="openBulkActionsModal()">
                        <span class="btn-icon">⚡</span>
                        Bulk Actions
                    </button>
                    <button class="btn btn-outline" onclick="openSavedFiltersModal()">
                        <span class="btn-icon">🔍</span>
                        Saved Filters
                    </button>
                    <button class="btn btn-secondary" onclick="refreshUsersData()">
                        <span class="btn-icon">🔄</span>
                        Refresh
                    </button>
                </div>
            </div>
            
            <!-- User Management Controls -->
            <div class="user-controls">
                <div class="search-filter-bar">
                    <div class="search-box">
                        <input type="text" id="userSearch" placeholder="Search users by name, email, or role..." onkeyup="filterUsers()">
                        <span class="search-icon">🔍</span>
                    </div>
                    <div class="filter-controls">
                        <select id="roleFilter" onchange="filterUsers()">
                            <option value="">All Roles</option>
                            <option value="admin">Admin</option>
                            <option value="user">User</option>
                        </select>
                        <select id="statusFilter" onchange="filterUsers()">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                </div>
                
                <div class="bulk-actions">
                    <button class="btn btn-outline" onclick="selectAllUsers()">Select All</button>
                    <button class="btn btn-outline" onclick="clearSelection()">Clear Selection</button>
                    <button class="btn btn-warning" onclick="bulkUpdateStatus()" disabled id="bulkStatusBtn">
                        <span class="btn-icon">⚡</span>
                        Update Status
                    </button>
                    <button class="btn btn-danger" onclick="bulkDeleteUsers()" disabled id="bulkDeleteBtn">
                        <span class="btn-icon">🗑️</span>
                        Delete Selected
                    </button>
                </div>
            </div>
            
            <!-- Users Table -->
            <div class="users-table-container">
                <table class="users-table" id="usersTable">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll()"></th>
                            <th>User</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th>Last Login</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <!-- Users will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            <div class="pagination" id="usersPagination">
                <!-- Pagination will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Admins Modal -->
    <div id="adminsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>All Admin Users</h2>
                <button class="modal-close" onclick="closeAdminsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="adminsList" class="admins-list">
                    <!-- Admin list will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAdminsModal()">Close</button>
                <button class="btn btn-primary" onclick="refreshAdminsList()">Refresh</button>
            </div>
        </div>
    </div>

    <!-- Invite User Modal -->
    <div id="inviteUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>📧 Invite New User</h2>
                <button class="modal-close" onclick="closeInviteUserModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="inviteUserForm" onsubmit="handleInviteUser(event)">
                    <div class="form-group">
                        <label for="inviteEmail">Email Address *</label>
                        <input type="email" id="inviteEmail" name="email" required 
                               placeholder="user@example.com" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="inviteFirstName">First Name *</label>
                        <input type="text" id="inviteFirstName" name="firstName" required 
                               placeholder="John" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="inviteLastName">Last Name *</label>
                        <input type="text" id="inviteLastName" name="lastName" required 
                               placeholder="Doe" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="inviteRole">Role *</label>
                        <select id="inviteRole" name="role" required class="form-control">
                            <option value="">Select Role</option>
                            <option value="user">User</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="inviteMessage">Welcome Message (Optional)</label>
                        <textarea id="inviteMessage" name="message" rows="3" 
                                  placeholder="Welcome to 241 Runners Awareness! You've been invited to join our platform..." 
                                  class="form-control"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeInviteUserModal()">Cancel</button>
                <button class="btn btn-primary" onclick="handleInviteUser()">Send Invitation</button>
            </div>
        </div>
    </div>

    <!-- Bulk Actions Modal -->
    <div id="bulkActionsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>⚡ Bulk Actions</h2>
                <button class="modal-close" onclick="closeBulkActionsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="bulk-actions-info">
                    <p><strong>Selected Users:</strong> <span id="bulkSelectedCount">0</span></p>
                </div>
                <div class="bulk-actions-grid">
                    <button class="btn btn-warning" onclick="bulkUpdateStatus('active')">
                        <span class="btn-icon">✅</span>
                        Activate Selected
                    </button>
                    <button class="btn btn-warning" onclick="bulkUpdateStatus('inactive')">
                        <span class="btn-icon">⏸️</span>
                        Deactivate Selected
                    </button>
                    <button class="btn btn-primary" onclick="bulkUpdateRole('admin')">
                        <span class="btn-icon">👑</span>
                        Promote to Admin
                    </button>
                    <button class="btn btn-secondary" onclick="bulkUpdateRole('user')">
                        <span class="btn-icon">👤</span>
                        Demote to User
                    </button>
                    <button class="btn btn-outline" onclick="bulkExportUsers()">
                        <span class="btn-icon">📊</span>
                        Export Selected
                    </button>
                    <button class="btn btn-danger" onclick="bulkDeleteUsers()">
                        <span class="btn-icon">🗑️</span>
                        Delete Selected
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeBulkActionsModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Saved Filters Modal -->
    <div id="savedFiltersModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>🔍 Saved Filters & Views</h2>
                <button class="modal-close" onclick="closeSavedFiltersModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="saved-filters-section">
                    <h3>My Saved Filters</h3>
                    <div id="savedFiltersList" class="saved-filters-list">
                        <!-- Saved filters will be populated here -->
                    </div>
                </div>
                <div class="save-current-filter">
                    <h3>Save Current Filter</h3>
                    <form id="saveFilterForm" onsubmit="handleSaveFilter(event)">
                        <div class="form-group">
                            <label for="filterName">Filter Name *</label>
                            <input type="text" id="filterName" name="name" required 
                                   placeholder="Active Admins" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="filterDescription">Description</label>
                            <input type="text" id="filterDescription" name="description" 
                                   placeholder="All active admin users" class="form-control">
                        </div>
                        <button type="submit" class="btn btn-primary">Save Filter</button>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSavedFiltersModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Audit Log Modal -->
    <div id="auditLogModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>📋 Audit Log</h2>
                <button class="modal-close" onclick="closeAuditLogModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="audit-log-filters">
                    <div class="filter-row">
                        <select id="auditActionFilter" onchange="filterAuditLog()">
                            <option value="">All Actions</option>
                            <option value="user_created">User Created</option>
                            <option value="user_updated">User Updated</option>
                            <option value="user_deleted">User Deleted</option>
                            <option value="role_changed">Role Changed</option>
                            <option value="login">Login</option>
                            <option value="logout">Logout</option>
                        </select>
                        <select id="auditUserFilter" onchange="filterAuditLog()">
                            <option value="">All Users</option>
                        </select>
                        <input type="date" id="auditDateFrom" onchange="filterAuditLog()" placeholder="From Date">
                        <input type="date" id="auditDateTo" onchange="filterAuditLog()" placeholder="To Date">
                    </div>
                </div>
                <div id="auditLogList" class="audit-log-list">
                    <!-- Audit log entries will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAuditLogModal()">Close</button>
                <button class="btn btn-outline" onclick="exportAuditLog()">Export Log</button>
            </div>
        </div>
    </div>

    <!-- New Case Modal -->
    <div id="newCaseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>➕ Create New Case</h2>
                <button class="modal-close" onclick="closeNewCaseModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="newCaseForm" onsubmit="handleCreateCase(event)">
                    <div class="form-group">
                        <label for="caseSubject">Subject *</label>
                        <input type="text" id="caseSubject" name="subject" required 
                               placeholder="Brief description of the issue" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="caseDescription">Description *</label>
                        <textarea id="caseDescription" name="description" rows="4" required 
                                  placeholder="Detailed description of the issue..." class="form-control"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="casePriority">Priority *</label>
                            <select id="casePriority" name="priority" required class="form-control">
                                <option value="">Select Priority</option>
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                                <option value="critical">Critical</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="caseCategory">Category</label>
                            <select id="caseCategory" name="category" class="form-control">
                                <option value="">Select Category</option>
                                <option value="technical">Technical Issue</option>
                                <option value="user_support">User Support</option>
                                <option value="security">Security</option>
                                <option value="feature_request">Feature Request</option>
                                <option value="bug_report">Bug Report</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="caseReporter">Reporter Email</label>
                            <input type="email" id="caseReporter" name="reporter" 
                                   placeholder="reporter@example.com" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="caseAssignee">Assign To</label>
                            <select id="caseAssignee" name="assignee" class="form-control">
                                <option value="">Unassigned</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeNewCaseModal()">Cancel</button>
                <button class="btn btn-primary" onclick="handleCreateCase()">Create Case</button>
            </div>
        </div>
    </div>

    <!-- SLA Configuration Modal -->
    <div id="slaConfigModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>⏱️ SLA Configuration</h2>
                <button class="modal-close" onclick="closeSLAConfigModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="sla-config-section">
                    <h3>Response Time Targets</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="slaResponseCritical">Critical Priority</label>
                            <input type="number" id="slaResponseCritical" name="responseCritical" 
                                   value="1" min="0" max="24" class="form-control">
                            <small>Hours</small>
                        </div>
                        <div class="form-group">
                            <label for="slaResponseHigh">High Priority</label>
                            <input type="number" id="slaResponseHigh" name="responseHigh" 
                                   value="4" min="0" max="24" class="form-control">
                            <small>Hours</small>
                        </div>
                        <div class="form-group">
                            <label for="slaResponseMedium">Medium Priority</label>
                            <input type="number" id="slaResponseMedium" name="responseMedium" 
                                   value="8" min="0" max="24" class="form-control">
                            <small>Hours</small>
                        </div>
                        <div class="form-group">
                            <label for="slaResponseLow">Low Priority</label>
                            <input type="number" id="slaResponseLow" name="responseLow" 
                                   value="24" min="0" max="72" class="form-control">
                            <small>Hours</small>
                        </div>
                    </div>
                </div>
                <div class="sla-config-section">
                    <h3>Resolution Time Targets</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="slaResolutionCritical">Critical Priority</label>
                            <input type="number" id="slaResolutionCritical" name="resolutionCritical" 
                                   value="4" min="0" max="48" class="form-control">
                            <small>Hours</small>
                        </div>
                        <div class="form-group">
                            <label for="slaResolutionHigh">High Priority</label>
                            <input type="number" id="slaResolutionHigh" name="resolutionHigh" 
                                   value="24" min="0" max="72" class="form-control">
                            <small>Hours</small>
                        </div>
                        <div class="form-group">
                            <label for="slaResolutionMedium">Medium Priority</label>
                            <input type="number" id="slaResolutionMedium" name="resolutionMedium" 
                                   value="72" min="0" max="168" class="form-control">
                            <small>Hours</small>
                        </div>
                        <div class="form-group">
                            <label for="slaResolutionLow">Low Priority</label>
                            <input type="number" id="slaResolutionLow" name="resolutionLow" 
                                   value="168" min="0" max="336" class="form-control">
                            <small>Hours</small>
                        </div>
                    </div>
                </div>
                <div class="sla-config-section">
                    <h3>Escalation Rules</h3>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="slaAutoEscalate" name="autoEscalate" checked>
                            Auto-escalate cases that breach SLA
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="slaEscalationDelay">Escalation Delay</label>
                        <input type="number" id="slaEscalationDelay" name="escalationDelay" 
                               value="2" min="0" max="24" class="form-control">
                        <small>Hours after SLA breach</small>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSLAConfigModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveSLAConfig()">Save Configuration</button>
            </div>
        </div>
    </div>

    <!-- Bulk Assign Cases Modal -->
    <div id="bulkAssignModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>👥 Bulk Assign Cases</h2>
                <button class="modal-close" onclick="closeBulkAssignModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="bulk-assign-info">
                    <p><strong>Selected Cases:</strong> <span id="bulkAssignCount">0</span></p>
                </div>
                <div class="form-group">
                    <label for="bulkAssignTo">Assign To</label>
                    <select id="bulkAssignTo" name="assignTo" class="form-control">
                        <option value="">Select Admin</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="bulkAssignNote">Assignment Note (Optional)</label>
                    <textarea id="bulkAssignNote" name="note" rows="3" 
                              placeholder="Reason for assignment..." class="form-control"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeBulkAssignModal()">Cancel</button>
                <button class="btn btn-primary" onclick="executeBulkAssign()">Assign Cases</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>
    
    <!-- Connection Status -->
    <div id="connectionStatus" class="connection-status">
        <div class="connection-dot"></div>
        <span id="connectionText">Connecting...</span>
    </div>
    
    <!-- Admin Authentication and Real-time Scripts -->
    <script src="/admin/assets/js/admin-auth.js?v=20250107"></script>
    <script src="/js/error-ui.js?v=20250108"></script>
    <script src="/admin/assets/js/admin-realtime.js?v=20250107"></script>
    <script src="/admin/assets/js/admin-profile.js?v=20250107"></script>
    <script src="/admin/assets/js/admin-monitoring.js?v=20250107"></script>
    <script src="/js/error-tracking.js?v=20250107"></script>
    
    <!-- Enhanced JavaScript with All Admin Functions -->
    <script>
        // ===== CONFIGURATION & INITIALIZATION =====
        
        // API Configuration - Fixed URL without trailing slash
        // Note: API_BASE_URL may be set by admin-auth.js, so we check for it first
        if (typeof API_BASE_URL === 'undefined') {
            window.API_BASE_URL = 'https://241runners-api.azurewebsites.net/api';
        }
        
        // Browser compatibility checks
        const isModernBrowser = (() => {
            try {
                return typeof fetch !== 'undefined' && 
                       typeof Promise !== 'undefined' && 
                       typeof localStorage !== 'undefined' &&
                       'classList' in document.createElement('div');
            } catch (e) {
                return false;
            }
        })();
        
        if (!isModernBrowser) {
            document.body.innerHTML = '<div class="no-support-message"><h2>Browser Not Supported</h2><p>Please use a modern browser like Chrome, Firefox, Safari, or Edge.</p></div>';
            throw new Error('Browser not supported');
        }
        
        // Global state management
        let currentAdmin = null;
        let dashboardData = {
            users: [],
            runners: [],
            admins: [],
            publicCases: [],
            systemStatus: 'loading'
        };
        let refreshInterval = null;
        let currentSection = null;
        
        // ===== UTILITY FUNCTIONS =====
        
        // Safe localStorage operations
        const storage = {
            get: (key, defaultValue = null) => {
                try {
                    const value = localStorage.getItem(key);
                    return value || defaultValue;
                } catch (e) {
                    console.warn('localStorage get error:', e);
                    return defaultValue;
                }
            },
            set: (key, value) => {
                try {
                    localStorage.setItem(key, typeof value === 'string' ? value : JSON.stringify(value));
                    return true;
                } catch (e) {
                    console.warn('localStorage set error:', e);
                    return false;
                }
            },
            remove: (key) => {
                try {
                    localStorage.removeItem(key);
                    return true;
                } catch (e) {
                    console.warn('localStorage remove error:', e);
                    return false;
                }
            }
        };
        
        // ===== AUTHENTICATION FUNCTIONS =====
        
        function clearAuthData() {
            try {
                console.log('🧹 Clearing authentication data...');
                const authKeys = [
                    'ra_admin_token', 'ra_admin_role', 'ra_admin_user',
                    'ra_user_token', 'ra_user_role', 'ra_user_data',
                    'admin_token', 'admin_role', 'admin_user'
                ];
                
                authKeys.forEach(key => {
                    storage.remove(key);
                });
                
                // Clear sessionStorage as well
                if (typeof sessionStorage !== 'undefined') {
                    authKeys.forEach(key => {
                        try {
                            sessionStorage.removeItem(key);
                        } catch (e) {
                            console.warn('sessionStorage remove error:', e);
                        }
                    });
                }
                
                console.log('✅ Authentication data cleared successfully');
            } catch (error) {
                console.error('❌ Error clearing authentication data:', error);
            }
        }
        
        function isAuthenticated() {
            console.log("🔍 isAuthenticated() called");
            const token = storage.get('ra_admin_token');
            console.log("🔍 Retrieved token:", token ? "Present (length: " + token.length + ")" : "Missing");
            const role = storage.get('ra_admin_role');
            
            console.log('🔐 Authentication check:', {
                hasToken: !!token,
                role: role,
                isValidRole: role && role.toLowerCase() === 'admin'
            });
            
            return !!(token && role && role.toLowerCase() === 'admin' && typeof token === 'string' && token.length > 10);
        }
        
        function requireAdmin() {
            console.log('🔐 requireAdmin() called');
            
            // Debug authentication step by step
            const token = storage.get('ra_admin_token');
            const role = storage.get('ra_admin_role');
            const user = storage.get('ra_admin_user');
            
            console.log('🔍 Authentication Debug:');
            console.log('  - Token:', token ? `Present (length: ${token.length})` : 'Missing');
            console.log('  - Role:', role || 'Missing');
            console.log('  - User:', user ? 'Present' : 'Missing');
            
            // Also check direct localStorage for debugging
            const directToken = localStorage.getItem('ra_admin_token');
            const directRole = localStorage.getItem('ra_admin_role');
            console.log('🔍 Direct localStorage Debug:');
            console.log('  - Direct Token:', directToken ? `Present (length: ${directToken.length})` : 'Missing');
            console.log('  - Direct Role:', directRole || 'Missing');
            
            if (!token) {
                console.log('❌ No token found, redirecting to login');
                console.log('🔍 Full localStorage contents:', Object.keys(localStorage).filter(k => k.includes('admin')));
                window.location.href = "/admin/login.html";
                return false;
            }
            
            if (!role) {
                console.log('❌ No role found, redirecting to login');
                window.location.href = "/admin/login.html";
                return false;
            }
            
            if (role.toLowerCase() !== 'admin') {
                console.log('❌ Invalid role:', role, 'redirecting to login');
                window.location.href = "/admin/login.html";
                return false;
            }
            
            if (typeof token !== 'string' || token.length <= 10) {
                console.log('❌ Invalid token format or length, redirecting to login');
                window.location.href = "/admin/login.html";
                return false;
            }
            
            console.log('✅ Authentication successful');
            return true;
        }
        
        function authHeader() {
            console.log("🔍 authHeader() called");
            const token = storage.get('ra_admin_token');
            console.log("🔍 Retrieved token:", token ? "Present (length: " + token.length + ")" : "Missing");
            return token ? { "Authorization": `Bearer ${token}` } : {};
        }
        
        // ===== API FUNCTIONS =====
        
        // Enhanced fetch with timeout and error handling
        async function apiRequest(url, options = {}) {
            const controller = new AbortController();
            const timeout = setTimeout(() => controller.abort(), 10000); // 10 second timeout
            
            try {
                const response = await fetch(url, {
                    ...options,
                    signal: controller.signal,
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Client': '241RA-Admin/1.0',
                        ...options.headers
                    }
                });
                
                clearTimeout(timeout);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                return await response.json();
            } catch (error) {
                clearTimeout(timeout);
                if (error.name === 'AbortError') {
                    throw new Error('Request timeout');
                }
                throw error;
            }
        }
        
        // ===== UI FUNCTIONS =====
        
        // Enhanced toast notification system
        function showToast(message, type = 'info', duration = 5000) {
            const container = document.getElementById('toastContainer');
            if (!container) return;
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div class="toast-content">
                    <span class="toast-message">${message}</span>
                    <button class="toast-close" onclick="this.parentElement.parentElement.remove()">×</button>
                </div>
            `;
            
            container.appendChild(toast);
            
            // Auto remove after duration
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, duration);
        }
        
        // Loading state management
        function showLoadingState() {
            const dashboard = document.getElementById('adminDashboard');
            if (dashboard) {
                dashboard.classList.add('loading');
            }
            
            const elements = ['totalUsers', 'totalRunners', 'activeAdmins', 'systemStatus'];
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = 'Loading...';
                    element.classList.add('loading');
                }
            });
        }
        
        function hideLoadingState() {
            const dashboard = document.getElementById('adminDashboard');
            if (dashboard) {
                dashboard.classList.remove('loading');
                dashboard.classList.add('loaded');
            }
            
            const elements = ['totalUsers', 'totalRunners', 'activeAdmins', 'systemStatus'];
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.classList.remove('loading');
                }
            });
        }
        
        // ===== DASHBOARD FUNCTIONS =====
        
        async function loadDashboardData() {
            try {
                console.log('📊 Loading dashboard data...');
                showLoadingState();
                
                // Always use individual loading functions since monitoring system is not available
                console.log('📊 Loading data using individual functions...');
                
                // Load users first, then admins (since admins depends on users)
                const [usersData, runnersData, publicCasesData, healthData] = await Promise.allSettled([
                    loadUsers(),
                    loadRunners(),
                    loadPublicCases(),
                    checkSystemStatus()
                ]);
                
                // Load admins after users are loaded
                const adminsData = await Promise.allSettled([loadAdmins()]);
                    
                    // Handle results
                    if (usersData.status === 'fulfilled') {
                        console.log('Users loaded:', dashboardData.users ? dashboardData.users.length : 'undefined');
                    } else {
                        console.error('Users load failed:', usersData.reason);
                    }
                    
                    if (runnersData.status === 'fulfilled') {
                        console.log('Runners loaded:', dashboardData.runners.length);
                    } else {
                        console.error('Runners load failed:', runnersData.reason);
                    }
                    
                    if (adminsData[0].status === 'fulfilled') {
                        console.log('Admins loaded:', dashboardData.admins ? dashboardData.admins.length : 'undefined');
                    } else {
                        console.error('Admins load failed:', adminsData[0].reason);
                    }
                    
                    if (publicCasesData.status === 'fulfilled') {
                        console.log('Public cases loaded:', dashboardData.publicCases.length);
                    } else {
                        console.error('Public cases load failed:', publicCasesData.reason);
                    }
                    
                    if (healthData.status === 'fulfilled') {
                        console.log('System status:', dashboardData.systemStatus);
                    } else {
                        console.error('Health check failed:', healthData.reason);
                    }
                
                // Always check system status
                await checkSystemStatus();
                
                updateDashboardUI();
                updateLastUpdatedTimestamp();
                hideLoadingState();
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showToast('Failed to load dashboard data', 'error');
                hideLoadingState();
            }
        }
        
        // ===== UPDATE TIMESTAMP FUNCTION =====
        
        function updateLastUpdatedTimestamp() {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            const dateString = now.toLocaleDateString();
            const timestampElement = document.getElementById('lastUpdated');
            if (timestampElement) {
                timestampElement.textContent = `${dateString} at ${timeString}`;
            }
        }        
        
        async function loadUsers() {
            try {
                console.log('👥 Loading users from API...');
                
                // Try to load from API first, fallback to mock data
                const apiUrl = window.API_BASE_URL || 'https://241runners-api.azurewebsites.net/api';
                console.log('📡 Users API URL:', `${apiUrl}/admin/users-debug`);
                
                try {
                    const response = await fetch(`${apiUrl}/admin/users-debug`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        const responseData = await response.json();
                        if (responseData.success && responseData.users) {
                            dashboardData.users = responseData.users;
                            console.log('✅ Users loaded from API:', dashboardData.users.length);
                        } else {
                            throw new Error('Invalid response format from API');
                        }
                    } else {
                        throw new Error(`API returned ${response.status}`);
                    }
                } catch (apiError) {
                    console.warn('⚠️ API users endpoint not available, using mock data:', apiError.message);
                    
                    // Show error UI for API failures
                    if (window.errorUI) {
                        window.errorUI.showErrorUI(
                            'Unable to load users from the server. Using cached data.',
                            {
                                title: 'Users Loading Warning',
                                retryFunction: () => loadUsers(),
                                showRetry: true
                            }
                        );
                    }
                    
                    // Fallback to mock data
                    dashboardData.users = [
                        { id: 1, email: "test@example.com", firstName: "Test", lastName: "User", role: "user", isActive: true },
                        { id: 2, email: "dekuworks1@gmail.com", firstName: "Marcus", lastName: "Brown", role: "admin", isActive: true },
                        { id: 3, email: "danielcarey9770@yahoo.com", firstName: "Daniel", lastName: "Carey", role: "admin", isActive: true },
                        { id: 4, email: "lthomas3350@gmail.com", firstName: "Lisa", lastName: "Thomas", role: "admin", isActive: true },
                        { id: 5, email: "tinaleggins@yahoo.com", firstName: "Tina", lastName: "Matthews", role: "admin", isActive: true },
                        { id: 6, email: "mmelasky@iplawconsulting.com", firstName: "Mark", lastName: "Melasky", role: "admin", isActive: true },
                        { id: 7, email: "ralphfrank900@gmail.com", firstName: "Ralph", lastName: "Frank", role: "admin", isActive: true }
                    ];
                    console.log('📊 Using mock users data:', dashboardData.users.length);
                }
            } catch (error) {
                console.error('❌ Error loading users:', error);
                dashboardData.users = [];
            }
        }
        
        async function loadRunners() {
            try {
                // Mock data for runners - TODO: Update when runners endpoint is available
                dashboardData.runners = [
                    { id: 1, name: "John Doe", status: "active" },
                    { id: 2, name: "Jane Smith", status: "active" },
                    { id: 3, name: "Bob Johnson", status: "inactive" }
                ];
                console.log('Loaded runners:', dashboardData.runners.length);
            } catch (error) {
                console.error('Error loading runners:', error);
                dashboardData.runners = [];
            }
        }
        
        async function loadAdmins() {
            try {
                // Ensure users data is available before filtering
                if (!dashboardData.users || !Array.isArray(dashboardData.users)) {
                    console.warn('⚠️ Users data not available for admin filtering, using empty array');
                    dashboardData.admins = [];
                    return;
                }
                
                // Filter admin users from the loaded users
                dashboardData.admins = dashboardData.users.filter(user => user.role === 'admin');
                console.log('✅ Loaded admins:', dashboardData.admins.length);
            } catch (error) {
                console.error('❌ Error loading admins:', error);
                dashboardData.admins = [];
            }
        }
        
        async function loadPublicCases() {
            try {
                // Mock data for public cases - TODO: Update when public cases endpoint is available
                dashboardData.publicCases = [
                    { id: 1, title: "Case 1", status: "open" },
                    { id: 2, title: "Case 2", status: "closed" },
                    { id: 3, title: "Case 3", status: "pending" }
                ];
                console.log('Loaded public cases:', dashboardData.publicCases.length);
            } catch (error) {
                console.error('Error loading public cases:', error);
                dashboardData.publicCases = [];
            }
        }
        
        async function checkSystemStatus() {
            try {
                const apiUrl = window.API_BASE_URL || 'https://241runners-api.azurewebsites.net/api';
                // Use the cases endpoint as a health check since it's public and always available
                const response = await fetch(`${apiUrl}/cases`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    dashboardData.systemStatus = 'healthy';
                    console.log('✅ System status: healthy');
                    return { status: 'healthy' };
                } else {
                    throw new Error(`API returned ${response.status}`);
                }
            } catch (error) {
                console.error('❌ Error checking system status:', error);
                dashboardData.systemStatus = 'error';
                return { status: 'error', error: error.message };
            }
        }
        
        function updateDashboardUI() {
            console.log('Updating dashboard UI...');
            
            // Update statistics
            updateElement('totalUsers', dashboardData.users.length);
            updateElement('totalRunners', dashboardData.runners.length);
            updateElement('activeAdmins', dashboardData.admins.length);
            updateElement('totalPublicCases', dashboardData.publicCases.length);
            
            // Update system status
            const systemStatusElement = document.getElementById('systemStatus');
            if (systemStatusElement) {
                const statusText = dashboardData.systemStatus === 'healthy' ? 'Healthy' : 'Error';
                systemStatusElement.textContent = statusText;
                systemStatusElement.className = `stat-number ${dashboardData.systemStatus === 'healthy' ? 'status-healthy' : 'status-error'}`;
            }
            
            // Update users table
            updateUsersTable();
        }
        
        function updateUsersTable() {
            const tbody = document.getElementById('usersTableBody');
            if (!tbody) return;
            
            if (dashboardData.users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="text-center text-gray-500">No users found</td></tr>';
                return;
            }
            
            const usersHTML = dashboardData.users.map(user => {
                const initials = `${user.firstName.charAt(0)}${user.lastName.charAt(0)}`;
                const fullName = `${user.firstName} ${user.lastName}`;
                const isActive = user.isActive !== false;
                const lastLogin = user.lastLoginAt ? new Date(user.lastLoginAt).toLocaleDateString() : 'Never';
                const created = user.createdAt ? new Date(user.createdAt).toLocaleDateString() : 'N/A';
                
                return `
                    <tr data-user-id="${user.id}">
                        <td>
                            <input type="checkbox" onchange="toggleUserSelection(this)">
                        </td>
                        <td>
                            <div class="user-info">
                                <div class="user-avatar">${initials}</div>
                                <div class="user-details">
                                    <h4>${fullName}</h4>
                                    <p>ID: ${user.id}</p>
                                </div>
                            </div>
                        </td>
                        <td>${user.email}</td>
                        <td>
                            <span class="role-badge role-${user.role}">${user.role}</span>
                        </td>
                        <td>
                            <span class="status-badge status-${isActive ? 'active' : 'inactive'}">
                                ${isActive ? 'Active' : 'Inactive'}
                            </span>
                        </td>
                        <td>${lastLogin}</td>
                        <td>${created}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn action-btn-edit" onclick="editUser(${user.id})" title="Edit User">
                                    ✏️
                                </button>
                                <button class="action-btn action-btn-delete" onclick="deleteUser(${user.id})" title="Delete User">
                                    🗑️
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = usersHTML;
        }
        
        function editUser(userId) {
            const user = dashboardData.users.find(u => u.id === userId);
            if (user) {
                showToast(`Edit user: ${user.email}`, 'info');
                // TODO: Implement edit user modal
            }
        }
        
        async function deleteUser(userId) {
            const user = dashboardData.users.find(u => u.id === userId);
            if (!user) {
                showToast('User not found', 'error');
                return;
            }

            if (!confirm(`Are you sure you want to delete user ${user.email}? This action cannot be undone.`)) {
                return;
            }

            try {
                showToast('Deleting user...', 'info', 2000);
                
                const apiUrl = window.API_BASE_URL || 'https://241runners-api.azurewebsites.net/api';
                const token = storage.get('ra_admin_token');
                
                console.log('🔍 Delete User Debug:', {
                    userId: userId,
                    apiUrl: apiUrl,
                    hasToken: !!token,
                    tokenLength: token ? token.length : 0
                });
                
                const response = await apiFetch(`${apiUrl}/admin/users/${userId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                console.log('🔍 Delete Response:', {
                    status: response.status,
                    statusText: response.statusText,
                    ok: response.ok
                });

                if (response.ok) {
                    const result = await response.json();
                    
                    if (result.action === 'deactivated') {
                        // User was deactivated instead of deleted
                        const userIndex = dashboardData.users.findIndex(u => u.id === userId);
                        if (userIndex !== -1) {
                            dashboardData.users[userIndex].isActive = false;
                        }
                        showToast(`User ${user.email} deactivated (has related data)`, 'warning');
                    } else {
                        // User was actually deleted
                        dashboardData.users = dashboardData.users.filter(u => u.id !== userId);
                        dashboardData.stats.totalUsers--;
                        showToast(`User ${user.email} deleted successfully`, 'success');
                    }
                    
                    // Update UI
                    updateUsersTable();
                    updateDashboardUI();
                    
                    // Log audit trail
                    logAuditAction(result.action === 'deactivated' ? 'user_deactivated' : 'user_deleted', {
                        userId: userId,
                        userEmail: user.email,
                        action: result.action,
                        deletedBy: currentAdmin?.email || 'Unknown'
                    });
                    
                } else if (response.status === 401) {
                    showToast('Authentication failed. Please log in again.', 'error');
                    // Redirect to login
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 2000);
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    console.error('Delete user error response:', errorData);
                    showToast(`Failed to delete user: ${errorData.message || response.statusText}`, 'error');
                }
                
            } catch (error) {
                console.error('Error deleting user:', error);
                showToast(`Failed to delete user: ${error.message}`, 'error');
            }
        }
        
        async function deleteAdmin(adminId) {
            const admin = dashboardData.admins.find(a => a.id === adminId);
            if (!admin) {
                showToast('Admin not found', 'error');
                return;
            }

            if (!confirm(`Are you sure you want to delete admin ${admin.email}? This action cannot be undone.`)) {
                return;
            }

            try {
                showToast('Deleting admin...', 'info', 2000);
                
                const apiUrl = window.API_BASE_URL || 'https://241runners-api.azurewebsites.net/api';
                const token = storage.get('ra_admin_token');
                
                console.log('🔍 Delete Admin Debug:', {
                    adminId: adminId,
                    apiUrl: apiUrl,
                    hasToken: !!token,
                    tokenLength: token ? token.length : 0
                });
                
                const response = await apiFetch(`${apiUrl}/admin/admins/${adminId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                console.log('🔍 Delete Admin Response:', {
                    status: response.status,
                    statusText: response.statusText,
                    ok: response.ok
                });

                if (response.ok) {
                    const result = await response.json();
                    
                    if (result.action === 'deactivated') {
                        // Admin was deactivated instead of deleted
                        const adminIndex = dashboardData.admins.findIndex(a => a.id === adminId);
                        if (adminIndex !== -1) {
                            dashboardData.admins[adminIndex].isActive = false;
                        }
                        showToast(`Admin ${admin.email} deactivated (has related data)`, 'warning');
                    } else {
                        // Admin was actually deleted
                        dashboardData.admins = dashboardData.admins.filter(a => a.id !== adminId);
                        dashboardData.stats.activeAdmins--;
                        showToast(`Admin ${admin.email} deleted successfully`, 'success');
                    }
                    
                    // Update UI
                    updateAdminsList();
                    updateDashboardUI();
                    
                    // Log audit trail
                    logAuditAction(result.action === 'deactivated' ? 'admin_deactivated' : 'admin_deleted', {
                        adminId: adminId,
                        adminEmail: admin.email,
                        action: result.action,
                        deletedBy: currentAdmin?.email || 'Unknown'
                    });
                    
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to delete admin');
                }
                
            } catch (error) {
                console.error('Error deleting admin:', error);
                showToast(`Failed to delete admin: ${error.message}`, 'error');
            }
        }
        
        function editAdmin(adminId) {
            const admin = dashboardData.admins.find(a => a.id === adminId);
            if (admin) {
                showToast(`Edit admin: ${admin.email}`, 'info');
                // TODO: Implement edit admin modal
            }
        }
        
        function updateElement(id, value) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = value;
            }
        }
        
        // ===== ADMIN PROFILE FUNCTIONS =====
        
        async function loadCurrentAdmin() {
            try {
                if (!isAuthenticated()) {
                    window.location.href = '/admin/login.html';
                    return;
                }

                // Try to get admin data from localStorage first
                const savedUser = storage.get('ra_admin_user');
                if (savedUser) {
                    try {
                        currentAdmin = JSON.parse(savedUser);
                        console.log('📱 Loaded admin from localStorage:', currentAdmin);
                        updateAdminProfile();
                        return;
                    } catch (e) {
                        console.warn('Failed to parse saved user data:', e);
                    }
                }

                // Fallback to API call
                const apiUrl = window.API_BASE_URL || 'https://241runners-api.azurewebsites.net/api';
                console.log("🔍 Making API call to verify endpoint");
                console.log("🔍 API call headers:", authHeader());
                const data = await apiRequest(`${apiUrl}/auth/me`, {
                    headers: authHeader()
                });
                
                currentAdmin = data;
                updateAdminProfile();
            } catch (error) {
                console.error('Error loading admin profile:', error);
                // Don't redirect on error, just use fallback data
                console.log('Using fallback admin data');
                currentAdmin = {
                    firstName: 'Admin',
                    lastName: 'User',
                    email: 'admin@241runnersawareness.org'
                };
                updateAdminProfile();
            }
        }        
        
        function updateAdminProfile() {
            if (!currentAdmin) return;

            updateElement('adminName', `${currentAdmin.firstName} ${currentAdmin.lastName}`);
            updateElement('adminEmail', currentAdmin.email);
            
            const adminAvatar = document.getElementById('adminAvatar');
            if (adminAvatar) {
                adminAvatar.textContent = `${currentAdmin.firstName.charAt(0)}${currentAdmin.lastName.charAt(0)}`;
            }
        }
        
        // ===== MODAL FUNCTIONS =====
        
        function openAdminsModal() {
            console.log('Opening admins modal...');
            const modal = document.getElementById('adminsModal');
            if (modal) {
                modal.style.display = 'block';
                loadAdminsInModal();
            }
        }
        
        function closeAdminsModal() {
            console.log('Closing admins modal...');
            const modal = document.getElementById('adminsModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // ===== INVITE USER FUNCTIONS =====
        
        function openInviteUserModal() {
            console.log('Opening invite user modal...');
            const modal = document.getElementById('inviteUserModal');
            if (modal) {
                modal.style.display = 'block';
                // Clear form
                document.getElementById('inviteUserForm').reset();
            }
        }
        
        function closeInviteUserModal() {
            console.log('Closing invite user modal...');
            const modal = document.getElementById('inviteUserModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        async function handleInviteUser(event) {
            if (event) event.preventDefault();
            
            try {
                const form = document.getElementById('inviteUserForm');
                const formData = new FormData(form);
                const inviteData = {
                    email: formData.get('email'),
                    firstName: formData.get('firstName'),
                    lastName: formData.get('lastName'),
                    role: formData.get('role'),
                    message: formData.get('message') || 'Welcome to 241 Runners Awareness!'
                };
                
                console.log('Sending invitation:', inviteData);
                
                const apiUrl = window.API_BASE_URL || 'https://241runners-api.azurewebsites.net/api';
                const response = await fetch(`${apiUrl}/admin/invite-user`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...authHeader()
                    },
                    body: JSON.stringify(inviteData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showToast(`Invitation sent to ${inviteData.email}`, 'success');
                    closeInviteUserModal();
                    
                    // Log audit trail
                    logAuditAction('user_invited', {
                        email: inviteData.email,
                        role: inviteData.role,
                        invitedBy: currentAdmin?.email || 'Unknown'
                    });
                    
                    // Refresh users data
                    await loadUsers();
                    updateDashboardUI();
                } else {
                    throw new Error(`Failed to send invitation: ${response.status}`);
                }
            } catch (error) {
                console.error('Error sending invitation:', error);
                showToast('Failed to send invitation. Please try again.', 'error');
            }
        }

        // ===== BULK ACTIONS FUNCTIONS =====
        
        function openBulkActionsModal() {
            console.log('Opening bulk actions modal...');
            const modal = document.getElementById('bulkActionsModal');
            if (modal) {
                modal.style.display = 'block';
                updateBulkActionsCount();
            }
        }
        
        function closeBulkActionsModal() {
            console.log('Closing bulk actions modal...');
            const modal = document.getElementById('bulkActionsModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        function updateBulkActionsCount() {
            const selectedCount = document.querySelectorAll('.users-table tbody tr.selected').length;
            const countElement = document.getElementById('bulkSelectedCount');
            if (countElement) {
                countElement.textContent = selectedCount;
            }
        }
        
        async function bulkUpdateStatus(status) {
            const selectedRows = document.querySelectorAll('.users-table tbody tr.selected');
            if (selectedRows.length === 0) {
                showToast('Please select users first', 'warning');
                return;
            }
            
            try {
                const userIds = Array.from(selectedRows).map(row => row.dataset.userId);
                const apiUrl = window.API_BASE_URL || 'https://241runners-api.azurewebsites.net/api';
                
                const response = await fetch(`${apiUrl}/admin/users/bulk-update-status`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...authHeader()
                    },
                    body: JSON.stringify({
                        userIds: userIds,
                        status: status
                    })
                });
                
                if (response.ok) {
                    showToast(`Updated ${userIds.length} users to ${status}`, 'success');
                    
                    // Log audit trail
                    logAuditAction('bulk_status_update', {
                        userIds: userIds,
                        status: status,
                        count: userIds.length,
                        updatedBy: currentAdmin?.email || 'Unknown'
                    });
                    
                    // Refresh data
                    await loadUsers();
                    updateDashboardUI();
                    clearSelection();
                } else {
                    throw new Error(`Failed to update users: ${response.status}`);
                }
            } catch (error) {
                console.error('Error updating users:', error);
                showToast('Failed to update users. Please try again.', 'error');
            }
        }
        
        async function bulkUpdateRole(role) {
            const selectedRows = document.querySelectorAll('.users-table tbody tr.selected');
            if (selectedRows.length === 0) {
                showToast('Please select users first', 'warning');
                return;
            }
            
            try {
                const userIds = Array.from(selectedRows).map(row => row.dataset.userId);
                const apiUrl = window.API_BASE_URL || 'https://241runners-api.azurewebsites.net/api';
                
                const response = await fetch(`${apiUrl}/admin/users/bulk-update-role`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...authHeader()
                    },
                    body: JSON.stringify({
                        userIds: userIds,
                        role: role
                    })
                });
                
                if (response.ok) {
                    showToast(`Updated ${userIds.length} users to ${role} role`, 'success');
                    
                    // Log audit trail
                    logAuditAction('bulk_role_update', {
                        userIds: userIds,
                        role: role,
                        count: userIds.length,
                        updatedBy: currentAdmin?.email || 'Unknown'
                    });
                    
                    // Refresh data
                    await loadUsers();
                    updateDashboardUI();
                    clearSelection();
                } else {
                    throw new Error(`Failed to update user roles: ${response.status}`);
                }
            } catch (error) {
                console.error('Error updating user roles:', error);
                showToast('Failed to update user roles. Please try again.', 'error');
            }
        }
        
        async function bulkExportUsers() {
            const selectedRows = document.querySelectorAll('.users-table tbody tr.selected');
            if (selectedRows.length === 0) {
                showToast('Please select users first', 'warning');
                return;
            }
            
            try {
                const userIds = Array.from(selectedRows).map(row => row.dataset.userId);
                const selectedUsers = dashboardData.users.filter(user => userIds.includes(user.id.toString()));
                
                // Create CSV content
                const csvContent = [
                    ['Email', 'First Name', 'Last Name', 'Role', 'Status', 'Created Date'],
                    ...selectedUsers.map(user => [
                        user.email,
                        user.firstName,
                        user.lastName,
                        user.role,
                        user.isActive ? 'Active' : 'Inactive',
                        user.createdAt || 'N/A'
                    ])
                ].map(row => row.join(',')).join('\n');
                
                // Download CSV
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `users_export_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                showToast(`Exported ${selectedUsers.length} users`, 'success');
                
                // Log audit trail
                logAuditAction('bulk_export', {
                    userIds: userIds,
                    count: selectedUsers.length,
                    exportedBy: currentAdmin?.email || 'Unknown'
                });
            } catch (error) {
                console.error('Error exporting users:', error);
                showToast('Failed to export users. Please try again.', 'error');
            }
        }

        // ===== SAVED FILTERS FUNCTIONS =====
        
        function openSavedFiltersModal() {
            console.log('Opening saved filters modal...');
            const modal = document.getElementById('savedFiltersModal');
            if (modal) {
                modal.style.display = 'block';
                loadSavedFilters();
            }
        }
        
        function closeSavedFiltersModal() {
            console.log('Closing saved filters modal...');
            const modal = document.getElementById('savedFiltersModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        function loadSavedFilters() {
            const savedFilters = JSON.parse(storage.get('savedFilters', '[]'));
            const filtersList = document.getElementById('savedFiltersList');
            
            if (savedFilters.length === 0) {
                filtersList.innerHTML = '<p class="text-center text-gray-500">No saved filters yet</p>';
                return;
            }
            
            const filtersHTML = savedFilters.map(filter => `
                <div class="saved-filter-item">
                    <div class="saved-filter-info">
                        <h4>${filter.name}</h4>
                        <p>${filter.description || 'No description'}</p>
                    </div>
                    <div class="saved-filter-actions">
                        <button class="btn btn-sm btn-primary" onclick="applySavedFilter('${filter.id}')">Apply</button>
                        <button class="btn btn-sm btn-outline" onclick="deleteSavedFilter('${filter.id}')">Delete</button>
                    </div>
                </div>
            `).join('');
            
            filtersList.innerHTML = filtersHTML;
        }
        
        function applySavedFilter(filterId) {
            const savedFilters = JSON.parse(storage.get('savedFilters', '[]'));
            const filter = savedFilters.find(f => f.id === filterId);
            
            if (filter) {
                // Apply the saved filter
                document.getElementById('roleFilter').value = filter.filters.role || '';
                document.getElementById('statusFilter').value = filter.filters.status || '';
                document.getElementById('userSearch').value = filter.filters.search || '';
                
                // Trigger filter
                filterUsers();
                showToast(`Applied filter: ${filter.name}`, 'success');
                closeSavedFiltersModal();
            }
        }
        
        function deleteSavedFilter(filterId) {
            const savedFilters = JSON.parse(storage.get('savedFilters', '[]'));
            const updatedFilters = savedFilters.filter(f => f.id !== filterId);
            storage.set('savedFilters', JSON.stringify(updatedFilters));
            loadSavedFilters();
            showToast('Filter deleted', 'success');
        }
        
        function handleSaveFilter(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const filterName = formData.get('name');
            const filterDescription = formData.get('description');
            
            const currentFilters = {
                role: document.getElementById('roleFilter').value,
                status: document.getElementById('statusFilter').value,
                search: document.getElementById('userSearch').value
            };
            
            const newFilter = {
                id: Date.now().toString(),
                name: filterName,
                description: filterDescription,
                filters: currentFilters,
                createdAt: new Date().toISOString()
            };
            
            const savedFilters = JSON.parse(storage.get('savedFilters', '[]'));
            savedFilters.push(newFilter);
            storage.set('savedFilters', JSON.stringify(savedFilters));
            
            showToast(`Filter "${filterName}" saved`, 'success');
            loadSavedFilters();
            event.target.reset();
        }

        // ===== AUDIT LOG FUNCTIONS =====
        
        function openAuditLogModal() {
            console.log('Opening audit log modal...');
            const modal = document.getElementById('auditLogModal');
            if (modal) {
                modal.style.display = 'block';
                loadAuditLog();
            }
        }
        
        function closeAuditLogModal() {
            console.log('Closing audit log modal...');
            const modal = document.getElementById('auditLogModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        function loadAuditLog() {
            const auditLog = JSON.parse(storage.get('auditLog', '[]'));
            const logList = document.getElementById('auditLogList');
            
            if (auditLog.length === 0) {
                logList.innerHTML = '<p class="text-center text-gray-500">No audit log entries yet</p>';
                return;
            }
            
            // Sort by timestamp (newest first)
            const sortedLog = auditLog.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            const logHTML = sortedLog.map(entry => `
                <div class="audit-log-entry">
                    <div class="audit-log-info">
                        <h4>
                            <span class="action-badge action-badge-${entry.action.replace('_', '')}">${entry.action.replace('_', ' ')}</span>
                            ${entry.description}
                        </h4>
                        <p>${entry.details ? JSON.stringify(entry.details) : ''}</p>
                    </div>
                    <div class="audit-log-meta">
                        <span class="timestamp">${new Date(entry.timestamp).toLocaleString()}</span>
                        <span class="user">${entry.user}</span>
                    </div>
                </div>
            `).join('');
            
            logList.innerHTML = logHTML;
        }
        
        function filterAuditLog() {
            // Implementation for filtering audit log
            loadAuditLog();
        }
        
        function exportAuditLog() {
            const auditLog = JSON.parse(storage.get('auditLog', '[]'));
            
            // Create CSV content
            const csvContent = [
                ['Timestamp', 'Action', 'Description', 'User', 'Details'],
                ...auditLog.map(entry => [
                    new Date(entry.timestamp).toLocaleString(),
                    entry.action,
                    entry.description,
                    entry.user,
                    entry.details ? JSON.stringify(entry.details) : ''
                ])
            ].map(row => row.join(',')).join('\n');
            
            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `audit_log_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showToast('Audit log exported', 'success');
        }
        
        function logAuditAction(action, details = {}) {
            const auditEntry = {
                timestamp: new Date().toISOString(),
                action: action,
                description: getActionDescription(action, details),
                user: currentAdmin?.email || 'Unknown',
                details: details
            };
            
            const auditLog = JSON.parse(storage.get('auditLog', '[]'));
            auditLog.push(auditEntry);
            
            // Keep only last 1000 entries
            if (auditLog.length > 1000) {
                auditLog.splice(0, auditLog.length - 1000);
            }
            
            storage.set('auditLog', JSON.stringify(auditLog));
        }
        
        function getActionDescription(action, details) {
            switch (action) {
                case 'user_invited':
                    return `Invited user ${details.email} with role ${details.role}`;
                case 'bulk_status_update':
                    return `Updated ${details.count} users to ${details.status} status`;
                case 'bulk_role_update':
                    return `Updated ${details.count} users to ${details.role} role`;
                case 'bulk_export':
                    return `Exported ${details.count} users`;
                case 'user_created':
                    return `Created user ${details.email}`;
                case 'user_updated':
                    return `Updated user ${details.email}`;
                case 'user_deleted':
                    return `Deleted user ${details.email}`;
                case 'role_changed':
                    return `Changed role for ${details.email} from ${details.oldRole} to ${details.newRole}`;
                case 'login':
                    return `User logged in`;
                case 'logout':
                    return `User logged out`;
                default:
                    return `Performed ${action}`;
            }
        }
        
        async function loadAdminsInModal() {
            const adminsList = document.getElementById('adminsList');
            if (!adminsList) return;
            
            try {
                // Show loading state
                adminsList.innerHTML = '<div class="loading">Loading admins...</div>';
                adminsList.classList.add('loading');
                
                // Load fresh admin data
                await loadAdmins();
                
                // Clear loading state
                adminsList.classList.remove('loading');
                
                // Render admin list
                renderAdminsList();
                
                showToast('Admin list loaded successfully!', 'success', 3000);
            } catch (error) {
                console.error('Error loading admins in modal:', error);
                adminsList.innerHTML = '<div class="error-text-center">Failed to load admin list. Please try again.</div>';
                showToast('Failed to load admin list', 'error');
            }
        }
        
        function renderAdminsList() {
            const adminsList = document.getElementById('adminsList');
            if (!adminsList) return;
            
            if (dashboardData.admins.length === 0) {
                adminsList.innerHTML = '<div class="empty-text-center">No admin users found.</div>';
                return;
            }
            
            const adminsHTML = dashboardData.admins.map(admin => {
                const initials = `${admin.firstName.charAt(0)}${admin.lastName.charAt(0)}`;
                const fullName = `${admin.firstName} ${admin.lastName}`;
                const isCurrentAdmin = currentAdmin && currentAdmin.email === admin.email;
                
                return `
                    <div class="admin-item ${isCurrentAdmin ? 'current-admin' : ''}">
                        <div class="admin-item-header">
                            <div class="admin-avatar-small">${initials}</div>
                            <div class="admin-details">
                                <h4>${fullName} ${isCurrentAdmin ? '(You)' : ''}</h4>
                                <p>${admin.email}</p>
                                <div class="admin-role">${admin.role}</div>
                                <div class="admin-status ${admin.isActive !== false ? 'active' : 'inactive'}">
                                    <span>●</span>
                                    ${admin.isActive !== false ? 'Active' : 'Inactive'}
                                </div>
                            </div>
                            <div class="admin-actions">
                                <button class="btn btn-sm btn-outline" onclick="editAdmin('${admin.id}')" title="Edit Admin">
                                    ✏️
                                </button>
                                ${!isCurrentAdmin ? `<button class="btn btn-sm btn-danger" onclick="deleteAdmin('${admin.id}')" title="Delete Admin">
                                    🗑️
                                </button>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            adminsList.innerHTML = adminsHTML;
        }
        
        async function refreshAdminsList() {
            console.log('Refreshing admins list...');
            showToast('Refreshing admin list...', 'info', 2000);
            await loadAdminsInModal();
        }
        
        // ===== TRIAGE QUEUE FUNCTIONS =====
        
        // Global state for triage queue
        let triageData = {
            cases: [],
            slaConfig: {
                responseTime: { critical: 1, high: 4, medium: 8, low: 24 },
                resolutionTime: { critical: 4, high: 24, medium: 72, low: 168 },
                autoEscalate: true,
                escalationDelay: 2
            }
        };

        async function loadTriageQueue() {
            try {
                console.log('Loading triage queue...');
                
                // Mock data for now - TODO: Replace with API call
                triageData.cases = [
                    {
                        id: 'CASE-001',
                        subject: 'Login issues reported by multiple users',
                        description: 'Users unable to log in to the platform',
                        priority: 'critical',
                        status: 'new',
                        reporter: 'support@241runnersawareness.org',
                        assignee: null,
                        category: 'technical',
                        createdAt: new Date(Date.now() - 2 * 60 * 60 * 1000), // 2 hours ago
                        updatedAt: new Date(Date.now() - 30 * 60 * 1000), // 30 minutes ago
                        slaStatus: 'at_risk'
                    },
                    {
                        id: 'CASE-002',
                        subject: 'Feature request: Dark mode',
                        description: 'Users requesting dark mode theme option',
                        priority: 'low',
                        status: 'in_progress',
                        reporter: 'user@example.com',
                        assignee: 'dekuworks1@gmail.com',
                        category: 'feature_request',
                        createdAt: new Date(Date.now() - 24 * 60 * 60 * 1000), // 1 day ago
                        updatedAt: new Date(Date.now() - 2 * 60 * 60 * 1000), // 2 hours ago
                        slaStatus: 'on_track'
                    },
                    {
                        id: 'CASE-003',
                        subject: 'Security vulnerability in user upload',
                        description: 'Potential XSS vulnerability in file upload feature',
                        priority: 'high',
                        status: 'pending',
                        reporter: 'security@241runnersawareness.org',
                        assignee: 'danielcarey9770@yahoo.com',
                        category: 'security',
                        createdAt: new Date(Date.now() - 6 * 60 * 60 * 1000), // 6 hours ago
                        updatedAt: new Date(Date.now() - 1 * 60 * 60 * 1000), // 1 hour ago
                        slaStatus: 'breached'
                    }
                ];
                
                updateTriageQueueUI();
                updateSLAOverview();
                
            } catch (error) {
                console.error('Error loading triage queue:', error);
                showToast('Failed to load triage queue', 'error');
            }
        }
        
        function updateTriageQueueUI() {
            const tbody = document.getElementById('triageTableBody');
            if (!tbody) return;
            
            if (triageData.cases.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" class="text-center text-gray-500">No cases found</td></tr>';
                return;
            }
            
            const casesHTML = triageData.cases.map(case_ => {
                const timeSinceCreated = getTimeSince(case_.createdAt);
                const assigneeName = case_.assignee ? 
                    dashboardData.users.find(u => u.email === case_.assignee)?.firstName + ' ' + 
                    dashboardData.users.find(u => u.email === case_.assignee)?.lastName : 
                    'Unassigned';
                
                return `
                    <tr data-case-id="${case_.id}">
                        <td>
                            <input type="checkbox" onchange="toggleCaseSelection(this)">
                        </td>
                        <td>
                            <span class="case-id">${case_.id}</span>
                        </td>
                        <td>
                            <span class="priority-badge priority-${case_.priority}">${case_.priority}</span>
                        </td>
                        <td>
                            <div>
                                <strong>${case_.subject}</strong>
                                <br>
                                <small class="text-gray-500">${case_.category}</small>
                            </div>
                        </td>
                        <td>${case_.reporter}</td>
                        <td>${assigneeName}</td>
                        <td>
                            <span class="case-status case-status-${case_.status}">${case_.status.replace('_', ' ')}</span>
                        </td>
                        <td>
                            <span class="sla-indicator ${case_.slaStatus}">${case_.slaStatus.replace('_', ' ')}</span>
                        </td>
                        <td>
                            <div>
                                ${timeSinceCreated}
                                <br>
                                <small class="text-gray-500">${case_.createdAt.toLocaleDateString()}</small>
                            </div>
                        </td>
                        <td>
                            <div class="case-actions">
                                <button class="case-action-btn case-action-btn-edit" onclick="editCase('${case_.id}')" title="Edit Case">
                                    ✏️
                                </button>
                                <button class="case-action-btn case-action-btn-assign" onclick="assignCase('${case_.id}')" title="Assign Case">
                                    👥
                                </button>
                                <button class="case-action-btn case-action-btn-escalate" onclick="escalateCase('${case_.id}')" title="Escalate Case">
                                    🚨
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = casesHTML;
        }
        
        function updateSLAOverview() {
            // Calculate SLA metrics
            const totalCases = triageData.cases.length;
            const onTrackCases = triageData.cases.filter(c => c.slaStatus === 'on_track').length;
            const atRiskCases = triageData.cases.filter(c => c.slaStatus === 'at_risk').length;
            const breachedCases = triageData.cases.filter(c => c.slaStatus === 'breached').length;
            
            // Mock calculations - TODO: Replace with real calculations
            const avgResponseTime = 2.3;
            const avgResolutionTime = 18.5;
            const avgBacklogAge = 3.2;
            const slaComplianceRate = Math.round((onTrackCases / totalCases) * 100);
            
            // Update UI
            updateElement('avgResponseTime', `${avgResponseTime}h`);
            updateElement('avgResolutionTime', `${avgResolutionTime}h`);
            updateElement('avgBacklogAge', `${avgBacklogAge}d`);
            updateElement('slaComplianceRate', `${slaComplianceRate}%`);
            
            // Update status indicators
            updateSLAStatus('responseTimeStatus', avgResponseTime <= 4 ? 'good' : avgResponseTime <= 6 ? 'warning' : 'critical');
            updateSLAStatus('resolutionTimeStatus', avgResolutionTime <= 24 ? 'good' : avgResolutionTime <= 36 ? 'warning' : 'critical');
            updateSLAStatus('backlogAgeStatus', avgBacklogAge <= 2 ? 'good' : avgBacklogAge <= 3 ? 'warning' : 'critical');
            updateSLAStatus('slaComplianceStatus', slaComplianceRate >= 90 ? 'good' : slaComplianceRate >= 80 ? 'warning' : 'critical');
        }
        
        function updateSLAStatus(elementId, status) {
            const element = document.getElementById(elementId);
            if (element) {
                element.className = `sla-status sla-${status}`;
                element.textContent = status.charAt(0).toUpperCase() + status.slice(1);
            }
        }
        
        function getTimeSince(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffDays > 0) {
                return `${diffDays}d ago`;
            } else if (diffHours > 0) {
                return `${diffHours}h ago`;
            } else {
                const diffMinutes = Math.floor(diffMs / (1000 * 60));
                return `${diffMinutes}m ago`;
            }
        }
        
        // Modal functions for triage queue
        function openNewCaseModal() {
            const modal = document.getElementById('newCaseModal');
            if (modal) {
                modal.style.display = 'block';
                populateAssigneeDropdown('caseAssignee');
                document.getElementById('newCaseForm').reset();
            }
        }
        
        function closeNewCaseModal() {
            const modal = document.getElementById('newCaseModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        function openSLAConfigModal() {
            const modal = document.getElementById('slaConfigModal');
            if (modal) {
                modal.style.display = 'block';
                loadSLAConfig();
            }
        }
        
        function closeSLAConfigModal() {
            const modal = document.getElementById('slaConfigModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        function openBulkAssignModal() {
            const selectedCases = document.querySelectorAll('.triage-table tbody tr.selected');
            if (selectedCases.length === 0) {
                showToast('Please select cases first', 'warning');
                return;
            }
            
            const modal = document.getElementById('bulkAssignModal');
            if (modal) {
                modal.style.display = 'block';
                document.getElementById('bulkAssignCount').textContent = selectedCases.length;
                populateAssigneeDropdown('bulkAssignTo');
            }
        }
        
        function closeBulkAssignModal() {
            const modal = document.getElementById('bulkAssignModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        function populateAssigneeDropdown(selectId) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            // Clear existing options except first
            select.innerHTML = '<option value="">Unassigned</option>';
            
            // Add admin users
            dashboardData.admins.forEach(admin => {
                const option = document.createElement('option');
                option.value = admin.email;
                option.textContent = `${admin.firstName} ${admin.lastName}`;
                select.appendChild(option);
            });
        }
        
        async function handleCreateCase(event) {
            if (event) event.preventDefault();
            
            try {
                const form = document.getElementById('newCaseForm');
                const formData = new FormData(form);
                
                const newCase = {
                    id: `CASE-${String(triageData.cases.length + 1).padStart(3, '0')}`,
                    subject: formData.get('subject'),
                    description: formData.get('description'),
                    priority: formData.get('priority'),
                    status: 'new',
                    reporter: formData.get('reporter') || 'system@241runnersawareness.org',
                    assignee: formData.get('assignee') || null,
                    category: formData.get('category') || 'general',
                    createdAt: new Date(),
                    updatedAt: new Date(),
                    slaStatus: 'on_track'
                };
                
                triageData.cases.unshift(newCase);
                updateTriageQueueUI();
                updateSLAOverview();
                
                showToast(`Case ${newCase.id} created successfully`, 'success');
                closeNewCaseModal();
                
                // Log audit trail
                logAuditAction('case_created', {
                    caseId: newCase.id,
                    subject: newCase.subject,
                    priority: newCase.priority,
                    createdBy: currentAdmin?.email || 'Unknown'
                });
                
            } catch (error) {
                console.error('Error creating case:', error);
                showToast('Failed to create case', 'error');
            }
        }
        
        function loadSLAConfig() {
            const config = triageData.slaConfig;
            
            document.getElementById('slaResponseCritical').value = config.responseTime.critical;
            document.getElementById('slaResponseHigh').value = config.responseTime.high;
            document.getElementById('slaResponseMedium').value = config.responseTime.medium;
            document.getElementById('slaResponseLow').value = config.responseTime.low;
            
            document.getElementById('slaResolutionCritical').value = config.resolutionTime.critical;
            document.getElementById('slaResolutionHigh').value = config.resolutionTime.high;
            document.getElementById('slaResolutionMedium').value = config.resolutionTime.medium;
            document.getElementById('slaResolutionLow').value = config.resolutionTime.low;
            
            document.getElementById('slaAutoEscalate').checked = config.autoEscalate;
            document.getElementById('slaEscalationDelay').value = config.escalationDelay;
        }
        
        function saveSLAConfig() {
            const config = {
                responseTime: {
                    critical: parseInt(document.getElementById('slaResponseCritical').value),
                    high: parseInt(document.getElementById('slaResponseHigh').value),
                    medium: parseInt(document.getElementById('slaResponseMedium').value),
                    low: parseInt(document.getElementById('slaResponseLow').value)
                },
                resolutionTime: {
                    critical: parseInt(document.getElementById('slaResolutionCritical').value),
                    high: parseInt(document.getElementById('slaResolutionHigh').value),
                    medium: parseInt(document.getElementById('slaResolutionMedium').value),
                    low: parseInt(document.getElementById('slaResolutionLow').value)
                },
                autoEscalate: document.getElementById('slaAutoEscalate').checked,
                escalationDelay: parseInt(document.getElementById('slaEscalationDelay').value)
            };
            
            triageData.slaConfig = config;
            storage.set('slaConfig', JSON.stringify(config));
            
            showToast('SLA configuration saved', 'success');
            closeSLAConfigModal();
            
            // Log audit trail
            logAuditAction('sla_config_updated', {
                config: config,
                updatedBy: currentAdmin?.email || 'Unknown'
            });
        }
        
        function filterTriageQueue() {
            const priorityFilter = document.getElementById('priorityFilter').value;
            const statusFilter = document.getElementById('caseStatusFilter').value;
            const assigneeFilter = document.getElementById('assignedToFilter').value;
            const slaStatusFilter = document.getElementById('slaStatusFilter').value;
            
            const rows = document.querySelectorAll('.triage-table tbody tr');
            
            rows.forEach(row => {
                const caseId = row.dataset.caseId;
                const case_ = triageData.cases.find(c => c.id === caseId);
                
                if (!case_) return;
                
                const matchesPriority = !priorityFilter || case_.priority === priorityFilter;
                const matchesStatus = !statusFilter || case_.status === statusFilter;
                const matchesAssignee = !assigneeFilter || 
                    (assigneeFilter === 'unassigned' && !case_.assignee) ||
                    (assigneeFilter !== 'unassigned' && case_.assignee === assigneeFilter);
                const matchesSLA = !slaStatusFilter || case_.slaStatus === slaStatusFilter;
                
                if (matchesPriority && matchesStatus && matchesAssignee && matchesSLA) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function toggleSelectAllCases() {
            const selectAllCheckbox = document.getElementById('selectAllCases');
            const checkboxes = document.querySelectorAll('.triage-table tbody input[type="checkbox"]');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
                checkbox.closest('tr').classList.toggle('selected', selectAllCheckbox.checked);
            });
        }
        
        function toggleCaseSelection(checkbox) {
            const row = checkbox.closest('tr');
            row.classList.toggle('selected', checkbox.checked);
        }
        
        function refreshTriageQueue() {
            showToast('Refreshing triage queue...', 'info', 2000);
            loadTriageQueue().then(() => {
                showToast('Triage queue refreshed!', 'success', 3000);
            });
        }
        
        function exportTriageReport() {
            const csvContent = [
                ['Case ID', 'Subject', 'Priority', 'Status', 'Reporter', 'Assignee', 'SLA Status', 'Created', 'Updated'],
                ...triageData.cases.map(case_ => [
                    case_.id,
                    case_.subject,
                    case_.priority,
                    case_.status,
                    case_.reporter,
                    case_.assignee || 'Unassigned',
                    case_.slaStatus,
                    case_.createdAt.toLocaleDateString(),
                    case_.updatedAt.toLocaleDateString()
                ])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `triage_report_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showToast('Triage report exported', 'success');
        }
        
        // Bulk action functions for triage queue
        function bulkAssignCases() {
            openBulkAssignModal();
        }
        
        function executeBulkAssign() {
            const selectedCases = document.querySelectorAll('.triage-table tbody tr.selected');
            const assignTo = document.getElementById('bulkAssignTo').value;
            const note = document.getElementById('bulkAssignNote').value;
            
            if (selectedCases.length === 0) {
                showToast('Please select cases first', 'warning');
                return;
            }
            
            if (!assignTo) {
                showToast('Please select an assignee', 'warning');
                return;
            }
            
            try {
                const caseIds = Array.from(selectedCases).map(row => row.dataset.caseId);
                
                // Update cases in triage data
                caseIds.forEach(caseId => {
                    const case_ = triageData.cases.find(c => c.id === caseId);
                    if (case_) {
                        case_.assignee = assignTo;
                        case_.updatedAt = new Date();
                    }
                });
                
                updateTriageQueueUI();
                showToast(`Assigned ${caseIds.length} cases to ${assignTo}`, 'success');
                closeBulkAssignModal();
                
                // Log audit trail
                logAuditAction('bulk_case_assignment', {
                    caseIds: caseIds,
                    assignee: assignTo,
                    note: note,
                    count: caseIds.length,
                    assignedBy: currentAdmin?.email || 'Unknown'
                });
                
            } catch (error) {
                console.error('Error assigning cases:', error);
                showToast('Failed to assign cases', 'error');
            }
        }
        
        function bulkUpdatePriority() {
            const selectedCases = document.querySelectorAll('.triage-table tbody tr.selected');
            if (selectedCases.length === 0) {
                showToast('Please select cases first', 'warning');
                return;
            }
            
            const newPriority = prompt('Enter new priority (critical, high, medium, low):');
            if (!newPriority || !['critical', 'high', 'medium', 'low'].includes(newPriority)) {
                showToast('Invalid priority level', 'warning');
                return;
            }
            
            try {
                const caseIds = Array.from(selectedCases).map(row => row.dataset.caseId);
                
                // Update cases in triage data
                caseIds.forEach(caseId => {
                    const case_ = triageData.cases.find(c => c.id === caseId);
                    if (case_) {
                        case_.priority = newPriority;
                        case_.updatedAt = new Date();
                    }
                });
                
                updateTriageQueueUI();
                showToast(`Updated priority for ${caseIds.length} cases to ${newPriority}`, 'success');
                
                // Log audit trail
                logAuditAction('bulk_priority_update', {
                    caseIds: caseIds,
                    newPriority: newPriority,
                    count: caseIds.length,
                    updatedBy: currentAdmin?.email || 'Unknown'
                });
                
            } catch (error) {
                console.error('Error updating priority:', error);
                showToast('Failed to update priority', 'error');
            }
        }
        
        function bulkEscalateCases() {
            const selectedCases = document.querySelectorAll('.triage-table tbody tr.selected');
            if (selectedCases.length === 0) {
                showToast('Please select cases first', 'warning');
                return;
            }
            
            if (!confirm(`Are you sure you want to escalate ${selectedCases.length} cases?`)) {
                return;
            }
            
            try {
                const caseIds = Array.from(selectedCases).map(row => row.dataset.caseId);
                
                // Update cases in triage data
                caseIds.forEach(caseId => {
                    const case_ = triageData.cases.find(c => c.id === caseId);
                    if (case_) {
                        // Escalate priority
                        if (case_.priority === 'low') case_.priority = 'medium';
                        else if (case_.priority === 'medium') case_.priority = 'high';
                        else if (case_.priority === 'high') case_.priority = 'critical';
                        
                        case_.updatedAt = new Date();
                        case_.slaStatus = 'at_risk'; // Reset SLA status
                    }
                });
                
                updateTriageQueueUI();
                updateSLAOverview();
                showToast(`Escalated ${caseIds.length} cases`, 'success');
                
                // Log audit trail
                logAuditAction('bulk_case_escalation', {
                    caseIds: caseIds,
                    count: caseIds.length,
                    escalatedBy: currentAdmin?.email || 'Unknown'
                });
                
            } catch (error) {
                console.error('Error escalating cases:', error);
                showToast('Failed to escalate cases', 'error');
            }
        }
        
        // Individual case action functions
        function editCase(caseId) {
            const case_ = triageData.cases.find(c => c.id === caseId);
            if (case_) {
                showToast(`Edit case: ${case_.subject}`, 'info');
                // TODO: Implement edit case modal
            }
        }
        
        function assignCase(caseId) {
            const case_ = triageData.cases.find(c => c.id === caseId);
            if (case_) {
                showToast(`Assign case: ${case_.subject}`, 'info');
                // TODO: Implement assign case modal
            }
        }
        
        function escalateCase(caseId) {
            const case_ = triageData.cases.find(c => c.id === caseId);
            if (case_) {
                if (!confirm(`Are you sure you want to escalate case ${caseId}?`)) {
                    return;
                }
                
                // Escalate priority
                if (case_.priority === 'low') case_.priority = 'medium';
                else if (case_.priority === 'medium') case_.priority = 'high';
                else if (case_.priority === 'high') case_.priority = 'critical';
                
                case_.updatedAt = new Date();
                case_.slaStatus = 'at_risk';
                
                updateTriageQueueUI();
                updateSLAOverview();
                showToast(`Case ${caseId} escalated`, 'success');
                
                // Log audit trail
                logAuditAction('case_escalated', {
                    caseId: caseId,
                    newPriority: case_.priority,
                    escalatedBy: currentAdmin?.email || 'Unknown'
                });
            }
        }

        // ===== SYSTEM HEALTH FUNCTIONS =====
        
        // Global state for system health
        let healthData = {
            apiStatus: 'healthy',
            dbStatus: 'connected',
            memoryUsage: 78,
            cpuUsage: 23,
            services: {
                webserver: { status: 'online', uptime: '15d 8h 23m', requests: 1247, errors: 0.02 },
                database: { status: 'online', uptime: '15d 8h 23m', queries: 3891, slowQueries: 12 },
                email: { status: 'online', uptime: '15d 8h 23m', emails: 23, queue: 0 },
                storage: { status: 'online', uptime: '15d 8h 23m', used: '2.3GB', total: '10GB', files: 1247 }
            }
        };

        async function loadSystemHealth() {
            try {
                console.log('Loading system health data...');
                
                // Mock health data - TODO: Replace with real API calls
                await updateHealthMetrics();
                updateServiceStatus();
                
            } catch (error) {
                console.error('Error loading system health:', error);
                showToast('Failed to load system health data', 'error');
            }
        }
        
        async function updateHealthMetrics() {
            // Mock API health check
            try {
                const startTime = Date.now();
                const response = await fetch(`${window.API_BASE_URL.replace('/api', '')}/api/health`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                const responseTime = Date.now() - startTime;
                
                if (response.ok) {
                    healthData.apiStatus = 'healthy';
                    updateElement('apiResponseTime', `${responseTime}ms`);
                    updateHealthStatus('apiStatus', 'good');
                } else {
                    healthData.apiStatus = 'error';
                    updateHealthStatus('apiStatus', 'critical');
                }
            } catch (error) {
                healthData.apiStatus = 'error';
                updateHealthStatus('apiStatus', 'critical');
            }
            
            // Update other metrics
            updateElement('dbConnections', '12/50');
            updateElement('memoryUsage', `${healthData.memoryUsage}%`);
            updateElement('cpuUsage', `${healthData.cpuUsage}%`);
            
            // Update status indicators
            updateHealthStatus('dbStatus', 'good');
            updateHealthStatus('memoryStatus', healthData.memoryUsage > 80 ? 'warning' : 'good');
            updateHealthStatus('cpuStatus', healthData.cpuUsage > 70 ? 'warning' : 'good');
        }
        
        function updateHealthStatus(elementId, status) {
            const element = document.getElementById(elementId);
            if (element) {
                element.className = `health-status health-${status}`;
                element.textContent = status.charAt(0).toUpperCase() + status.slice(1);
            }
        }
        
        function updateServiceStatus() {
            // Service status is already in the HTML, but we could update it dynamically here
            console.log('Service status updated');
        }
        
        async function runSystemDiagnostics() {
            showToast('Running system diagnostics...', 'info', 3000);
            
            try {
                // Simulate diagnostic checks
                const checks = [
                    { name: 'API Connectivity', status: 'checking' },
                    { name: 'Database Connection', status: 'checking' },
                    { name: 'Email Service', status: 'checking' },
                    { name: 'File Storage', status: 'checking' },
                    { name: 'SSL Certificate', status: 'checking' }
                ];
                
                for (const check of checks) {
                    await new Promise(resolve => setTimeout(resolve, 500)); // Simulate check time
                    console.log(`✓ ${check.name}: OK`);
                }
                
                showToast('System diagnostics completed successfully', 'success');
                
                // Log audit trail
                logAuditAction('system_diagnostics_run', {
                    checks: checks.length,
                    runBy: currentAdmin?.email || 'Unknown'
                });
                
            } catch (error) {
                console.error('Error running diagnostics:', error);
                showToast('System diagnostics failed', 'error');
            }
        }
        
        function openHealthConfigModal() {
            showToast('Health configuration modal - TODO: Implement', 'info');
            // TODO: Implement health configuration modal
        }
        
        function exportHealthReport() {
            const reportData = {
                timestamp: new Date().toISOString(),
                apiStatus: healthData.apiStatus,
                dbStatus: healthData.dbStatus,
                memoryUsage: healthData.memoryUsage,
                cpuUsage: healthData.cpuUsage,
                services: healthData.services
            };
            
            const csvContent = [
                ['Metric', 'Value', 'Status', 'Timestamp'],
                ['API Status', healthData.apiStatus, 'OK', new Date().toISOString()],
                ['Database', healthData.dbStatus, 'OK', new Date().toISOString()],
                ['Memory Usage', `${healthData.memoryUsage}%`, healthData.memoryUsage > 80 ? 'WARNING' : 'OK', new Date().toISOString()],
                ['CPU Usage', `${healthData.cpuUsage}%`, healthData.cpuUsage > 70 ? 'WARNING' : 'OK', new Date().toISOString()]
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `health_report_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showToast('Health report exported', 'success');
        }
        
        function refreshHealthStatus() {
            showToast('Refreshing health status...', 'info', 2000);
            loadSystemHealth().then(() => {
                showToast('Health status refreshed!', 'success', 3000);
            });
        }
        
        // Quick action functions
        function openSwaggerDocs() {
            window.open('https://241runners-api.azurewebsites.net/swagger', '_blank');
        }
        
        function viewSystemLogs() {
            showToast('System logs viewer - TODO: Implement', 'info');
            // TODO: Implement system logs viewer
        }
        
        function checkSSLStatus() {
            showToast('SSL status check - TODO: Implement', 'info');
            // TODO: Implement SSL status check
        }
        
        async function testAPIConnectivity() {
            showToast('Testing API connectivity...', 'info', 2000);
            
            try {
                const startTime = Date.now();
                const response = await fetch(`${window.API_BASE_URL.replace('/api', '')}/api/health`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                const responseTime = Date.now() - startTime;
                
                if (response.ok) {
                    showToast(`API connectivity test successful (${responseTime}ms)`, 'success');
                } else {
                    showToast(`API connectivity test failed (${response.status})`, 'error');
                }
            } catch (error) {
                showToast('API connectivity test failed', 'error');
            }
        }
        
        function viewPerformanceMetrics() {
            showToast('Performance metrics viewer - TODO: Implement', 'info');
            // TODO: Implement performance metrics viewer
        }
        
        function backupDatabase() {
            if (confirm('Are you sure you want to create a database backup?')) {
                showToast('Database backup initiated...', 'info', 3000);
                // TODO: Implement database backup
            }
        }
        
        // Service management functions
        function viewServiceLogs(service) {
            showToast(`Viewing ${service} logs - TODO: Implement`, 'info');
            // TODO: Implement service log viewer
        }
        
        function restartService(service) {
            if (confirm(`Are you sure you want to restart the ${service} service?`)) {
                showToast(`Restarting ${service} service...`, 'warning', 3000);
                // TODO: Implement service restart
            }
        }
        
        function optimizeDatabase() {
            if (confirm('Are you sure you want to optimize the database?')) {
                showToast('Database optimization initiated...', 'info', 3000);
                // TODO: Implement database optimization
            }
        }
        
        function testEmailService() {
            showToast('Testing email service...', 'info', 2000);
            // TODO: Implement email service test
        }
        
        function cleanupStorage() {
            if (confirm('Are you sure you want to cleanup storage?')) {
                showToast('Storage cleanup initiated...', 'info', 3000);
                // TODO: Implement storage cleanup
            }
        }

        // ===== MODERATION QUEUE FUNCTIONS =====
        
        // Global state for moderation queue
        let moderationData = {
            content: [],
            stats: {
                pendingReview: 23,
                approvedToday: 47,
                rejectedToday: 8,
                responseTime: 2.1
            }
        };

        async function loadModerationQueue() {
            try {
                console.log('Loading moderation queue...');
                
                // Mock data for now - TODO: Replace with API call
                moderationData.content = [
                    {
                        id: 'CONTENT-001',
                        type: 'case_report',
                        preview: 'Suspicious activity reported in downtown area...',
                        submittedBy: 'user@example.com',
                        priority: 'high',
                        status: 'pending',
                        reviewer: null,
                        submittedAt: new Date(Date.now() - 2 * 60 * 60 * 1000), // 2 hours ago
                        flags: ['inappropriate_language', 'spam']
                    },
                    {
                        id: 'CONTENT-002',
                        type: 'user_profile',
                        preview: 'Profile image contains potentially offensive content...',
                        submittedBy: 'moderator@241runnersawareness.org',
                        priority: 'medium',
                        status: 'in_review',
                        reviewer: 'dekuworks1@gmail.com',
                        submittedAt: new Date(Date.now() - 4 * 60 * 60 * 1000), // 4 hours ago
                        flags: ['inappropriate_content']
                    },
                    {
                        id: 'CONTENT-003',
                        type: 'comment',
                        preview: 'This is clearly spam content with multiple links...',
                        submittedBy: 'spam@example.com',
                        priority: 'low',
                        status: 'rejected',
                        reviewer: 'danielcarey9770@yahoo.com',
                        submittedAt: new Date(Date.now() - 6 * 60 * 60 * 1000), // 6 hours ago
                        flags: ['spam', 'multiple_links']
                    }
                ];
                
                updateModerationQueueUI();
                updateModerationStats();
                
            } catch (error) {
                console.error('Error loading moderation queue:', error);
                showToast('Failed to load moderation queue', 'error');
            }
        }
        
        function updateModerationQueueUI() {
            const tbody = document.getElementById('moderationTableBody');
            if (!tbody) return;
            
            if (moderationData.content.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" class="text-center text-gray-500">No content pending review</td></tr>';
                return;
            }
            
            const contentHTML = moderationData.content.map(item => {
                const timeSinceSubmitted = getTimeSince(item.submittedAt);
                const reviewerName = item.reviewer ? 
                    dashboardData.users.find(u => u.email === item.reviewer)?.firstName + ' ' + 
                    dashboardData.users.find(u => u.email === item.reviewer)?.lastName : 
                    'Unassigned';
                
                return `
                    <tr data-content-id="${item.id}">
                        <td>
                            <input type="checkbox" onchange="toggleModerationSelection(this)">
                        </td>
                        <td>
                            <span class="content-id">${item.id}</span>
                        </td>
                        <td>
                            <span class="content-type-badge content-type-${item.type}">${item.type.replace('_', ' ')}</span>
                        </td>
                        <td>
                            <div class="content-preview" title="${item.preview}">
                                ${item.preview}
                            </div>
                        </td>
                        <td>${item.submittedBy}</td>
                        <td>
                            <span class="priority-badge priority-${item.priority}">${item.priority}</span>
                        </td>
                        <td>
                            <span class="moderation-status-badge moderation-status-${item.status}">${item.status.replace('_', ' ')}</span>
                        </td>
                        <td>${reviewerName}</td>
                        <td>
                            <div>
                                ${timeSinceSubmitted}
                                <br>
                                <small class="text-gray-500">${item.submittedAt.toLocaleDateString()}</small>
                            </div>
                        </td>
                        <td>
                            <div class="moderation-actions">
                                <button class="moderation-action-btn moderation-action-btn-review" onclick="reviewContent('${item.id}')" title="Review Content">
                                    👁️
                                </button>
                                <button class="moderation-action-btn moderation-action-btn-approve" onclick="approveContent('${item.id}')" title="Approve">
                                    ✅
                                </button>
                                <button class="moderation-action-btn moderation-action-btn-reject" onclick="rejectContent('${item.id}')" title="Reject">
                                    ❌
                                </button>
                                <button class="moderation-action-btn moderation-action-btn-flag" onclick="flagContent('${item.id}')" title="Flag">
                                    🚩
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = contentHTML;
        }
        
        function updateModerationStats() {
            const stats = moderationData.stats;
            
            updateElement('pendingReviewCount', stats.pendingReview);
            updateElement('approvedTodayCount', stats.approvedToday);
            updateElement('rejectedTodayCount', stats.rejectedToday);
            updateElement('moderationResponseTime', `${stats.responseTime}h`);
            
            // Update status indicators
            updateModerationStatus('pendingReviewStatus', stats.pendingReview > 20 ? 'pending' : stats.pendingReview > 10 ? 'warning' : 'good');
            updateModerationStatus('approvedTodayStatus', stats.approvedToday > 40 ? 'approved' : 'warning');
            updateModerationStatus('rejectedTodayStatus', stats.rejectedToday > 15 ? 'rejected' : 'good');
            updateModerationStatus('moderationResponseStatus', stats.responseTime <= 2 ? 'good' : stats.responseTime <= 4 ? 'warning' : 'critical');
        }
        
        function updateModerationStatus(elementId, status) {
            const element = document.getElementById(elementId);
            if (element) {
                element.className = `moderation-status moderation-${status}`;
                element.textContent = status.charAt(0).toUpperCase() + status.slice(1);
            }
        }
        
        // Moderation action functions
        function openContentReviewModal() {
            showToast('Content review modal - TODO: Implement', 'info');
            // TODO: Implement content review modal
        }
        
        function openModerationConfigModal() {
            showToast('Moderation configuration modal - TODO: Implement', 'info');
            // TODO: Implement moderation configuration modal
        }
        
        function exportModerationReport() {
            const csvContent = [
                ['Content ID', 'Type', 'Status', 'Submitted By', 'Reviewer', 'Priority', 'Submitted', 'Flags'],
                ...moderationData.content.map(item => [
                    item.id,
                    item.type,
                    item.status,
                    item.submittedBy,
                    item.reviewer || 'Unassigned',
                    item.priority,
                    item.submittedAt.toLocaleDateString(),
                    item.flags.join('; ')
                ])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `moderation_report_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showToast('Moderation report exported', 'success');
        }
        
        function refreshModerationQueue() {
            showToast('Refreshing moderation queue...', 'info', 2000);
            loadModerationQueue().then(() => {
                showToast('Moderation queue refreshed!', 'success', 3000);
            });
        }
        
        function filterModerationQueue() {
            const typeFilter = document.getElementById('contentTypeFilter').value;
            const priorityFilter = document.getElementById('moderationPriorityFilter').value;
            const statusFilter = document.getElementById('moderationStatusFilter').value;
            const reviewerFilter = document.getElementById('moderationReviewerFilter').value;
            
            const rows = document.querySelectorAll('.moderation-table tbody tr');
            
            rows.forEach(row => {
                const contentId = row.dataset.contentId;
                const content = moderationData.content.find(c => c.id === contentId);
                
                if (!content) return;
                
                const matchesType = !typeFilter || content.type === typeFilter;
                const matchesPriority = !priorityFilter || content.priority === priorityFilter;
                const matchesStatus = !statusFilter || content.status === statusFilter;
                const matchesReviewer = !reviewerFilter || 
                    (reviewerFilter === 'unassigned' && !content.reviewer) ||
                    (reviewerFilter !== 'unassigned' && content.reviewer === reviewerFilter);
                
                if (matchesType && matchesPriority && matchesStatus && matchesReviewer) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function toggleSelectAllModeration() {
            const selectAllCheckbox = document.getElementById('selectAllModeration');
            const checkboxes = document.querySelectorAll('.moderation-table tbody input[type="checkbox"]');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
                checkbox.closest('tr').classList.toggle('selected', selectAllCheckbox.checked);
            });
        }
        
        function toggleModerationSelection(checkbox) {
            const row = checkbox.closest('tr');
            row.classList.toggle('selected', checkbox.checked);
        }
        
        // Bulk moderation actions
        function bulkApproveContent() {
            const selectedContent = document.querySelectorAll('.moderation-table tbody tr.selected');
            if (selectedContent.length === 0) {
                showToast('Please select content first', 'warning');
                return;
            }
            
            if (!confirm(`Are you sure you want to approve ${selectedContent.length} items?`)) {
                return;
            }
            
            try {
                const contentIds = Array.from(selectedContent).map(row => row.dataset.contentId);
                
                // Update content in moderation data
                contentIds.forEach(contentId => {
                    const content = moderationData.content.find(c => c.id === contentId);
                    if (content) {
                        content.status = 'approved';
                        content.reviewer = currentAdmin?.email || 'Unknown';
                    }
                });
                
                updateModerationQueueUI();
                updateModerationStats();
                showToast(`Approved ${contentIds.length} items`, 'success');
                
                // Log audit trail
                logAuditAction('bulk_content_approval', {
                    contentIds: contentIds,
                    count: contentIds.length,
                    approvedBy: currentAdmin?.email || 'Unknown'
                });
                
            } catch (error) {
                console.error('Error approving content:', error);
                showToast('Failed to approve content', 'error');
            }
        }
        
        function bulkRejectContent() {
            const selectedContent = document.querySelectorAll('.moderation-table tbody tr.selected');
            if (selectedContent.length === 0) {
                showToast('Please select content first', 'warning');
                return;
            }
            
            if (!confirm(`Are you sure you want to reject ${selectedContent.length} items?`)) {
                return;
            }
            
            try {
                const contentIds = Array.from(selectedContent).map(row => row.dataset.contentId);
                
                // Update content in moderation data
                contentIds.forEach(contentId => {
                    const content = moderationData.content.find(c => c.id === contentId);
                    if (content) {
                        content.status = 'rejected';
                        content.reviewer = currentAdmin?.email || 'Unknown';
                    }
                });
                
                updateModerationQueueUI();
                updateModerationStats();
                showToast(`Rejected ${contentIds.length} items`, 'success');
                
                // Log audit trail
                logAuditAction('bulk_content_rejection', {
                    contentIds: contentIds,
                    count: contentIds.length,
                    rejectedBy: currentAdmin?.email || 'Unknown'
                });
                
            } catch (error) {
                console.error('Error rejecting content:', error);
                showToast('Failed to reject content', 'error');
            }
        }
        
        function bulkFlagContent() {
            const selectedContent = document.querySelectorAll('.moderation-table tbody tr.selected');
            if (selectedContent.length === 0) {
                showToast('Please select content first', 'warning');
                return;
            }
            
            if (!confirm(`Are you sure you want to flag ${selectedContent.length} items?`)) {
                return;
            }
            
            try {
                const contentIds = Array.from(selectedContent).map(row => row.dataset.contentId);
                
                // Update content in moderation data
                contentIds.forEach(contentId => {
                    const content = moderationData.content.find(c => c.id === contentId);
                    if (content) {
                        content.status = 'flagged';
                        content.reviewer = currentAdmin?.email || 'Unknown';
                    }
                });
                
                updateModerationQueueUI();
                updateModerationStats();
                showToast(`Flagged ${contentIds.length} items`, 'success');
                
                // Log audit trail
                logAuditAction('bulk_content_flagging', {
                    contentIds: contentIds,
                    count: contentIds.length,
                    flaggedBy: currentAdmin?.email || 'Unknown'
                });
                
            } catch (error) {
                console.error('Error flagging content:', error);
                showToast('Failed to flag content', 'error');
            }
        }
        
        // Individual content actions
        function reviewContent(contentId) {
            const content = moderationData.content.find(c => c.id === contentId);
            if (content) {
                showToast(`Reviewing content: ${content.preview.substring(0, 50)}...`, 'info');
                // TODO: Implement content review modal
            }
        }
        
        function approveContent(contentId) {
            const content = moderationData.content.find(c => c.id === contentId);
            if (content) {
                content.status = 'approved';
                content.reviewer = currentAdmin?.email || 'Unknown';
                
                updateModerationQueueUI();
                updateModerationStats();
                showToast(`Content ${contentId} approved`, 'success');
                
                // Log audit trail
                logAuditAction('content_approved', {
                    contentId: contentId,
                    approvedBy: currentAdmin?.email || 'Unknown'
                });
            }
        }
        
        function rejectContent(contentId) {
            const content = moderationData.content.find(c => c.id === contentId);
            if (content) {
                content.status = 'rejected';
                content.reviewer = currentAdmin?.email || 'Unknown';
                
                updateModerationQueueUI();
                updateModerationStats();
                showToast(`Content ${contentId} rejected`, 'success');
                
                // Log audit trail
                logAuditAction('content_rejected', {
                    contentId: contentId,
                    rejectedBy: currentAdmin?.email || 'Unknown'
                });
            }
        }
        
        function flagContent(contentId) {
            const content = moderationData.content.find(c => c.id === contentId);
            if (content) {
                content.status = 'flagged';
                content.reviewer = currentAdmin?.email || 'Unknown';
                
                updateModerationQueueUI();
                updateModerationStats();
                showToast(`Content ${contentId} flagged`, 'success');
                
                // Log audit trail
                logAuditAction('content_flagged', {
                    contentId: contentId,
                    flaggedBy: currentAdmin?.email || 'Unknown'
                });
            }
        }

        // ===== NOTIFICATIONS & ESCALATION FUNCTIONS =====
        
        // Global state for notifications
        let notificationData = {
            notifications: [],
            stats: {
                pendingNotifications: 15,
                sentToday: 127,
                deliveryRate: 98.2,
                responseRate: 67.5
            },
            channels: {
                email: { status: 'active', sentToday: 89, deliveryRate: 99.1, openRate: 72.3 },
                sms: { status: 'active', sentToday: 23, deliveryRate: 95.7, responseRate: 78.3 },
                push: { status: 'active', sentToday: 15, deliveryRate: 93.3, clickRate: 45.2 },
                in_app: { status: 'active', sentToday: 34, deliveryRate: 100, readRate: 89.7 }
            }
        };

        async function loadNotifications() {
            try {
                console.log('Loading notifications data...');
                
                // Mock data for now - TODO: Replace with API call
                notificationData.notifications = [
                    {
                        id: 'MSG-001',
                        channel: 'email',
                        recipient: 'user@example.com',
                        subject: 'Case Update: Your report has been reviewed',
                        content: 'Your case report has been reviewed and approved...',
                        priority: 'normal',
                        status: 'delivered',
                        scheduledAt: new Date(Date.now() - 2 * 60 * 60 * 1000), // 2 hours ago
                        sentAt: new Date(Date.now() - 1.5 * 60 * 60 * 1000), // 1.5 hours ago
                        deliveredAt: new Date(Date.now() - 1 * 60 * 60 * 1000) // 1 hour ago
                    },
                    {
                        id: 'MSG-002',
                        channel: 'sms',
                        recipient: '+1234567890',
                        subject: 'Urgent: Security alert',
                        content: 'Security alert: Suspicious activity detected...',
                        priority: 'urgent',
                        status: 'sent',
                        scheduledAt: new Date(Date.now() - 30 * 60 * 1000), // 30 minutes ago
                        sentAt: new Date(Date.now() - 25 * 60 * 1000) // 25 minutes ago
                    },
                    {
                        id: 'MSG-003',
                        channel: 'push',
                        recipient: 'device_token_123',
                        subject: 'New case assigned',
                        content: 'You have been assigned a new case...',
                        priority: 'high',
                        status: 'pending',
                        scheduledAt: new Date(Date.now() + 10 * 60 * 1000) // 10 minutes from now
                    }
                ];
                
                updateNotificationQueueUI();
                updateNotificationStats();
                
            } catch (error) {
                console.error('Error loading notifications:', error);
                showToast('Failed to load notifications data', 'error');
            }
        }
        
        function updateNotificationQueueUI() {
            const tbody = document.getElementById('notificationTableBody');
            if (!tbody) return;
            
            if (notificationData.notifications.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="text-center text-gray-500">No notifications found</td></tr>';
                return;
            }
            
            const notificationsHTML = notificationData.notifications.map(notification => {
                const timeSinceScheduled = getTimeSince(notification.scheduledAt);
                const contentPreview = notification.subject || notification.content.substring(0, 50) + '...';
                
                return `
                    <tr data-notification-id="${notification.id}">
                        <td>
                            <input type="checkbox" onchange="toggleNotificationSelection(this)">
                        </td>
                        <td>
                            <span class="message-id">${notification.id}</span>
                        </td>
                        <td>
                            <span class="channel-badge ${notification.channel}">${notification.channel}</span>
                        </td>
                        <td>${notification.recipient}</td>
                        <td>
                            <div class="content-preview" title="${contentPreview}">
                                ${contentPreview}
                            </div>
                        </td>
                        <td>
                            <span class="notification-priority-badge notification-priority-${notification.priority}">${notification.priority}</span>
                        </td>
                        <td>
                            <span class="notification-status-badge notification-status-${notification.status}">${notification.status}</span>
                        </td>
                        <td>
                            <div>
                                ${timeSinceScheduled}
                                <br>
                                <small class="text-gray-500">${notification.scheduledAt.toLocaleDateString()}</small>
                            </div>
                        </td>
                        <td>
                            <div class="notification-actions">
                                <button class="notification-action-btn notification-action-btn-view" onclick="viewNotification('${notification.id}')" title="View Details">
                                    👁️
                                </button>
                                <button class="notification-action-btn notification-action-btn-send" onclick="sendNotification('${notification.id}')" title="Send Now" ${notification.status === 'sent' || notification.status === 'delivered' ? 'disabled' : ''}>
                                    📤
                                </button>
                                <button class="notification-action-btn notification-action-btn-cancel" onclick="cancelNotification('${notification.id}')" title="Cancel" ${notification.status === 'sent' || notification.status === 'delivered' ? 'disabled' : ''}>
                                    ❌
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = notificationsHTML;
        }
        
        function updateNotificationStats() {
            const stats = notificationData.stats;
            
            updateElement('pendingNotificationsCount', stats.pendingNotifications);
            updateElement('sentTodayCount', stats.sentToday);
            updateElement('deliveryRate', `${stats.deliveryRate}%`);
            updateElement('responseRate', `${stats.responseRate}%`);
            
            // Update status indicators
            updateNotificationStatus('pendingNotificationsStatus', stats.pendingNotifications > 20 ? 'pending' : stats.pendingNotifications > 10 ? 'warning' : 'good');
            updateNotificationStatus('sentTodayStatus', stats.sentToday > 100 ? 'sent' : 'warning');
            updateNotificationStatus('deliveryRateStatus', stats.deliveryRate >= 95 ? 'good' : stats.deliveryRate >= 90 ? 'warning' : 'critical');
            updateNotificationStatus('responseRateStatus', stats.responseRate >= 70 ? 'good' : stats.responseRate >= 50 ? 'warning' : 'critical');
        }
        
        function updateNotificationStatus(elementId, status) {
            const element = document.getElementById(elementId);
            if (element) {
                element.className = `notification-status notification-${status}`;
                element.textContent = status.charAt(0).toUpperCase() + status.slice(1);
            }
        }
        
        // Notification action functions
        function openNotificationComposer() {
            showToast('Notification composer modal - TODO: Implement', 'info');
            // TODO: Implement notification composer modal
        }
        
        function openEscalationConfigModal() {
            showToast('Escalation configuration modal - TODO: Implement', 'info');
            // TODO: Implement escalation configuration modal
        }
        
        function openTemplateManager() {
            showToast('Template manager modal - TODO: Implement', 'info');
            // TODO: Implement template manager modal
        }
        
        function exportNotificationReport() {
            const csvContent = [
                ['Message ID', 'Channel', 'Recipient', 'Subject', 'Priority', 'Status', 'Scheduled', 'Sent', 'Delivered'],
                ...notificationData.notifications.map(notification => [
                    notification.id,
                    notification.channel,
                    notification.recipient,
                    notification.subject || '',
                    notification.priority,
                    notification.status,
                    notification.scheduledAt.toLocaleDateString(),
                    notification.sentAt ? notification.sentAt.toLocaleDateString() : '',
                    notification.deliveredAt ? notification.deliveredAt.toLocaleDateString() : ''
                ])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `notification_report_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showToast('Notification report exported', 'success');
        }
        
        function refreshNotifications() {
            showToast('Refreshing notifications...', 'info', 2000);
            loadNotifications().then(() => {
                showToast('Notifications refreshed!', 'success', 3000);
            });
        }
        
        function filterNotificationQueue() {
            const channelFilter = document.getElementById('notificationChannelFilter').value;
            const statusFilter = document.getElementById('notificationStatusFilter').value;
            const priorityFilter = document.getElementById('notificationPriorityFilter').value;
            
            const rows = document.querySelectorAll('.notification-table tbody tr');
            
            rows.forEach(row => {
                const notificationId = row.dataset.notificationId;
                const notification = notificationData.notifications.find(n => n.id === notificationId);
                
                if (!notification) return;
                
                const matchesChannel = !channelFilter || notification.channel === channelFilter;
                const matchesStatus = !statusFilter || notification.status === statusFilter;
                const matchesPriority = !priorityFilter || notification.priority === priorityFilter;
                
                if (matchesChannel && matchesStatus && matchesPriority) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function toggleSelectAllNotifications() {
            const selectAllCheckbox = document.getElementById('selectAllNotifications');
            const checkboxes = document.querySelectorAll('.notification-table tbody input[type="checkbox"]');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
                checkbox.closest('tr').classList.toggle('selected', selectAllCheckbox.checked);
            });
        }
        
        function toggleNotificationSelection(checkbox) {
            const row = checkbox.closest('tr');
            row.classList.toggle('selected', checkbox.checked);
        }
        
        // Bulk notification actions
        function bulkSendNotifications() {
            const selectedNotifications = document.querySelectorAll('.notification-table tbody tr.selected');
            if (selectedNotifications.length === 0) {
                showToast('Please select notifications first', 'warning');
                return;
            }
            
            if (!confirm(`Are you sure you want to send ${selectedNotifications.length} notifications?`)) {
                return;
            }
            
            try {
                const notificationIds = Array.from(selectedNotifications).map(row => row.dataset.notificationId);
                
                // Update notifications in data
                notificationIds.forEach(notificationId => {
                    const notification = notificationData.notifications.find(n => n.id === notificationId);
                    if (notification && notification.status === 'pending') {
                        notification.status = 'sent';
                        notification.sentAt = new Date();
                    }
                });
                
                updateNotificationQueueUI();
                updateNotificationStats();
                showToast(`Sent ${notificationIds.length} notifications`, 'success');
                
                // Log audit trail
                logAuditAction('bulk_notification_send', {
                    notificationIds: notificationIds,
                    count: notificationIds.length,
                    sentBy: currentAdmin?.email || 'Unknown'
                });
                
            } catch (error) {
                console.error('Error sending notifications:', error);
                showToast('Failed to send notifications', 'error');
            }
        }
        
        function bulkCancelNotifications() {
            const selectedNotifications = document.querySelectorAll('.notification-table tbody tr.selected');
            if (selectedNotifications.length === 0) {
                showToast('Please select notifications first', 'warning');
                return;
            }
            
            if (!confirm(`Are you sure you want to cancel ${selectedNotifications.length} notifications?`)) {
                return;
            }
            
            try {
                const notificationIds = Array.from(selectedNotifications).map(row => row.dataset.notificationId);
                
                // Update notifications in data
                notificationIds.forEach(notificationId => {
                    const notification = notificationData.notifications.find(n => n.id === notificationId);
                    if (notification && notification.status === 'pending') {
                        notification.status = 'cancelled';
                    }
                });
                
                updateNotificationQueueUI();
                updateNotificationStats();
                showToast(`Cancelled ${notificationIds.length} notifications`, 'success');
                
                // Log audit trail
                logAuditAction('bulk_notification_cancel', {
                    notificationIds: notificationIds,
                    count: notificationIds.length,
                    cancelledBy: currentAdmin?.email || 'Unknown'
                });
                
            } catch (error) {
                console.error('Error cancelling notifications:', error);
                showToast('Failed to cancel notifications', 'error');
            }
        }
        
        // Individual notification actions
        function viewNotification(notificationId) {
            const notification = notificationData.notifications.find(n => n.id === notificationId);
            if (notification) {
                showToast(`Viewing notification: ${notification.subject || notification.content.substring(0, 50)}...`, 'info');
                // TODO: Implement notification details modal
            }
        }
        
        function sendNotification(notificationId) {
            const notification = notificationData.notifications.find(n => n.id === notificationId);
            if (notification && notification.status === 'pending') {
                notification.status = 'sent';
                notification.sentAt = new Date();
                
                updateNotificationQueueUI();
                updateNotificationStats();
                showToast(`Notification ${notificationId} sent`, 'success');
                
                // Log audit trail
                logAuditAction('notification_sent', {
                    notificationId: notificationId,
                    sentBy: currentAdmin?.email || 'Unknown'
                });
            }
        }
        
        function cancelNotification(notificationId) {
            const notification = notificationData.notifications.find(n => n.id === notificationId);
            if (notification && notification.status === 'pending') {
                notification.status = 'cancelled';
                
                updateNotificationQueueUI();
                updateNotificationStats();
                showToast(`Notification ${notificationId} cancelled`, 'success');
                
                // Log audit trail
                logAuditAction('notification_cancelled', {
                    notificationId: notificationId,
                    cancelledBy: currentAdmin?.email || 'Unknown'
                });
            }
        }
        
        // Channel management functions
        function testEmailChannel() {
            showToast('Testing email channel...', 'info', 2000);
            // TODO: Implement email channel test
        }
        
        function configureEmailChannel() {
            showToast('Email channel configuration - TODO: Implement', 'info');
            // TODO: Implement email channel configuration
        }
        
        function testSMSChannel() {
            showToast('Testing SMS channel...', 'info', 2000);
            // TODO: Implement SMS channel test
        }
        
        function configureSMSChannel() {
            showToast('SMS channel configuration - TODO: Implement', 'info');
            // TODO: Implement SMS channel configuration
        }
        
        function testPushChannel() {
            showToast('Testing push notification channel...', 'info', 2000);
            // TODO: Implement push channel test
        }
        
        function configurePushChannel() {
            showToast('Push notification channel configuration - TODO: Implement', 'info');
            // TODO: Implement push channel configuration
        }
        
        function testInAppChannel() {
            showToast('Testing in-app message channel...', 'info', 2000);
            // TODO: Implement in-app channel test
        }
        
        function configureInAppChannel() {
            showToast('In-app message channel configuration - TODO: Implement', 'info');
            // TODO: Implement in-app channel configuration
        }

        // ===== DATA QUALITY & DUPLICATE DETECTION FUNCTIONS =====
        
        // Global state for data quality
        let dataQualityData = {
            duplicates: [],
            incomplete: [],
            invalid: [],
            inconsistent: [],
            stats: {
                dataCompleteness: 94.2,
                duplicateRecords: 23,
                dataAccuracy: 97.8,
                dataConsistency: 96.5
            }
        };

        async function loadDataQuality() {
            try {
                console.log('Loading data quality data...');
                
                // Mock data for duplicates
                dataQualityData.duplicates = [
                    {
                        id: 'DUP-001',
                        type: 'users',
                        primaryRecord: { id: 'USR-001', name: 'John Doe', email: 'john@example.com' },
                        duplicateRecord: { id: 'USR-002', name: 'John Doe', email: 'john.doe@example.com' },
                        similarity: 95,
                        confidence: 'high'
                    },
                    {
                        id: 'DUP-002',
                        type: 'cases',
                        primaryRecord: { id: 'CASE-001', title: 'Missing Person Report', location: 'Downtown' },
                        duplicateRecord: { id: 'CASE-002', title: 'Missing Person Report', location: 'Downtown Area' },
                        similarity: 88,
                        confidence: 'medium'
                    }
                ];
                
                // Mock data for incomplete records
                dataQualityData.incomplete = [
                    {
                        id: 'INC-001',
                        type: 'users',
                        missingFields: ['phone', 'address'],
                        completeness: 75,
                        lastUpdated: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000) // 2 days ago
                    },
                    {
                        id: 'INC-002',
                        type: 'cases',
                        missingFields: ['description'],
                        completeness: 90,
                        lastUpdated: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000) // 1 day ago
                    }
                ];
                
                // Mock data for invalid records
                dataQualityData.invalid = [
                    {
                        id: 'INV-001',
                        type: 'users',
                        validationRule: 'email_format',
                        issue: 'Invalid email format: user@invalid',
                        severity: 'critical'
                    },
                    {
                        id: 'INV-002',
                        type: 'cases',
                        validationRule: 'date_range',
                        issue: 'Future date in past incident',
                        severity: 'warning'
                    }
                ];
                
                // Mock data for inconsistent records
                dataQualityData.inconsistent = [
                    {
                        id: 'CON-001',
                        type: 'users',
                        consistencyRule: 'data_format',
                        issue: 'Phone number format inconsistency',
                        impact: 'medium'
                    },
                    {
                        id: 'CON-002',
                        type: 'cases',
                        consistencyRule: 'reference_integrity',
                        issue: 'Referenced user does not exist',
                        impact: 'high'
                    }
                ];
                
                updateDataQualityUI();
                updateDataQualityStats();
                
            } catch (error) {
                console.error('Error loading data quality data:', error);
                showToast('Failed to load data quality data', 'error');
            }
        }
        
        function updateDataQualityUI() {
            updateDuplicatesTable();
            updateIncompleteTable();
            updateInvalidTable();
            updateInconsistentTable();
        }
        
        function updateDataQualityStats() {
            const stats = dataQualityData.stats;
            
            updateElement('dataCompletenessRate', `${stats.dataCompleteness}%`);
            updateElement('duplicateRecordsCount', stats.duplicateRecords);
            updateElement('dataAccuracyRate', `${stats.dataAccuracy}%`);
            updateElement('dataConsistencyRate', `${stats.dataConsistency}%`);
            
            // Update status indicators
            updateDataQualityStatus('dataCompletenessStatus', stats.dataCompleteness >= 95 ? 'good' : stats.dataCompleteness >= 85 ? 'warning' : 'critical');
            updateDataQualityStatus('duplicateRecordsStatus', stats.duplicateRecords <= 10 ? 'good' : stats.duplicateRecords <= 25 ? 'warning' : 'critical');
            updateDataQualityStatus('dataAccuracyStatus', stats.dataAccuracy >= 95 ? 'good' : stats.dataAccuracy >= 85 ? 'warning' : 'critical');
            updateDataQualityStatus('dataConsistencyStatus', stats.dataConsistency >= 95 ? 'good' : stats.dataConsistency >= 85 ? 'warning' : 'critical');
        }
        
        function updateDataQualityStatus(elementId, status) {
            const element = document.getElementById(elementId);
            if (element) {
                element.className = `quality-status quality-${status}`;
                element.textContent = status.charAt(0).toUpperCase() + status.slice(1);
            }
        }
        
        function updateDuplicatesTable() {
            const tbody = document.getElementById('duplicatesTableBody');
            if (!tbody) return;
            
            if (dataQualityData.duplicates.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center text-gray-500">No duplicates found</td></tr>';
                return;
            }
            
            const duplicatesHTML = dataQualityData.duplicates.map(duplicate => {
                return `
                    <tr data-duplicate-id="${duplicate.id}">
                        <td>
                            <input type="checkbox" onchange="toggleDuplicateSelection(this)">
                        </td>
                        <td>
                            <span class="record-type-badge">${duplicate.type}</span>
                        </td>
                        <td>
                            <div class="record-info">
                                <strong>${duplicate.primaryRecord.id}</strong>
                                <br>
                                <small>${duplicate.primaryRecord.name || duplicate.primaryRecord.title}</small>
                            </div>
                        </td>
                        <td>
                            <div class="record-info">
                                <strong>${duplicate.duplicateRecord.id}</strong>
                                <br>
                                <small>${duplicate.duplicateRecord.name || duplicate.duplicateRecord.title}</small>
                            </div>
                        </td>
                        <td>
                            <span class="similarity-badge similarity-${duplicate.similarity >= 90 ? 'high' : duplicate.similarity >= 70 ? 'medium' : 'low'}">
                                ${duplicate.similarity}%
                            </span>
                        </td>
                        <td>
                            <span class="confidence-badge confidence-${duplicate.confidence}">
                                ${duplicate.confidence}
                            </span>
                        </td>
                        <td>
                            <div class="duplicate-actions">
                                <button class="btn btn-sm btn-primary" onclick="mergeDuplicate('${duplicate.id}')" title="Merge Records">
                                    🔗
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteDuplicate('${duplicate.id}')" title="Delete Duplicate">
                                    🗑️
                                </button>
                                <button class="btn btn-sm btn-outline" onclick="viewDuplicate('${duplicate.id}')" title="View Details">
                                    👁️
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = duplicatesHTML;
        }
        
        function updateIncompleteTable() {
            const tbody = document.getElementById('incompleteTableBody');
            if (!tbody) return;
            
            if (dataQualityData.incomplete.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center text-gray-500">No incomplete records found</td></tr>';
                return;
            }
            
            const incompleteHTML = dataQualityData.incomplete.map(record => {
                return `
                    <tr data-incomplete-id="${record.id}">
                        <td>
                            <input type="checkbox" onchange="toggleIncompleteSelection(this)">
                        </td>
                        <td>
                            <span class="record-id">${record.id}</span>
                        </td>
                        <td>
                            <span class="record-type-badge">${record.type}</span>
                        </td>
                        <td>
                            <span class="missing-fields">${record.missingFields.join(', ')}</span>
                        </td>
                        <td>
                            <span class="completeness-badge completeness-${record.completeness >= 90 ? 'good' : record.completeness >= 75 ? 'warning' : 'critical'}">
                                ${record.completeness}%
                            </span>
                        </td>
                        <td>
                            ${getTimeSince(record.lastUpdated)}
                        </td>
                        <td>
                            <div class="incomplete-actions">
                                <button class="btn btn-sm btn-primary" onclick="editIncomplete('${record.id}')" title="Edit Record">
                                    ✏️
                                </button>
                                <button class="btn btn-sm btn-outline" onclick="viewIncomplete('${record.id}')" title="View Details">
                                    👁️
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = incompleteHTML;
        }
        
        function updateInvalidTable() {
            const tbody = document.getElementById('invalidTableBody');
            if (!tbody) return;
            
            if (dataQualityData.invalid.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center text-gray-500">No invalid records found</td></tr>';
                return;
            }
            
            const invalidHTML = dataQualityData.invalid.map(record => {
                return `
                    <tr data-invalid-id="${record.id}">
                        <td>
                            <input type="checkbox" onchange="toggleInvalidSelection(this)">
                        </td>
                        <td>
                            <span class="record-id">${record.id}</span>
                        </td>
                        <td>
                            <span class="record-type-badge">${record.type}</span>
                        </td>
                        <td>
                            <span class="validation-rule">${record.validationRule}</span>
                        </td>
                        <td>
                            <span class="issue-description">${record.issue}</span>
                        </td>
                        <td>
                            <span class="severity-badge severity-${record.severity}">
                                ${record.severity}
                            </span>
                        </td>
                        <td>
                            <div class="invalid-actions">
                                <button class="btn btn-sm btn-warning" onclick="fixInvalid('${record.id}')" title="Fix Issue">
                                    🔧
                                </button>
                                <button class="btn btn-sm btn-outline" onclick="viewInvalid('${record.id}')" title="View Details">
                                    👁️
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = invalidHTML;
        }
        
        function updateInconsistentTable() {
            const tbody = document.getElementById('inconsistentTableBody');
            if (!tbody) return;
            
            if (dataQualityData.inconsistent.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center text-gray-500">No inconsistent records found</td></tr>';
                return;
            }
            
            const inconsistentHTML = dataQualityData.inconsistent.map(record => {
                return `
                    <tr data-inconsistent-id="${record.id}">
                        <td>
                            <input type="checkbox" onchange="toggleInconsistentSelection(this)">
                        </td>
                        <td>
                            <span class="record-id">${record.id}</span>
                        </td>
                        <td>
                            <span class="record-type-badge">${record.type}</span>
                        </td>
                        <td>
                            <span class="consistency-rule">${record.consistencyRule}</span>
                        </td>
                        <td>
                            <span class="issue-description">${record.issue}</span>
                        </td>
                        <td>
                            <span class="impact-badge impact-${record.impact}">
                                ${record.impact}
                            </span>
                        </td>
                        <td>
                            <div class="inconsistent-actions">
                                <button class="btn btn-sm btn-primary" onclick="resolveInconsistent('${record.id}')" title="Resolve Issue">
                                    ✅
                                </button>
                                <button class="btn btn-sm btn-outline" onclick="viewInconsistent('${record.id}')" title="View Details">
                                    👁️
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = inconsistentHTML;
        }
        
        // Data Quality action functions
        function runDataQualityScan() {
            showToast('Running data quality scan...', 'info', 3000);
            // TODO: Implement actual data quality scan
            setTimeout(() => {
                showToast('Data quality scan completed!', 'success');
                loadDataQuality();
            }, 3000);
        }
        
        function openDataQualityConfig() {
            showToast('Data quality configuration modal - TODO: Implement', 'info');
            // TODO: Implement data quality configuration modal
        }
        
        function exportDataQualityReport() {
            const csvContent = [
                ['Issue Type', 'Record ID', 'Type', 'Issue', 'Severity/Impact', 'Status'],
                ...dataQualityData.duplicates.map(dup => ['Duplicate', dup.id, dup.type, `${dup.primaryRecord.id} vs ${dup.duplicateRecord.id}`, dup.confidence, 'Pending']),
                ...dataQualityData.incomplete.map(inc => ['Incomplete', inc.id, inc.type, `Missing: ${inc.missingFields.join(', ')}`, `${inc.completeness}%`, 'Pending']),
                ...dataQualityData.invalid.map(inv => ['Invalid', inv.id, inv.type, inv.issue, inv.severity, 'Pending']),
                ...dataQualityData.inconsistent.map(con => ['Inconsistent', con.id, con.type, con.issue, con.impact, 'Pending'])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `data_quality_report_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showToast('Data quality report exported', 'success');
        }
        
        function refreshDataQuality() {
            showToast('Refreshing data quality...', 'info', 2000);
            loadDataQuality().then(() => {
                showToast('Data quality refreshed!', 'success', 3000);
            });
        }
        
        // Tab switching functions
        function switchQualityTab(tabName) {
            // Remove active class from all tabs and content
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.quality-tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab and content
            document.querySelector(`[onclick="switchQualityTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }
        
        // Filter functions
        function filterDuplicates() {
            const typeFilter = document.getElementById('duplicateTypeFilter').value;
            const similarityFilter = document.getElementById('duplicateSimilarityFilter').value;
            
            const rows = document.querySelectorAll('.duplicates-table tbody tr');
            
            rows.forEach(row => {
                const duplicateId = row.dataset.duplicateId;
                const duplicate = dataQualityData.duplicates.find(d => d.id === duplicateId);
                
                if (!duplicate) return;
                
                const matchesType = !typeFilter || duplicate.type === typeFilter;
                const matchesSimilarity = !similarityFilter || 
                    (similarityFilter === 'high' && duplicate.similarity >= 90) ||
                    (similarityFilter === 'medium' && duplicate.similarity >= 70 && duplicate.similarity < 90) ||
                    (similarityFilter === 'low' && duplicate.similarity < 70);
                
                if (matchesType && matchesSimilarity) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function filterIncomplete() {
            const fieldFilter = document.getElementById('missingFieldFilter').value;
            const typeFilter = document.getElementById('incompleteTypeFilter').value;
            
            const rows = document.querySelectorAll('.incomplete-table tbody tr');
            
            rows.forEach(row => {
                const incompleteId = row.dataset.incompleteId;
                const record = dataQualityData.incomplete.find(r => r.id === incompleteId);
                
                if (!record) return;
                
                const matchesField = !fieldFilter || record.missingFields.includes(fieldFilter);
                const matchesType = !typeFilter || record.type === typeFilter;
                
                if (matchesField && matchesType) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function filterInvalid() {
            const ruleFilter = document.getElementById('validationRuleFilter').value;
            const severityFilter = document.getElementById('invalidSeverityFilter').value;
            
            const rows = document.querySelectorAll('.invalid-table tbody tr');
            
            rows.forEach(row => {
                const invalidId = row.dataset.invalidId;
                const record = dataQualityData.invalid.find(r => r.id === invalidId);
                
                if (!record) return;
                
                const matchesRule = !ruleFilter || record.validationRule === ruleFilter;
                const matchesSeverity = !severityFilter || record.severity === severityFilter;
                
                if (matchesRule && matchesSeverity) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function filterInconsistent() {
            const ruleFilter = document.getElementById('consistencyRuleFilter').value;
            const impactFilter = document.getElementById('inconsistentImpactFilter').value;
            
            const rows = document.querySelectorAll('.inconsistent-table tbody tr');
            
            rows.forEach(row => {
                const inconsistentId = row.dataset.inconsistentId;
                const record = dataQualityData.inconsistent.find(r => r.id === inconsistentId);
                
                if (!record) return;
                
                const matchesRule = !ruleFilter || record.consistencyRule === ruleFilter;
                const matchesImpact = !impactFilter || record.impact === impactFilter;
                
                if (matchesRule && matchesImpact) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        // Selection functions
        function toggleSelectAllDuplicates() {
            const selectAllCheckbox = document.getElementById('selectAllDuplicates');
            const checkboxes = document.querySelectorAll('.duplicates-table tbody input[type="checkbox"]');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
                checkbox.closest('tr').classList.toggle('selected', selectAllCheckbox.checked);
            });
        }
        
        function toggleSelectAllIncomplete() {
            const selectAllCheckbox = document.getElementById('selectAllIncomplete');
            const checkboxes = document.querySelectorAll('.incomplete-table tbody input[type="checkbox"]');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
                checkbox.closest('tr').classList.toggle('selected', selectAllCheckbox.checked);
            });
        }
        
        function toggleSelectAllInvalid() {
            const selectAllCheckbox = document.getElementById('selectAllInvalid');
            const checkboxes = document.querySelectorAll('.invalid-table tbody input[type="checkbox"]');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
                checkbox.closest('tr').classList.toggle('selected', selectAllCheckbox.checked);
            });
        }
        
        function toggleSelectAllInconsistent() {
            const selectAllCheckbox = document.getElementById('selectAllInconsistent');
            const checkboxes = document.querySelectorAll('.inconsistent-table tbody input[type="checkbox"]');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
                checkbox.closest('tr').classList.toggle('selected', selectAllCheckbox.checked);
            });
        }
        
        function toggleDuplicateSelection(checkbox) {
            const row = checkbox.closest('tr');
            row.classList.toggle('selected', checkbox.checked);
        }
        
        function toggleIncompleteSelection(checkbox) {
            const row = checkbox.closest('tr');
            row.classList.toggle('selected', checkbox.checked);
        }
        
        function toggleInvalidSelection(checkbox) {
            const row = checkbox.closest('tr');
            row.classList.toggle('selected', checkbox.checked);
        }
        
        function toggleInconsistentSelection(checkbox) {
            const row = checkbox.closest('tr');
            row.classList.toggle('selected', checkbox.checked);
        }
        
        // Bulk action functions
        function bulkMergeDuplicates() {
            const selectedDuplicates = document.querySelectorAll('.duplicates-table tbody tr.selected');
            if (selectedDuplicates.length === 0) {
                showToast('Please select duplicates first', 'warning');
                return;
            }
            
            if (!confirm(`Are you sure you want to merge ${selectedDuplicates.length} duplicate pairs?`)) {
                return;
            }
            
            try {
                const duplicateIds = Array.from(selectedDuplicates).map(row => row.dataset.duplicateId);
                
                // Remove merged duplicates from data
                dataQualityData.duplicates = dataQualityData.duplicates.filter(d => !duplicateIds.includes(d.id));
                dataQualityData.stats.duplicateRecords -= duplicateIds.length;
                
                updateDuplicatesTable();
                updateDataQualityStats();
                showToast(`Merged ${duplicateIds.length} duplicate pairs`, 'success');
                
                // Log audit trail
                logAuditAction('bulk_merge_duplicates', {
                    duplicateIds: duplicateIds,
                    count: duplicateIds.length,
                    mergedBy: currentAdmin?.email || 'Unknown'
                });
                
            } catch (error) {
                console.error('Error merging duplicates:', error);
                showToast('Failed to merge duplicates', 'error');
            }
        }
        
        function bulkDeleteDuplicates() {
            const selectedDuplicates = document.querySelectorAll('.duplicates-table tbody tr.selected');
            if (selectedDuplicates.length === 0) {
                showToast('Please select duplicates first', 'warning');
                return;
            }
            
            if (!confirm(`Are you sure you want to delete ${selectedDuplicates.length} duplicate records?`)) {
                return;
            }
            
            try {
                const duplicateIds = Array.from(selectedDuplicates).map(row => row.dataset.duplicateId);
                
                // Remove deleted duplicates from data
                dataQualityData.duplicates = dataQualityData.duplicates.filter(d => !duplicateIds.includes(d.id));
                dataQualityData.stats.duplicateRecords -= duplicateIds.length;
                
                updateDuplicatesTable();
                updateDataQualityStats();
                showToast(`Deleted ${duplicateIds.length} duplicate records`, 'success');
                
                // Log audit trail
                logAuditAction('bulk_delete_duplicates', {
                    duplicateIds: duplicateIds,
                    count: duplicateIds.length,
                    deletedBy: currentAdmin?.email || 'Unknown'
                });
                
            } catch (error) {
                console.error('Error deleting duplicates:', error);
                showToast('Failed to delete duplicates', 'error');
            }
        }
        
        function bulkUpdateIncomplete() {
            const selectedIncomplete = document.querySelectorAll('.incomplete-table tbody tr.selected');
            if (selectedIncomplete.length === 0) {
                showToast('Please select incomplete records first', 'warning');
                return;
            }
            
            showToast(`Bulk update for ${selectedIncomplete.length} incomplete records - TODO: Implement`, 'info');
            // TODO: Implement bulk update modal
        }
        
        function bulkFixInvalid() {
            const selectedInvalid = document.querySelectorAll('.invalid-table tbody tr.selected');
            if (selectedInvalid.length === 0) {
                showToast('Please select invalid records first', 'warning');
                return;
            }
            
            showToast(`Bulk fix for ${selectedInvalid.length} invalid records - TODO: Implement`, 'info');
            // TODO: Implement bulk fix modal
        }
        
        function bulkResolveInconsistent() {
            const selectedInconsistent = document.querySelectorAll('.inconsistent-table tbody tr.selected');
            if (selectedInconsistent.length === 0) {
                showToast('Please select inconsistent records first', 'warning');
                return;
            }
            
            showToast(`Bulk resolve for ${selectedInconsistent.length} inconsistent records - TODO: Implement`, 'info');
            // TODO: Implement bulk resolve modal
        }
        
        // Export functions
        function exportDuplicatesReport() {
            const csvContent = [
                ['Duplicate ID', 'Type', 'Primary Record', 'Duplicate Record', 'Similarity', 'Confidence'],
                ...dataQualityData.duplicates.map(dup => [
                    dup.id,
                    dup.type,
                    dup.primaryRecord.id,
                    dup.duplicateRecord.id,
                    dup.similarity,
                    dup.confidence
                ])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `duplicates_report_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showToast('Duplicates report exported', 'success');
        }
        
        function exportIncompleteReport() {
            const csvContent = [
                ['Record ID', 'Type', 'Missing Fields', 'Completeness', 'Last Updated'],
                ...dataQualityData.incomplete.map(inc => [
                    inc.id,
                    inc.type,
                    inc.missingFields.join(';'),
                    inc.completeness,
                    inc.lastUpdated.toLocaleDateString()
                ])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `incomplete_records_report_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showToast('Incomplete records report exported', 'success');
        }
        
        function exportInvalidReport() {
            const csvContent = [
                ['Record ID', 'Type', 'Validation Rule', 'Issue', 'Severity'],
                ...dataQualityData.invalid.map(inv => [
                    inv.id,
                    inv.type,
                    inv.validationRule,
                    inv.issue,
                    inv.severity
                ])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `invalid_records_report_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showToast('Invalid records report exported', 'success');
        }
        
        function exportInconsistentReport() {
            const csvContent = [
                ['Record ID', 'Type', 'Consistency Rule', 'Issue', 'Impact'],
                ...dataQualityData.inconsistent.map(con => [
                    con.id,
                    con.type,
                    con.consistencyRule,
                    con.issue,
                    con.impact
                ])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `inconsistent_records_report_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showToast('Inconsistent records report exported', 'success');
        }
        
        // Individual action functions
        function mergeDuplicate(duplicateId) {
            const duplicate = dataQualityData.duplicates.find(d => d.id === duplicateId);
            if (duplicate) {
                showToast(`Merging duplicate: ${duplicate.primaryRecord.id} with ${duplicate.duplicateRecord.id}`, 'info');
                // TODO: Implement merge modal
            }
        }
        
        function deleteDuplicate(duplicateId) {
            const duplicate = dataQualityData.duplicates.find(d => d.id === duplicateId);
            if (duplicate) {
                if (confirm(`Are you sure you want to delete duplicate ${duplicateId}?`)) {
                    dataQualityData.duplicates = dataQualityData.duplicates.filter(d => d.id !== duplicateId);
                    dataQualityData.stats.duplicateRecords--;
                    updateDuplicatesTable();
                    updateDataQualityStats();
                    showToast(`Deleted duplicate ${duplicateId}`, 'success');
                }
            }
        }
        
        function viewDuplicate(duplicateId) {
            const duplicate = dataQualityData.duplicates.find(d => d.id === duplicateId);
            if (duplicate) {
                showToast(`Viewing duplicate details: ${duplicateId}`, 'info');
                // TODO: Implement duplicate details modal
            }
        }
        
        function editIncomplete(recordId) {
            const record = dataQualityData.incomplete.find(r => r.id === recordId);
            if (record) {
                showToast(`Editing incomplete record: ${recordId}`, 'info');
                // TODO: Implement edit modal
            }
        }
        
        function viewIncomplete(recordId) {
            const record = dataQualityData.incomplete.find(r => r.id === recordId);
            if (record) {
                showToast(`Viewing incomplete record: ${recordId}`, 'info');
                // TODO: Implement view modal
            }
        }
        
        function fixInvalid(recordId) {
            const record = dataQualityData.invalid.find(r => r.id === recordId);
            if (record) {
                showToast(`Fixing invalid record: ${recordId}`, 'info');
                // TODO: Implement fix modal
            }
        }
        
        function viewInvalid(recordId) {
            const record = dataQualityData.invalid.find(r => r.id === recordId);
            if (record) {
                showToast(`Viewing invalid record: ${recordId}`, 'info');
                // TODO: Implement view modal
            }
        }
        
        function resolveInconsistent(recordId) {
            const record = dataQualityData.inconsistent.find(r => r.id === recordId);
            if (record) {
                showToast(`Resolving inconsistent record: ${recordId}`, 'info');
                // TODO: Implement resolve modal
            }
        }
        
        function viewInconsistent(recordId) {
            const record = dataQualityData.inconsistent.find(r => r.id === recordId);
            if (record) {
                showToast(`Viewing inconsistent record: ${recordId}`, 'info');
                // TODO: Implement view modal
            }
        }

        // ===== USER SELECTION AND FILTERING FUNCTIONS =====
        
        function selectAllUsers() {
            const checkboxes = document.querySelectorAll('.users-table tbody input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
                checkbox.closest('tr').classList.add('selected');
            });
            updateBulkActionsCount();
        }
        
        function clearSelection() {
            const checkboxes = document.querySelectorAll('.users-table tbody input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
                checkbox.closest('tr').classList.remove('selected');
            });
            document.getElementById('selectAllCheckbox').checked = false;
            updateBulkActionsCount();
        }
        
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            const checkboxes = document.querySelectorAll('.users-table tbody input[type="checkbox"]');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
                checkbox.closest('tr').classList.toggle('selected', selectAllCheckbox.checked);
            });
            updateBulkActionsCount();
        }
        
        function toggleUserSelection(checkbox) {
            const row = checkbox.closest('tr');
            row.classList.toggle('selected', checkbox.checked);
            updateBulkActionsCount();
            
            // Update select all checkbox
            const allCheckboxes = document.querySelectorAll('.users-table tbody input[type="checkbox"]');
            const checkedCount = document.querySelectorAll('.users-table tbody input[type="checkbox"]:checked').length;
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            
            if (checkedCount === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (checkedCount === allCheckboxes.length) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
        }
        
        function filterUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const roleFilter = document.getElementById('roleFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            const rows = document.querySelectorAll('.users-table tbody tr');
            
            rows.forEach(row => {
                const email = row.cells[2].textContent.toLowerCase();
                const name = row.cells[1].textContent.toLowerCase();
                const role = row.cells[3].textContent.toLowerCase();
                const status = row.cells[4].textContent.toLowerCase();
                
                const matchesSearch = !searchTerm || 
                    email.includes(searchTerm) || 
                    name.includes(searchTerm);
                const matchesRole = !roleFilter || role.includes(roleFilter);
                const matchesStatus = !statusFilter || status.includes(statusFilter);
                
                if (matchesSearch && matchesRole && matchesStatus) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function refreshUsersData() {
            showToast('Refreshing users data...', 'info', 2000);
            loadUsers().then(() => {
                updateDashboardUI();
                showToast('Users data refreshed!', 'success', 3000);
            });
        }

        // ===== LOGOUT FUNCTION =====
        
        async function logout() {
            try {
                console.log('🚪 Logout initiated...');
                
                // Disconnect real-time system
                if (typeof AdminRealtime !== 'undefined' && AdminRealtime.disconnect) {
                    try {
                        await AdminRealtime.disconnect();
                    } catch (error) {
                        console.warn('Error disconnecting real-time system:', error);
                    }
                }
                
                // Stop monitoring system
                if (typeof AdminMonitoringSystem !== 'undefined' && AdminMonitoringSystem.stopMonitoring) {
                    try {
                        AdminMonitoringSystem.stopMonitoring();
                    } catch (error) {
                        console.warn('Error stopping monitoring system:', error);
                    }
                }
                
                // Clear profile data
                if (typeof AdminProfileManager !== 'undefined' && AdminProfileManager.clearProfile) {
                    try {
                        AdminProfileManager.clearProfile();
                    } catch (error) {
                        console.warn('Error clearing profile:', error);
                    }
                }
                
                // Clear authentication data
                clearAuthData();
                
                // Stop intervals
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                    refreshInterval = null;
                }
                
                console.log('✅ Logout completed, redirecting...');
                
                // Force immediate redirect with cache bypass
                window.location.replace('/admin/login.html');
                
            } catch (error) {
                console.error('❌ Error during logout:', error);
                // Force redirect even if logout fails
                window.location.href = '/admin/login.html';
            }
        }
        
        // ===== REFRESH FUNCTIONS =====
        
        async function refreshDashboard() {
            console.log('Manual refresh triggered...');
            showToast('Refreshing dashboard...', 'info', 2000);
            await loadDashboardData();
            showToast('Dashboard refreshed!', 'success', 3000);
        }
        
        async function hardRefresh() {
            console.log('Hard refresh triggered...');
            showToast('Performing hard refresh...', 'info', 2000);
            
            try {
                // Clear all caches
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    await Promise.all(cacheNames.map(name => caches.delete(name)));
                    console.log('✅ Cleared caches:', cacheNames);
                }
                
                // Clear localStorage (but preserve auth data)
                const authKeys = ['ra_admin_token', 'ra_admin_role', 'ra_admin_user'];
                const preservedData = {};
                authKeys.forEach(key => {
                    const value = localStorage.getItem(key);
                    if (value) preservedData[key] = value;
                });
                
                localStorage.clear();
                
                // Restore auth data
                Object.entries(preservedData).forEach(([key, value]) => {
                    localStorage.setItem(key, value);
                });
                
                // Clear sessionStorage
                sessionStorage.clear();
                
                // Unregister service worker
                if ('serviceWorker' in navigator) {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    await Promise.all(registrations.map(registration => registration.unregister()));
                    console.log('✅ Unregistered service workers');
                }
                
                // Force reload with cache bypass
                window.location.reload(true);
                
            } catch (error) {
                console.error('Hard refresh failed:', error);
                showToast('Hard refresh failed, reloading page...', 'error');
                window.location.reload();
            }
        }
        
        // ===== REAL-TIME EVENT HANDLERS =====
        
        function handleUserChanged(data) {
            console.log('Real-time user change:', data);
            showToast(`User ${data.operation} by ${data.changedBy}`, 'info', 3000);
            
            // Refresh users data
            loadUsers().then(() => {
                updateDashboardUI();
            });
        }
        
        function handleRunnerChanged(data) {
            console.log('Real-time runner change:', data);
            showToast(`Runner ${data.operation} by ${data.changedBy}`, 'info', 3000);
            
            // Refresh runners data
            loadRunners().then(() => {
                updateDashboardUI();
            });
        }
        
        function handleAdminChanged(data) {
            console.log('Real-time admin change:', data);
            showToast(`Admin ${data.operation} by ${data.changedBy}`, 'info', 3000);
            
            // Refresh admins data
            loadAdmins().then(() => {
                updateDashboardUI();
            });
        }
        
        function handlePublicCaseChanged(data) {
            console.log('Real-time public case change:', data);
            showToast(`Public case ${data.operation} by ${data.changedBy}`, 'info', 3000);
            
            // Refresh public cases data
            loadPublicCases().then(() => {
                updateDashboardUI();
            });
        }
        
        function handleDataVersionChanged(data) {
            console.log('Real-time data version change:', data);
            
            // Refresh all dashboard data
            loadDashboardData();
        }
        
        function handleAdminActivity(data) {
            console.log('Real-time admin activity:', data);
            
            // Show activity notification
            if (data.adminName && data.activity) {
                showToast(`Admin activity: ${data.activity} by ${data.adminName}`, 'info', 3000);
            }
        }
        
        // ===== CONNECTION STATUS =====
        
        function updateConnectionStatus(isConnected, isPolling = false) {
            const statusElement = document.getElementById('connectionStatus');
            const textElement = document.getElementById('connectionText');
            
            if (statusElement && textElement) {
                if (isConnected) {
                    statusElement.className = 'connection-status connected';
                    textElement.textContent = 'Real-time Connected';
                } else if (isPolling) {
                    statusElement.className = 'connection-status';
                    textElement.textContent = 'Polling Mode';
                } else {
                    statusElement.className = 'connection-status disconnected';
                    textElement.textContent = 'Disconnected';
                }
            }
        }
        
        // ===== API UTILITIES =====
        
        // Enhanced fetch wrapper with CORS handling
        async function apiFetch(url, options = {}) {
            const defaultOptions = {
                mode: 'cors',
                credentials: 'omit',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                    ...options.headers
                }
            };
            
            const mergedOptions = { ...defaultOptions, ...options };
            
            try {
                const response = await fetch(url, mergedOptions);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                return response;
            } catch (error) {
                console.error('API fetch error:', error);
                throw error;
            }
        }

        // ===== REAL-TIME UPDATES =====
        let realTimeConnection = null;
        let isRealTimeEnabled = false;
        let pollingInterval = null;
        let pollingMode = false;
        
        // Initialize SignalR connection for real-time updates
        async function initializeRealTimeUpdates() {
            try {
                const apiBaseUrl = window.API_BASE_URL || 'https://241runners-api.azurewebsites.net/api';
                const hubUrl = apiBaseUrl.replace('/api', '/adminHub');
                
                realTimeConnection = new signalR.HubConnectionBuilder()
                    .withUrl(hubUrl, {
                        accessTokenFactory: () => storage.get('ra_admin_token'),
                        skipNegotiation: true,
                        transport: signalR.HttpTransportType.WebSockets
                    })
                    .withAutomaticReconnect()
                    .build();

                // Handle user updates
                realTimeConnection.on("UserUpdated", (userData) => {
                    console.log('🔄 Real-time user update:', userData);
                    updateUserInList(userData);
                    updateDashboardUI();
                });

                // Handle user deletion
                realTimeConnection.on("UserDeleted", (userId) => {
                    console.log('🗑️ Real-time user deletion:', userId);
                    dashboardData.users = dashboardData.users.filter(u => u.id !== userId);
                    dashboardData.stats.totalUsers--;
                    updateUsersTable();
                    updateDashboardUI();
                });

                // Handle admin updates
                realTimeConnection.on("AdminUpdated", (adminData) => {
                    console.log('🔄 Real-time admin update:', adminData);
                    updateAdminInList(adminData);
                    updateDashboardUI();
                });

                // Handle admin deletion
                realTimeConnection.on("AdminDeleted", (adminId) => {
                    console.log('🗑️ Real-time admin deletion:', adminId);
                    dashboardData.admins = dashboardData.admins.filter(a => a.id !== adminId);
                    updateAdminsTable();
                    updateDashboardUI();
                });

                // Handle case updates
                realTimeConnection.on("CaseUpdated", (caseData) => {
                    console.log('🔄 Real-time case update:', caseData);
                    updateCaseInList(caseData);
                    updateDashboardUI();
                });

                // Start connection
                await realTimeConnection.start();
                isRealTimeEnabled = true;
                console.log('✅ Real-time updates connected');
                showToast('Real-time updates enabled', 'success', 2000);
                
            } catch (error) {
                console.error('❌ Real-time connection failed:', error);
                isRealTimeEnabled = false;
                showToast('Real-time updates unavailable - using polling mode', 'warning', 3000);
                
                // Fallback to polling mode
                startPollingMode();
            }
        }

        // Update user in the list
        function updateUserInList(userData) {
            const userIndex = dashboardData.users.findIndex(u => u.id === userData.id);
            if (userIndex !== -1) {
                dashboardData.users[userIndex] = { ...dashboardData.users[userIndex], ...userData };
            } else {
                dashboardData.users.push(userData);
                dashboardData.stats.totalUsers++;
            }
            updateUsersTable();
        }

        // Update admin in the list
        function updateAdminInList(adminData) {
            const adminIndex = dashboardData.admins.findIndex(a => a.id === adminData.id);
            if (adminIndex !== -1) {
                dashboardData.admins[adminIndex] = { ...dashboardData.admins[adminIndex], ...adminData };
            } else {
                dashboardData.admins.push(adminData);
            }
            updateAdminsTable();
        }

        // Update case in the list
        function updateCaseInList(caseData) {
            const caseIndex = dashboardData.cases.findIndex(c => c.id === caseData.id);
            if (caseIndex !== -1) {
                dashboardData.cases[caseIndex] = { ...dashboardData.cases[caseIndex], ...caseData };
            } else {
                dashboardData.cases.push(caseData);
                dashboardData.stats.totalCases++;
            }
            updateCasesTable();
        }

        // Polling mode fallback when SignalR fails
        function startPollingMode() {
            if (pollingMode) return; // Already in polling mode
            
            pollingMode = true;
            console.log('🔄 Starting polling mode for data updates');
            
            // Poll every 30 seconds for updates
            pollingInterval = setInterval(async () => {
                try {
                    await refreshDashboardData();
                } catch (error) {
                    console.error('Polling error:', error);
                }
            }, 30000);
            
            updateConnectionStatus(false, true);
        }

        // Stop polling mode
        function stopPollingMode() {
            if (pollingInterval) {
                clearInterval(pollingInterval);
                pollingInterval = null;
            }
            pollingMode = false;
            console.log('🛑 Stopped polling mode');
        }

        // Refresh dashboard data
        async function refreshDashboardData() {
            try {
                console.log('🔄 Refreshing dashboard data...');
                
                // Load users
                await loadUsers();
                
                // Load admins
                await loadAdmins();
                
                // Load cases
                await loadCases();
                
                // Update UI
                updateDashboardUI();
                
                console.log('✅ Dashboard data refreshed');
            } catch (error) {
                console.error('❌ Failed to refresh dashboard data:', error);
            }
        }

        // ===== INITIALIZATION =====
        
        async function initializeDashboard() {
            try {
                console.log('🚀 Initializing enhanced admin dashboard...');
                
                // Check authentication
                if (!requireAdmin()) {
                    return;
                }
                
                // Initialize real-time updates
                await initializeRealTimeUpdates();
                
                // Initialize admin profile manager (optional)
                if (typeof AdminProfileManager !== 'undefined' && AdminProfileManager.initialize) {
                    try {
                        await AdminProfileManager.initialize();
                        
                        // Set up profile update callbacks
                        if (AdminProfileManager.onProfileUpdate) {
                            AdminProfileManager.onProfileUpdate((profileData) => {
                                console.log('📱 Profile updated:', profileData);
                                updateAdminProfile();
                            });
                        }
                    } catch (error) {
                        console.warn('AdminProfileManager initialization failed:', error);
                    }
                } else {
                    console.log('AdminProfileManager not available, skipping initialization');
                }
                
                // Initialize monitoring system (optional)
                if (typeof AdminMonitoringSystem !== 'undefined' && AdminMonitoringSystem.initialize) {
                    try {
                        await AdminMonitoringSystem.initialize();
                        
                        // Set up monitoring callbacks
                        if (AdminMonitoringSystem.on) {
                            AdminMonitoringSystem.on('users', (data) => {
                                console.log('👤 Users updated:', data);
                                updateDashboardUI();
                            });
                            
                            AdminMonitoringSystem.on('admins', (data) => {
                                console.log('👥 Admins updated:', data);
                                updateDashboardUI();
                            });
                            
                            AdminMonitoringSystem.on('activity', (data) => {
                                console.log('📱 Admin activity:', data);
                                // Handle admin activity notifications
                            });
                        }
                    } catch (error) {
                        console.warn('AdminMonitoringSystem initialization failed:', error);
                    }
                } else {
                    console.log('AdminMonitoringSystem not available, skipping initialization');
                }
                
                // Initialize real-time system (optional)
                if (typeof AdminRealtime !== 'undefined' && AdminRealtime.initialize) {
                    try {
                        await AdminRealtime.initialize();
                        
                        // Set up connection status callbacks
                        if (AdminRealtime.onConnectionStatusChange) {
                            AdminRealtime.onConnectionStatusChange((isConnected, isPolling) => {
                                updateConnectionStatus(isConnected, isPolling);
                            });
                        }
                        
                        // Set up real-time event handlers
                        if (AdminRealtime.on) {
                            AdminRealtime.on('userChanged', handleUserChanged);
                            AdminRealtime.on('runnerChanged', handleRunnerChanged);
                            AdminRealtime.on('adminProfileChanged', handleAdminChanged);
                            AdminRealtime.on('dataVersionChanged', handleDataVersionChanged);
                            AdminRealtime.on('adminActivity', handleAdminActivity);
                        }
                    } catch (error) {
                        console.warn('AdminRealtime initialization failed:', error);
                    }
                } else {
                    console.log('AdminRealtime not available, skipping initialization');
                }
                
                // Load current admin profile
                await loadCurrentAdmin();
                
                // Load dashboard data using individual functions
                await loadDashboardData();
                
                // Load triage queue data
                await loadTriageQueue();
                
                // Load system health data
                await loadSystemHealth();
                
                // Load moderation queue data
                await loadModerationQueue();
                
                // Load notifications data
                await loadNotifications();
                
                // Load data quality data
                await loadDataQuality();
                
                // Start refresh timer (fallback) - reduced frequency for better performance
                refreshInterval = setInterval(loadDashboardData, 60000); // 60 seconds
                
                // Show success message
                showToast('Enhanced admin dashboard loaded successfully!', 'success', 3000);
                
                console.log('✅ Enhanced admin dashboard initialized successfully');
            } catch (error) {
                console.error('❌ Error initializing dashboard:', error);
                showToast('Dashboard initialization failed. Please refresh the page.', 'error');
            }
        }
        
        // ===== EVENT LISTENERS =====
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Admin Dashboard DOM loaded');
            console.log('Debug: Body content length: ' + document.body.innerHTML.length);
            
            // Add global error handlers
            window.addEventListener('error', function(event) {
                console.error('Global error:', event.error);
                showToast('An error occurred. Please check the console.', 'error');
            });
            
            window.addEventListener('unhandledrejection', function(event) {
                console.error('Unhandled promise rejection:', event.reason);
                showToast('A network error occurred. Please check your connection.', 'error');
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                const modals = ['adminsModal', 'inviteUserModal', 'bulkActionsModal', 'savedFiltersModal', 'auditLogModal', 'newCaseModal', 'slaConfigModal', 'bulkAssignModal'];
                modals.forEach(modalId => {
                    const modal = document.getElementById(modalId);
                    if (event.target === modal) {
                        switch(modalId) {
                            case 'adminsModal': closeAdminsModal(); break;
                            case 'inviteUserModal': closeInviteUserModal(); break;
                            case 'bulkActionsModal': closeBulkActionsModal(); break;
                            case 'savedFiltersModal': closeSavedFiltersModal(); break;
                            case 'auditLogModal': closeAuditLogModal(); break;
                            case 'newCaseModal': closeNewCaseModal(); break;
                            case 'slaConfigModal': closeSLAConfigModal(); break;
                            case 'bulkAssignModal': closeBulkAssignModal(); break;
                        }
                    }
                });
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    closeAdminsModal();
                    closeInviteUserModal();
                    closeBulkActionsModal();
                    closeSavedFiltersModal();
                    closeAuditLogModal();
                    closeNewCaseModal();
                    closeSLAConfigModal();
                    closeBulkAssignModal();
                }
            });
            
            // Initialize dashboard with a small delay to ensure DOM is fully ready
            // Reduced delay for faster loading
            setTimeout(() => {
                console.log('🚀 Starting dashboard initialization...');
                initializeDashboard();
            }, 200);
            
            // Cleanup on page unload
            window.addEventListener('beforeunload', () => {
                if (realTimeConnection) {
                    realTimeConnection.stop();
                }
                stopPollingMode();
            });
        });
        
    </script>
</body>
</html>
