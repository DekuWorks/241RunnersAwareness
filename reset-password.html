<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reset Password - 241Runners Awareness</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="auth-utils.js"></script>
  <link rel="stylesheet" href="styles.css?v=20250128h" />
  <link rel="stylesheet" href="forms.css?v=20250128h" />
</head>
<body>
  <!-- Header -->
  <header role="banner">
    <nav class="navbar">
      <div class="nav-container">
        <div class="nav-brand">
          <a href="index.html">
            <img src="241-logo.jpg" alt="241 Runners Awareness Logo - Supporting missing and vulnerable individuals" class="logo" />
          </a>
        </div>
        <div class="nav-menu" id="navMenu">
          <a href="index.html" class="nav-link">Home</a>
          <a href="map.html">üó∫Ô∏è Map</a>
          <a href="dna-tracking.html">üß¨ DNA Tracking</a>
          <a href="aboutus.html">‚ÑπÔ∏è About</a>
          <a href="login.html" class="nav-link">Login</a>
          <a href="signup.html" class="nav-link">Sign Up</a>
        </div>
        <div class="nav-toggle" id="navToggle">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </nav>
  </header>

  <main role="main">
    <div class="container">
      <div class="auth-container">
        <div class="auth-card">
          <div class="auth-header">
            <h1>üîê Reset Password</h1>
            <p>Enter your new password below.</p>
          </div>

          <form id="resetPasswordForm" class="auth-form">
            <div class="form-group">
              <label for="newPassword">New Password</label>
              <input type="password" id="newPassword" name="newPassword" required minlength="8" placeholder="Enter new password">
              <small>Password must be at least 8 characters long</small>
            </div>

            <div class="form-group">
              <label for="confirmPassword">Confirm Password</label>
              <input type="password" id="confirmPassword" name="confirmPassword" required minlength="8" placeholder="Confirm new password">
            </div>

            <button type="submit" class="btn btn-primary btn-full">
              Reset Password
            </button>
          </form>

          <div class="auth-footer">
            <p>Remember your password? <a href="login.html">Back to Login</a></p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer role="contentinfo">
    <p>&copy; 2025 241 Runners Awareness. All rights reserved.</p>
  </footer>

  <script>
    // Get token from URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');

    if (!token) {
      showNotification('Invalid reset link. Please request a new password reset.', 'error');
      setTimeout(() => {
        window.location.href = 'forgot-password.html';
      }, 3000);
    }

    // Handle form submission
    document.getElementById('resetPasswordForm').addEventListener('submit', async function(event) {
      event.preventDefault();
      
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;

      if (newPassword !== confirmPassword) {
        showNotification('Passwords do not match!', 'error');
        return;
      }

      if (newPassword.length < 8) {
        showNotification('Password must be at least 8 characters long!', 'error');
        return;
      }

      try {
        // For now, show a success message (in real implementation, this would call the API)
        showNotification('Password reset successfully! Redirecting to login...', 'success');
        
        // Clear the form
        document.getElementById('resetPasswordForm').reset();
        
        // Redirect to login page after a delay
        setTimeout(() => {
          window.location.href = 'login.html';
        }, 3000);
        
      } catch (error) {
        console.error('Error resetting password:', error);
        showNotification('An error occurred. Please try again.', 'error');
      }
    });

    // Show notification function
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification notification-${type}`;
      notification.textContent = message;
      
      // Style the notification
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        z-index: 1000;
        max-width: 400px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        animation: slideIn 0.3s ease-out;
      `;
      
      // Set background color based on type
      switch(type) {
        case 'success':
          notification.style.backgroundColor = '#10b981';
          break;
        case 'error':
          notification.style.backgroundColor = '#ef4444';
          break;
        case 'warning':
          notification.style.backgroundColor = '#f59e0b';
          break;
        default:
          notification.style.backgroundColor = '#3b82f6';
      }
      
      document.body.appendChild(notification);
      
      // Remove notification after 5 seconds
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-in';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 5000);
    }

    // Add CSS animations
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      
      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }
    `;
    document.head.appendChild(style);

    // Hamburger menu functionality
    document.getElementById('navToggle').addEventListener('click', function() {
      document.getElementById('navMenu').classList.toggle('active');
      this.classList.toggle('active');
    });
  </script>
</body>
</html>
